20130110:

1.current project website:
http://mo-commerce.com.dev
admin/tmo2012
http://mo-commerce.com.dev

https://wiki.tmogroup.asia/wiki/Main_Page
https://support.tmogroup.asia/login_page.php?return=view.php%3Fid%3D26

maxwell.shi@tmogroup.asia
TMO123456

2.wiki.tmogroup.asia
username: maxwell.shi
password: maxwell123

3.support.tmogroup.asia
username: maxwell.shi
password: maxwell123

4.linux commands:
aptitude install htop netcat dnsutils tcpdump screen apache2 libapache2-mod-php5...
aptitude install git

folder:
/var/www/dev

ssh-keygen -b 2048 -f ~/.ssh/id-git
scp .ssh/id-git.pub tmo@192.168.0.138:~/

git clone scm:~/repositories/com.mo-commerce.git

nano .ssh/config
nano /etc/apache2/mods-enabled/ssl.conf
cd /var/log/
cd /var/www/common/
more dev/default.vhost

aptitude install lynx
nano /etc/memcached.conf

ps aux | grep apache
tail -f error.log

more /etc/php5/conf.d/mysql.ini

nano apc.ini

cd /var/www/dev/log/

database:
mysql dev_com_mocommerce < ../com.mo-commerce/config/dev/mysql5.sql

nano /etc/php5/conf.d/xdebug.ini


rm vhosts/dev.com.mo-commerce.vhost

================================================================================================================================================================

Linux Commands:
20130110:
1. ssh-keygen -b 2048 -f ~/.ssh/id-maxwell-shi
2. .ssh/id-maxwell-shi.pub
3. ssh-rsa xxx
4. ssh tmo@192.168.0.138
5. cp .ssh/id-maxwell-shi /var/www/dev/
6. cd /var/www/dev/
7. ps aux
8. service apache2 restart
9. mysql dev_com_mocommerce < com.mo-commerce/config/dev/mysql5.sql

folder:
0.
app/code/local/Tmo/

1.
app/code/local/Tmo/

2.
app/locale/en_US/template/Tmo_ContractManager.csv

3.
lib/tmo/components/

files:
app/code/local/Tmo/ContactManager/sql/tmo_contactmanager_setup/install-0.1.0.php

login mistake:

wrong:
if ($account && $account->getId()){

correct:
if (isset($account) && $account->getId()){

exception log:
log:var/log/exception.log
2013-01-10T16:45:11+08:00 DEBUG (7): Exception message: Notice: Undefined variable: account  in /var/www/dev/com.mo-commerce/app/code/local/Magestore/Affiliatepluspayperlead/Model/Observer.php on line 44


customer layout and template:
1.app/design/frontend/ultimo/default/layout/infortis_brands.xml

display all template info:
admin/system_config/edit/section/dev/key/012473b876824d493654170d79b9ca5e/

testing product enviroment:
http://hilton.mo-commerce.com.alpha.tmogroup.asia/christmas-eve-buffet-dinner-at-hilton-shanghai-hongqiao.html

================================================================================================================================================================
20130111
Question:
1.password of root
tmo
2.login entry of database
http://mo-commerce.com.dev/tmo/db/

Ultimo reference:
1. 2 fixed name folder: ultimo and infortis:

XML file with all static blocks can be found here:
app\code\local\Infortis\Ultimo\etc\import\

Main folders & files of Magento:
//////////////////////////////////////////////////////////////////////////////////////////////////////

/-folder,//-file

/
--/app
    /code
      /community--?
        /Devinc
	  /Groupdeals
      /core--
      /local
        /Infortis
	  /ultimo
	    /etc
	      //config.xml -- set layout and so on <<1>>
    /design
      /adminhtml
      /frontend
        /base
	  /default
	    /layout <<2>> <action method="setTemplate"><template>page/2columns-left.phtml</template></action>
	    /template
	/ultimo
	  /default
	    /layout <<2>>
	      //local.xml--
	    /template
	      /page <<3>>
	        //1column.phtml
		//2column-left.phtml
		//...
	      /persistent--persistent is a special folder
	        /customer
		  /form
		    //login.phtml
    /etc
      /modules
 /skin
   /adminhtml
   /frontend
 /var
   /log
     //exception.log
     //system.log

//////////////////////////////////////////////////////////////////////////////////////////////////////


a.>app/code/core/mage/customer/etc/config.xml configure all detail
<layout>
            <updates>
                <customer module="Mage_Customer">
                    <file>customer.xml</file>
                </customer>
            </updates>
        </layout>
    </frontend>
b.>app/design/frontend/base/default/layout/customer.xml
<customer_account_login translate="label">
        <label>Customer Account Login Form</label>
        <!-- Mage_Customer -->
        <remove name="right"/>
        <remove name="left"/>

        <reference name="root">
            <action method="setTemplate"><template>page/1column.phtml</template></action>
        </reference>
        <reference name="content">
            <block type="customer/form_login" name="customer_form_login" template="customer/form/login.phtml" />
        </reference>
    </customer_account_login>

   //indicate page/1column.phtml
   //<action method="setTemplate"><template>page/1column.phtml</template></action>
   //

   //indicate content to display the block
     <block type="customer/form_login" name="customer_form_login" template="customer/form/login.phtml" />
   //

c.>persistent is a special folder
<?php echo $this->getChildHtml('persistent.remember.me.tooltip'); ?>

magento manual:
http://www.2cto.com/kf/201212/176394.html

tutorial:
The real power of Blocks/Templates come with the getChildHtml method.
This allows you to include the contents of a secondary Block/Template inside of a primary Block/Template.

This is where the Layout Object enters the picture. The Layout Object is an XML object that will define which Blocks are included on a page, and which Block(s) should kick off the rendering process.

local.xml
<layout version="0.1.0">
    <default>
        <block type="page/html" name="root" output="toHtml" template="magentotutorial/helloworld/simple_page.phtml" />
    </default>
</layout>

Action Controller:
$this->loadLayout();
$this->renderLayout();

<block type="page/html" ...
The URI references a location in the (say it with me) global config. The first portion of the URI (in the above examples page) will be used to query the global config to find the page class name. The second portion of the URI (in the two examples above, html and template_links) will be appended to the base class name to create the class name Magento should instantiate.

Behind the scenes there are <frontend><layout><updates /> and <adminhtml><layout><updates /> sections of the global config that contains nodes with all the file names to load for the respective area. Once the files listed in the config have been combined, Magento will merge in one last xml file, local.xml. This is the file where you're able to add your customizations to your Magento install.

template="magentotutorial/helloworld/simple_page.phtml"
Templates are referenced from the root folder of the current theme. In this case, that's
app/design/frontend/base/default

That's because we didn't add it to local.xml. The getChildHtml method can only include Blocks that are specified as sub-Blocks in the Layout.

Head中支持add类型的方法有addCss、addJs、addCssIe、addJsIe、addLinkRel五种。

reference:
http://www.ahuasheng.com/magento
http://www.magentocommerce.com/knowledge-base/categories/category/getting-started/
http://themeforest.net/item/ultimo-fluid-responsive-magento-theme/3231798

Coding Style & Conventions: PHP
Files

Following chapters describe available types of PHP source files and specify our corresponding coding style & conventions.

[edit] Common
Common file formatting applies to all kinds of source files [css, javascript, (x)html] for our (web) development and is not only limited to PHP development.
File
UTF-8 Character Encoding
UNIX [0x0A] Line Breaks
Line
80 CHAR Line Length May overlap up to an absolute maximum of 100 characters if an aesthetic line-break is not possible.
80 CHAR Print Margin
Indentation
SPACE Tab Character
2 TAB CHAR Tab Width
1 TAB WIDTH Block Indentation
Recommended [PHP only]
1 max. Class per File
500 max. Lines per Class
200 max. Lines per Method

[edit] PHP Plain
PHP file containing global methods.
File
lowercase.php File Name
Layout
PHP Open Tag [long]
2 Empty Lines
PHPdoc File Comment
2 Empty Lines
PHP Global Methods
Separated by 1 Empty Line
Preferred PHPdoc Method Comment
PHP Close Tag
1 Empty Line

Short PHP open/close tags:
  // OK
  <? $this->foo(); ?>
  // NOT OK
  <?php $this->foo(); ?>

Short PHP echo tags:
  // OK
  <?= $title; ?>
  // NOT OK
  <? echo $title; ?>

Finalize EVERY statement:
  // OK
  <?= $title; ?>
  // NOT OK
  <?= $title ?>

 Always choose the right tool for the job:
  // OK
  <td><?= $title; ?></td>
  // NOT OK
  <?= '<td>'.$title.'</td>'; ?>

Always use single-line statements & correct indentation:
  // OK
  <tr>
    <? foreach($array as $key=>$value): ?>
      <td><?= $value; ?></td>
      <? if(0==(2%$key)): ?>
        </tr><tr>
      <? endif; ?>
    <? endforeach; ?>
  </tr>

  // NOT OK
  <tr>
    <?
      foreach($array as $key=>$value)
      {
        printf('<td>%1$s</td>', $value);
        if(0==(2%$key))
          echo '</tr><tr>';
      }
    ?>
  </tr>

Naming Conventions

[edit] Common
Respect as exact as possible for your naming:
function of a type
function & return type of a method
content / type of a constant/property/member
Use 'is' prefix for members/properties/methods that contain/return booleans: $isEnabled, isEnabled() / $isStarted, isStarted().
Use verb for boolean setters: enable() / start()
Name getters/setters always exactly as the member they are accessing/addressing: $m_name, setName(), getName().
Names can give a hint about internal structures, e.g. add()/remove() for arrays, push()/pop() for stacks, register()/unregister() for callbacks/oberservers etc.
Names can give a hint whether a method throws an exception or returns a value, e.g. check()/validate() for throwing methods, otherwise is()/has() [boolean notation].
Names without any value for the reader/reviewer, e.g. '$_' are forbidden and will be marked in code reviews.
Exceptions are simple loop iterators & incrementors like the obligatory '$i' in 'for' loops.
lowercase
foldername/sourcefilename.php
lowerCamelCase
methodName($parameterName_) [parameters always with trailing underscore]
$propertyName
$m_emberName [always with preceeding 'm_' for member]
Under_Score & UpperCamelCase
Plugin_Name_Space_ClassName
UPPERCASE & UNDER_SCORE
const LOCAL_CONSTANT=0;
define('GLOBAL_CONSTANT', 0);
Accessors & Mutators (always in listed order)
Return Type Boolean
hasValue()
isFeatureEnabled()
Return Type Boolean/Void
enableFeature()
disableFeature()
Return Type Mixed
getValue()
setValue()

http://wiki.tmogroup.asia/wiki/Coding_Style_%26_Conventions:_PHP

magento tutorial admin development

oracle vm virtualbox
shared folder
workspace on /var/www/dev type vboxsf
scm.tmogroup.asia
http://mo-commerce.com.dev/

password of wifi:
TMO 20110311

================================================================================================================================================================
20130114
/Tmo
  /ContactManager

1.app/etc/modules/Tmo_ContactManager.xml -let system knows this module is active.
<?xml version="1.0"?>
<config>
  <modules>
    <Tmo_ContactManager>
      <active>true</active>
      <codePool>local</codePool>
      <version>0.1.0</version>
      <depends>
        <Tmo_Security />
      </depends>
    </Tmo_ContactManager>
  </modules>
</config>

2.app/code/local/Tmo/ContactManager/etc/config.xml - main configure file.
<?xml version="1.0" encoding="utf-8"?>
<config>

  <!-- Module -->
  <modules>
    <Tmo_ContactManager>
      <version>0.1.0</version>
    </Tmo_ContactManager>
  </modules>

  <!-- Admin Router --> ++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
  <admin>
    <routers>
      <adminhtml>
        <args>
          <modules>
            <tmo_contactmanager before="Mage_Adminhtml">Tmo_ContactManager_Adminhtml</tmo_contactmanager>
          </modules>
        </args>
      </adminhtml>
    </routers>
  </admin>

  <!-- Admin Layout & Translations -->
  <adminhtml>

    <translate>
      <modules>
        <tmo_contactmanager>
          <files>
            <default>Tmo_ContactManager.csv</default>
          </files>
        </tmo_contactmanager>
      </modules>
    </translate>

  </adminhtml>


  <!-- Global Types -->
  <global>

    <!-- Model -->
    <models>
      <tmo_contactmanager>
        <class>Tmo_ContactManager_Model</class>
        <resourceModel>tmo_contactmanager_resource</resourceModel>
      </tmo_contactmanager>
      <tmo_contactmanager_resource>
        <!-- TODO Rename to _Resource -->
        <class>Tmo_ContactManager_Model_Mysql</class>
        <entities>
          <contact>
            <table>tmo_contactmanager_contacts</table>
          </contact>
          <contact_group>
            <table>tmo_contactmanager_contact_groups</table>
          </contact_group>
          <contact_group_contact>
            <table>tmo_contactmanager_contact_groups_contacts</table>
          </contact_group_contact>
          <contact_group_core_store>
            <table>tmo_contactmanager_contact_groups_core_store</table>
          </contact_group_core_store>
          <contact_type>
            <table>tmo_contactmanager_contact_types</table>
          </contact_type>
          <contact_type_core_store>
            <table>tmo_contactmanager_contact_types_core_store</table>
          </contact_type_core_store>
          <contact_property>
            <table>tmo_contactmanager_contact_properties</table>
          </contact_property>
          <contact_property_type>
            <table>tmo_contactmanager_contact_properties_types</table>
          </contact_property_type>
        </entities>
      </tmo_contactmanager_resource>
    </models>

    <!-- Database Connection(s) -->
    <resources>
      <tmo_contactmanager_setup>
        <setup>
          <module>Tmo_ContactManager</module>
        </setup>
        <connection>
          <use>core_setup</use>
        </connection>
      </tmo_contactmanager_setup>
    </resources>

    <!-- Layout Blocks -->
    <blocks>
      <tmo_contactmanager>
        <class>Tmo_ContactManager_Block</class>
      </tmo_contactmanager>
    </blocks>

    <!-- Helpers -->
    <helpers>
      <tmo_contactmanager>
        <class>Tmo_ContactManager_Helper</class>
      </tmo_contactmanager>
    </helpers>

  </global>


</config>

3./app/local/Tmo/ContactManager/controllers/Adminhtml/ContactsController.php
3.1.<action>adminhtml/contacts/index</action>
3.2.
// IMPLEMENTATION
    protected function init()
    {
      $this->loadLayout();

      $this->_title($this->__('Contact Manager'));

      $this->_setActiveMenu('tmo_contactmanager/contacts');
      /*above set active menu*/

      $this->_addBreadcrumb($this->__('Contact Manager'), $this->__('Contact Manager'));
      $this->_addBreadcrumb($this->__('Contacts'), $this->__('Contacts'));
    }
    //--------------------------------------------------------------------------
// OVERRIDES/IMPLEMENTS
    public function indexAction()
    {
      $this->init();

      $this->_addContent($this->getLayout()->createBlock('tmo_contactmanager/adminhtml_contacts_overview'));

      $this->renderLayout();
    }
3.3.0./app/design/adminhtml/default/default/template/page.phtml
3.3.0./app/design/adminhtml/default/default/template/page/*.*
3.3./app/code/local/Tmo/ContaxtManager/Block/Adminhtml/Contacts/Overview.php
3.4./app/code/core/Mage/Adminhtml/Block/Widget/Grid/Container.php
3.5./app/design/adminhtml/default/default/template/widget/grid/container.phtml

3.6./app/code/core/Mage/Admin/etc/config.xml ->
<adminhtml>
    <layout>
      <updates>
        <admin>
          <file>admin.xml</file>
        </admin>
      </updates>
    </layout>
  </adminhtml>
3.7./app/design/adminhtml/default/default/layout/admin.xml
<layout>
    <!-- admin acl users edit page -->
    <adminhtml_permissions_user_edit>
        <reference name="left">
            <block type="adminhtml/permissions_user_edit_tabs" name="adminhtml.permissions.user.edit.tabs"/>
        </reference>
        <reference name="content">
            <block type="adminhtml/permissions_user_edit" name="adminhtml.permissions.user.edit"/>
        </reference>
        <reference name="js">
            <block type="adminhtml/template" name="adminhtml.permissions.user.roles.grid.js" template="permissions/user_roles_grid_js.phtml"/>
        </reference>
    </adminhtml_permissions_user_edit>

    <!-- admin acl roles grid page -->
    <adminhtml_permissions_role_index>
        <reference name="content">
            <block type="adminhtml/permissions_roles" name="adminhtml.permission.role.index" template="permissions/roles.phtml">
                <block type="adminhtml/permissions_grid_role" name="adminhtml.permission.role.grid" as="grid"/>
            </block>
        </reference>
    </adminhtml_permissions_role_index>
    <adminhtml_permissions_role_rolegrid>
        <remove name="root"/>
        <block type="adminhtml/permissions_grid_role" name="adminhtml.permission.role.grid"/>
    </adminhtml_permissions_role_rolegrid>

    <!-- admin acl roles edit page -->
    <adminhtml_permissions_role_editrole>
        <reference name="left">
            <block type="adminhtml/permissions_editroles" name="adminhtml.permissions.editroles"/>
        </reference>
    </adminhtml_permissions_role_editrole>
    <adminhtml_system_config_edit>
        <reference name="left">
            <block type="adminhtml/system_config_switcher" name="adminhtml.system.config.switcher" before="-"/>
        </reference>
    </adminhtml_system_config_edit>
    <adminhtml_dashboard_index>
        <reference name="content">
            <block type="adminhtml/dashboard" name="dashboard">
                <block type="adminhtml/store_switcher" name="store_switcher" as="store_switcher" template="store/switcher.phtml">
                    <action method="setUseConfirm"><params>0</params></action>
                </block>
            </block>
        </reference>
    </adminhtml_dashboard_index>
    <adminhtml_cache_index>
        <reference name="content">
            <block type="adminhtml/cache" name="cache"></block>
            <block type="adminhtml/cache_additional" name="cache.additional" template="system/cache/additional.phtml"></block>
        </reference>
    </adminhtml_cache_index>
</layout>
3.8.app/code/core/Mage/Core/Model/Layout/Update.php
Warning: simplexml_load_string() [function.simplexml-load-string]: Entity: line 29: parser error : Start tag expected, '<' not found  in /var/www/dev/com.mo-commerce/app/code/core/Mage/Core/Model/Layout/Update.php on line 444
#0 [internal function]: mageCoreErrorHandler(2, 'simplexml_load_...', '/var/www/dev/co...', 444, Array)
#1 /var/www/dev/com.mo-commerce/app/code/core/Mage/Core/Model/Layout/Update.php(444): simplexml_load_string('getFileLayoutUpdatesXml('adminhtml', 'default', 'find', '0')
#3 /var/www/dev/com.mo-commerce/app/code/core/Mage/Core/Model/Layout/Update.php(347): Mage_Core_Model_Layout_Update->fetchFileLayoutUpdates()
#4 /var/www/dev/com.mo-commerce/app/code/core/Mage/Core/Model/Layout/Update.php(246): Mage_Core_Model_Layout_Update->fetchPackageLayoutUpdates('default')
#5 /var/www/dev/com.mo-commerce/app/code/core/Mage/Core/Model/Layout/Update.php(224): Mage_Core_Model_Layout_Update->merge('default')
#6 /var/www/dev/com.mo-commerce/app/code/core/Mage/Core/Controller/Varien/Action.php(306): Mage_Core_Model_Layout_Update->load()
#7 /var/www/dev/com.mo-commerce/app/code/core/Mage/Core/Controller/Varien/Action.php(259): Mage_Core_Controller_Varien_Action->loadLayoutUpdates()
#8 /var/www/dev/com.mo-commerce/app/code/core/Mage/Adminhtml/Controller/Action.php(275): Mage_Core_Controller_Varien_Action->loadLayout(NULL, true, true)
#9 /var/www/dev/com.mo-commerce/app/code/local/Tmo/ContactManager/controllers/Adminhtml/ContactsController.php(60): Mage_Adminhtml_Controller_Action->loadLayout()
#10 /var/www/dev/com.mo-commerce/app/code/local/Tmo/ContactManager/controllers/Adminhtml/ContactsController.php(18): Tmo_ContactManager_Adminhtml_ContactsController->init()
#11 /var/www/dev/com.mo-commerce/app/code/core/Mage/Core/Controller/Varien/Action.php(419): Tmo_ContactManager_Adminhtml_ContactsController->indexAction()
#12 /var/www/dev/com.mo-commerce/app/code/core/Mage/Core/Controller/Varien/Router/Standard.php(250): Mage_Core_Controller_Varien_Action->dispatch('index')
#13 /var/www/dev/com.mo-commerce/app/code/core/Mage/Core/Controller/Varien/Front.php(176): Mage_Core_Controller_Varien_Router_Standard->match(Object(Mage_Core_Controller_Request_Http))
#14 /var/www/dev/com.mo-commerce/app/code/core/Mage/Core/Model/App.php(354): Mage_Core_Controller_Varien_Front->dispatch()
#15 /var/www/dev/com.mo-commerce/app/Mage.php(683): Mage_Core_Model_App->run(Array)
#16 /var/www/dev/com.mo-commerce/lib/tmo/components/runtime/source/magento/bootstrap.php(87): Mage::run('admin', 'store')
#17 /var/www/dev/com.mo-commerce/index.php(8): components_runtime_magento_bootstrap()
#18 {main}


reference:
http://www.8tiny.com/source/magento/nav.html?_functions/index.html
http://blog.csdn.net/newjueqi/article/details/6924192
http://fishpig.co.uk/blog/magento-database-structure-eav.html
Magento Database Structure: EAV


issue list:
0000021: [Development] [com.mo-commerce] Links/categories Widget is limited to 5 Links (maxwell.shi) - assigned.
->have question->pass
0000024: [Development] [com.mo-commerce.devinc.groupdeals] Magento HTML Editor / TinyMCE Plugins are Broken (maxwell.shi) - assigned.
-cms is done,copy cms's content to group
>/app/code/core/mage/adminhtml/block/cms/page/edit/tab/content.php
addItem('js', 'mage/adminhtml/variables.js');

<groupdealsadmin_adminhtml_merchants_index>
        <reference name="content">
            <block type="groupdeals/adminhtml_merchants" name="groupdeals_merchants" />
        </reference>



    </groupdealsadmin_adminhtml_merchants_index>

merchantsController.php
$this->_addContent($this->getLayout()->createBlock('groupdeals/adminhtml_merchants_edit'))
				->_addLeft($this->getLayout()->createBlock('groupdeals/adminhtml_merchants_edit_tabs'));

>merchants部分内容控制文件在:
>/app/code/community/devinc/groupdeals/block/adminhtml/merchants/edit/tab/general.php

>groupdeals部分内容控制文件在:
>/app/code/community/devinc/groupdeals/block/adminhtml/groupdeals/edit/tab/general.php
以下部分创建编辑器按钮
$field->setRenderer($this->getLayout()->createBlock('groupdeals/adminhtml_groupdeals_edit_renderer_fineprint'));



miss some .css and .js file
all js and css files should be merge into layout configure file: groupdeals.xml
<groupdealsadmin_adminhtml_merchants_edit>
<reference name="head">
    <action method="setCanLoadExtJs"><flag>1</flag></action>
    <action method="addJs"><script>mage/adminhtml/variables.js</script></action>
    <action method="addJs"><script>mage/adminhtml/wysiwyg/widget.js</script></action>
    <action method="addJs"><script>lib/flex.js</script></action>
    <action method="addJs"><script>lib/FABridge.js</script></action>
    <action method="addJs"><script>mage/adminhtml/flexuploader.js</script></action>
    <action method="addJs"><script>mage/adminhtml/browser.js</script></action>
    <action method="addJs"><script>prototype/window.js</script></action>
    <action method="addCss"><stylesheet>groupdeals.css</stylesheet></action>
    <action method="addItem"><type>js_css</type><name>prototype/windows/themes/default.css</name></action>
    <action method="addItem"><type>js_css</type><name>prototype/windows/themes/magento.css</name></action>
</reference>
<reference name="left">
    <block type="adminhtml/store_switcher" name="store_switcher" before="-"></block>
</reference>
</groupdealsadmin_adminhtml_merchants_edit>

/app/code/core/mage/cms/model/wysiwyg/config.php
这句话看不懂 Mage::getSingleton('adminhtml/url')->getUrl('adminhtml/cms_wysiwyg/directive'),


0000026: [Development] [com.mo-commerce.devinc.groupdeals] Hide "Custom Design" in Tab "Design" (maxwell.shi) - assigned.
-done
1./groupdealsadmin/adminhtml_groupdeals/edit/groupdeals_id
#modules/action:
/app/code/community/devinc/groupdeals/controllers/adminhtml/groupdealscontroller.php
$this->_addContent($this->getLayout()->createBlock('groupdeals/adminhtml_groupdeals_edit'))
				->_addLeft($this->getLayout()->createBlock('groupdeals/adminhtml_groupdeals_edit_tabs'));
#layout:
<file>groupdeals.xml</file>
<groupdealsadmin_adminhtml_groupdeals_index>
        <reference name="content">
      <block type="adminhtml/store_switcher" name="store_switcher" as="store_switcher">
        <action method="setUseConfirm"><params>0</params></action>
      </block>
            <block type="groupdeals/adminhtml_groupdeals" name="groupdeals" />
        </reference>
    </groupdealsadmin_adminhtml_groupdeals_index>

<block type="groupdeals/adminhtml_groupdeals" name="groupdeals" /> ->
/app/code/community/Devinc/groupdeal/block/adminhtml/groupdeals.php->

<groupdealsadmin_adminhtml_groupdeals_edit>
      <reference name="head">
            <action method="setCanLoadExtJs"><flag>1</flag></action>
            <action method="addJs"><script>mage/adminhtml/variables.js</script></action>
            <action method="addJs"><script>mage/adminhtml/wysiwyg/widget.js</script></action>
            <action method="addJs"><script>lib/flex.js</script></action>
            <action method="addJs"><script>lib/FABridge.js</script></action>
            <action method="addJs"><script>mage/adminhtml/flexuploader.js</script></action>
            <action method="addJs"><script>mage/adminhtml/browser.js</script></action>
            <action method="addJs"><script>prototype/window.js</script></action>
            <action method="addCss"><stylesheet>groupdeals.css</stylesheet></action>
            <action method="addItem"><type>js_css</type><name>prototype/windows/themes/default.css</name></action>
            <action method="addItem"><type>js_css</type><name>prototype/windows/themes/magento.css</name></action>
      </reference>
        <reference name="left">
            <block type="adminhtml/store_switcher" name="store_switcher" before="-"></block>
        </reference>
        <reference name="js">
            <block type="adminhtml/catalog_product_edit_js" template="catalog/product/js.phtml" name="catalog_product_js"></block>
            <block type="core/template" name="catalog.wysiwyg.js" template="catalog/wysiwyg/js.phtml"/>
        </reference>
    </groupdealsadmin_adminhtml_groupdeals_edit>
#template:
1./app/design/adminhtml/default/default/template/widget/tabs.php
2./app/code/community/Devinc/groupdeals/block/adminhtml/groupdeal/edit/tabs.php
line:59 if($group->getId() != 19){
line:60	//#19 is for design

another method:
block:adminhtml/catalog_product_edit_tab_attributes
block:adminhtml/catalog_product_edit_tab_attributes
/app/code/core/Mage/adminhtml/block/catalog/product/edit/tab/attributes.php
Table:eav_attribute_group "Design in this table"

0000029: [Development] [com.mo-commerce.devinc.groupdeals] Group Deals DateTime Field is Shown in Chinese (maxwell.shi) - assigned.
-in fact: it's ok.(in English environment)
0000030: [Development] [com.mo-commerce.devinc.groupdeals] Image Inserted via TinyMCE appears Broken (maxwell.shi) - assigned.
-it works.
0000031: [Development] [com.mo-commerce.devinc.groupdeals] Preview Coupon Leads to 404 (maxwell.shi) - assigned.
-have question
file：
/app/community/Devinc/groupdeals/block/adminhtml/groupdeals/edit.php
line:134,135

table:catalog_product_entity

===============================================================================================================================================================================================================
20130115
Magento Database Structure: EAV

What is EAV?
EAV stands for Entity, Attribute and Value. Let's look at each part of that and try to understand them a little better.

Entity - products, categories, customers and orders.
The entity represents Magento data items such as products, categories, customers and orders. Each entity (product, category etc) will have it's own entity record in the database.

Attribute - data items that belong to an entity.
The attributes represent data items that belong to an entity. For example, the product entity has attributes such as name, price, status and many more.

Value - value of attribute.
The value is the simplest to understand as it is simply a value linked to an attribute.

Table:
catalog_product_entity
catalog_product_entity_decimal
catalog_product_entity_varchar
catalog_product_entity_varchar

table:eav_entity_type
entity_type_id:4
entity_type_code:catelog_product

table:eav_attribute
attribute_id:103

SELECT *
FROM  `eav_attribute`
WHERE entity_type_id =  '4' and attribute_code = 'custom_design'

SELECT *
FROM  `eav_attribute`
WHERE entity_type_id =  '4' and attribute_id = '103'


eav_attribute
To figure out which table each attribute is stored in, Magento uses the column "backend_type" in the table "eav_attribute".

SQL:
SELECT e.entity_id AS product_id, var.value AS product_name
FROM catalog_product_entity e, eav_attribute eav, catalog_product_entity_varchar var
WHERE e.entity_type_id = eav.entity_type_id
AND eav.attribute_code = 'name'
AND eav.attribute_id = var.attribute_id
AND var.entity_id = e.entity_id

>catalog_product_entity / entity of catalog_product -> entity
>eav_attribute -> attribute
>catalog_product_entity_varchar

The above code lists out the name and id for every product in your database.

SQL:
SELECT e.entity_id AS product_id, var.value AS product_name, var.store_id AS store_id
FROM catalog_product_entity e, eav_attribute eav, catalog_product_entity_varchar var
WHERE
e.entity_type_id = eav.entity_type_id
AND eav.attribute_code = 'custom_design'
AND eav.attribute_id = var.attribute_id
AND var.entity_id = e.entity_id
AND var.store_id = 0

>catalog_product_entity -> entity
>eav_attribute -> attribute
>catalog_product_entity_varchar -> varchar detail
>catalog_product_entity_varchar 存储所有文字类的值
$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
在以下的文件里屏蔽部分代码可以实现隐藏不需要的模板，下一步是rewrite这部分代码
>rewrite below php file:
/app/code/core/mage/core/model/design/source/design.php
>$design = array('ultimo' => array('default'));

以下部分用于代码rewrite magento:
>REF: app/code/(codepool)/(NameSpace)/(ModuleName)/etc/config.xml
>TRU: app/code/local/tmo/core/etc/config.xml
>local-codepool
>tmo-namespace
>core-modulename

0./app/etc/modules/Tmo_Core.xml
->
<?xml version="1.0"?>
<config>
  <modules>
    <Tmo_Core>
      <active>true</active>
      <codePool>local</codePool>
      <version>0.1.0</version>
      <depends />
    </Tmo_Core>
  </modules>
</config>
->
/app/code/local/tmo/core/
	1./etc/config.xml
	->
	<?xml version="1.0"?>
	<config>
	  <modules>
	    <Tmo_Core>
	      <version>0.1.0</version>
	    </Tmo_Core>
	  </modules>

	  <global>rewrite写在global标签下models->
	  <models>
	      <core>
		<rewrite>
		  <design_source_design>Tmo_Core_Model_Design_Source_Design</design_source_design>
		</rewrite>
	      </core>
	    </models>
	  </global>

	</config>
	->
	2./Model/Design/Source/Design.php


$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$

$this->loadLayout();
$this->_title(false)->_title($this->__($product->getName()));
$this->_setActiveMenu('groupdeals/add');
$this->_addBreadcrumb(Mage::helper('adminhtml')->__('Deal Information'), Mage::helper('adminhtml')->__('Deal Information'));

$this->getLayout()->getBlock('head')->setCanLoadTinyMce(true);
$this->getLayout()->getBlock('head')->setCanLoadExtJs(true);

$this->_addContent($this->getLayout()->createBlock('groupdeals/adminhtml_groupdeals_edit'))
->_addLeft($this->getLayout()->createBlock('groupdeals/adminhtml_groupdeals_edit_tabs'));

if (!Mage::app()->isSingleStoreMode() && ($switchBlock = $this->getLayout()->getBlock('store_switcher'))) {
$switchBlock->setDefaultStoreName($this->__('Default Values'))
->setWebsiteIds($product->getWebsiteIds())
->setSwitchUrl($this->getUrl('*/*/*', array('_current'=>true, 'active_tab'=>null, 'tab' => null, 'store'=>null)));
}
$this->renderLayout();
->/app/code/community/Devinc/groupdeals/block/adminhtml/groupdeals/edit.php
->class Devinc_Groupdeals_Block_Adminhtml_Groupdeals_Edit extends Mage_Adminhtml_Block_Widget_Form_Container
->_prepareLayout()
protected function _prepareLayout()
{
if ($this->_blockGroup && $this->_controller && $this->_mode) {
    $this->setChild('form', $this->getLayout()->createBlock($this->_blockGroup . '/' . $this->_controller . '_' . $this->_mode . '_form'));
}
return parent::_prepareLayout();
}


Step by step (indexAction())

1./etc/modules/Devinc_Groupdeals.xml
<Devinc_Groupdeals> modules名称，也是模块路径
            <active>true</active>激活
            <codePool>community</codePool>说明文件存储在哪里
        </Devinc_Groupdeals>

2./app/community/Devinc/groupdeals/etc/config.xml
<admin>后台
<routers>地址栏里的定义
<groupdealsadmin>
	<use>admin</use>？
	<args>
		<module>Devinc_Groupdeals</module>
		<frontName>groupdealsadmin</frontName>地址栏中的路径
	</args>
</groupdealsadmin>
</routers>
</admin>
以上说明controller文件应该存储在/app/community/Devinc/groupdeals/controllers/adminhtml/groupdealscontroller.php

3.in controller file:groupdealscontroller.php
indexaction（） 没有任何可用信息 但是 有 $this->loadLayout()
that means: we should check layout xml file:/app/design/adminhtml/default/default/layout/groupdeals.xml
<groupdealsadmin_adminhtml_groupdeals_index>
        <reference name="content">
      <block type="adminhtml/store_switcher" name="store_switcher" as="store_switcher">
        <action method="setUseConfirm"><params>0</params></action>
      </block>
            <block type="groupdeals/adminhtml_groupdeals" name="groupdeals" />
        </reference>
    </groupdealsadmin_adminhtml_groupdeals_index>

4.then check block: /app/code/community/Devinc/groupdeals/block/adminhtml/groupdeals.php
class Devinc_Groupdeals_Block_Adminhtml_Groupdeals extends Mage_Adminhtml_Block_Widget_Grid_Container
->这个block extend from Mage_Adminhtml_Block_Widget_Grid_Container
->/app/code/core/mage/adminhtml/block/widget/grid/container.php
->_prepareLayout()预先布局
->protected function _prepareLayout()
    {
        $this->setChild( 'grid',
            $this->getLayout()->createBlock( $this->_blockGroup.'/' . $this->_controller . '_grid',
            $this->_controller . '.grid')->setSaveParametersInSession(true) );
        return parent::_prepareLayout();
    }
->/app/code/community/Devinc/groupdeals/block/adminhtml/groupdeals/grid.php(Very important)
->_prepareColumns()预先布局
->_prepareCollection()数据整理输出

5.结论template不需要修改，block中的文件控制所有页面内容!


    <models>
      <core>
        <rewrite>
          <design_source_design>Tmo_Core_Model_Design_Source_Design</design_source_design>
        </rewrite>
      </core>
    </models>

     [4] => Array ( [label] => ultimo [value] => Array ( [0] => Array ( [label] => default [value] => ultimo/default ) ) ) )


SQL:
SELECT *
FROM  `catalog_product_entity_varchar`
WHERE  `attribute_id` =103
ORDER BY  `catalog_product_entity_varchar`.`value` DESC

===============================================================================================================================================================================================================
20130116
1.check on config file for rewrite
$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
Magento config.xml配置文件见解
http://www.magentocommerce.com/wiki/5_-_modules_and_development/reference/module_config.xml#adminhtml
$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$
<modules>
<代码包文件夹名称_模块名>
<version>0.2.0</version>
</代码包文件夹名称_模块名>
</modules>
modules标签比较简单，只是声明该模块所在的代码区里面的文件夹的名称，比如Mage文件夹，如果模块在的代码区在local，则是根据自己定义的文件夹来声明，version标签，则是该模块的版本号。该版本号直接影响到sql文件夹下的安装文件。

<admin>
<routers>
<前端名称>
<use>admin</use>
<args>
<module>代码包名称_模块名</module>
<frontName>前端名称</frontName>
</args>
</前端名称>
</routers>
</admin>
admin标签组，定义后台相关路由（一般只涉及路由），frontName标签定义访问时所涉及的模块名，这涉及到路由部分，这里就不说了。use标签，定义的是使用权限，一般后台都定义为admin，这里的模块名与frontName定义的同名

<frontend>
<routers>
<前端名称>
<use>standard</use>
<args>
<module>代码包名称_模块名</module>
<frontName>前端名称</frontName>
</args>
</前端名称>
</routers>
<layout>
<updates>
<前端名称>
<file>布局文件</file>
</前端名称>
</updates>
</layout>
</frontend>
frontend标签组，定义后台相关路由（一般只涉及路由），frontName标签定义访问时所涉及的模块名，这涉及到路由部分，这里就不说了。use标签，定义的是使用权限，一般后台都定义为standard，这里的模块名与frontend定义的同名。
layout标签指定该模块使用哪个布局文件。

global标签，该标签定义该模块下的block,helper,models等相关类的指定，比如：
<helpers>
<前端名称>
<class>该模块下类文件包</class>
</前端名称>
</helpers>
新建模块，如有helper类，都需要在这里指定，有block类也也需要相应的指定才会起作用。

models类也是如此，只是model标签，如有数据表，会要求指定resourceModel标签，如是重写的模块，类都应该是加<!-- <rewrite> -->下的，而不能直接指定<!-- <class> -->例如：
<models>
<前端名称>
<class>model类文件夹</class>
<resourceModel>资源名称</resourceModel>
</前端名称>

<资源名称>
<class>资源类文件夹</class>
<entities>
<实体类名><table>表名</table></实体类名>
</entities>
</资源名称>
</models>

资源名称一般会设定为前端名称_mysql4文件夹，资源类文件夹也指定到此文件夹，实体类名为表对应的类，并不是所有的表都会有实体类。
resources标签，该标签只有模块需要安装文件时才指定。例如：

<resources>
<前端名称_setup>
<setup>
<module>代码包名称_模块名</module>
<class>资源安装类</class>
</setup>
<connection>
<use>core_setup</use>
</connection>
</前端名称_setup>
<前端名称_read>
<connection>
<use>core_read</use>
</connection>

</前端名称_read>
<前端名称_write>
<connection>
<use>core_write</use>
</connection>

</前端名称_write>
</resources>
资源安装类一般为mysql4资源下的Setup类，集成于Mage_Core_Model_Resource_Setup


2.check on shourtcut about pdt(Eclipse)

3.today task list:
line:696

feedback:
Do not change "resolution".
Set the ticket on "feedback", describe your fix and add consumed time into the "time tracking" field below the feedback comment.

linux清除命令:
linux command:
ps aux
service apache2 restart
service memcached restart
cd /var/www/dev/com.mo-commerce/
grep -Rn FILE.CSS .
grep -Rn .CSS .
grep -Rn .CSS app/code/local/
grep -Rn .CSS app/code/community/Devinc/
grep -Rn .CSS app/design/

西数电话400-667-9006
备案号：沪05001152

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

Magento getModel getSingleton等常用函数说明
博客分类： WP / Joomla! / Magento / Shopify / Drupal

Mage::getModel 函数详解：
在通常的PHP初始化类对象的时候，使用以下方式进行生成。
$modelSales = new ModelSales();
但是在magento 中初始化模型对象时候，使用以下的方式进行生成模型对象。
$product = Mage::getModel (’catalog/product’);
我们阅读magneto系统核心代码，发现在执行Mage::getModel(‘catalog/product’)函数时候完成了以下几个步骤：

 在系统配置中寻找节点。
 在节点中间寻找节点。
 在节点中寻找节点。

在class节点所包含的内容(假设定义为Mage_Catalog_Model)和data拼接成最终的类名称，经过magento 类规范变成Mage_Catalog_Model_Product。
然后在Mage/Catalog/Model/Product.php文件中读取类定义并生成对象。
每一次执行的时候，都会重新生成一个模型对象。
最终返回一个Mage_Core_Model_Abstract子类对象。
Php代码
/**
* Retrieve model object
*
* @link    Mage_Core_Model_Config::getModelInstance
* @param   string $modelClass
* @param   array $arguments
* @return  Mage_Core_Model_Abstract
*/
public static function getModel($modelClass = '', $arguments = array())
{
return self::getConfig()->getModelInstance($modelClass, $arguments);
}

Mage::getSingleton 函数详解：
getSingleton 最 终也是返回一个Mage_Core_Model_Abstract子类对象，但是其和getModel函数最大的区别是 永远只生成一个对象，并将生成的对象通过Mage::registry函数注册到magento系统当中，再次执行getSingleton时获取到上一 次生成的对象。
我们通过以下的系统源代码可以清楚的看到其和getModel函数的区别。
Php代码
/**
* Retrieve model object singleton
*
* @param   string $modelClass
* @param   array $arguments
* @return  Mage_Core_Model_Abstract
*/
public static function getSingleton($modelClass='', array $arguments=array())
{
$registryKey = '_singleton/'.$modelClass;
if (!self::registry($registryKey)) {
self::register($registryKey, self::getModel($modelClass, $arguments));
}
return self::registry($registryKey);
}

Mage::helper函数详解：
在通常的PHP初始化类对象的时候，使用以下方式进行生成。
$helper_sales = new HelperSales();
但是在magento中初始化类对象时候，使用以下的方式进行生成对象。
$helper_sales = Mage::helper(‘sales/data’);
我们阅读magneto系统核心代码，发现在执行Mage::helper(‘sales/data’)函数时候完成了以下几个步骤：

 在系统配置中寻找节点。
 在节点中间寻找节点。
 在节点中寻找节点。

在class节点所包含的内容(假设定义为Mage_Sales_Helper)和data拼接成最终的类名称，经过magento类规范变成Mage_Sales_Helper_Data。
然后在Mage/Sales/Helper/Data.php文件中读取类定义并生成对象。
Php代码
/**
* Deprecated, use self::helper()
*
* @param string $type
* @return object
*/
public static function helper($name)
{
if (strpos($name, '/') === false) {
$name .= '/data';
}

$registryKey = '_helper/' . $name;
if (!self::registry($registryKey)) {
$helperClass = self::getConfig()->getHelperClassName($name);
self::register($registryKey, new $helperClass);
}
return self::registry($registryKey);
}

Mage::register 函数详解：
在Mage类中使用$_registry存储生成的对象，这样生成的对象在全局都可以访问。Mage::register 函数有两种格式：

 public static function register($key, $value, $graceful = false) 注册一个新的变量
 public static function registry($key) 通过$key获取已有变量
 public static function unregister($key) 注销一个变量

Magento源文件：
Php代码
public static function register($key, $value, $graceful = false)
{
if (isset(self::$_registry[$key])) {
if ($graceful) {
return;
}
self::throwException('Mage registry key "'.$key.'" already exists');
}
self::$_registry[$key] = $value;
}
/**
* Retrieve a value from registry by a key
*
* @param string $key
* @return mixed
*/
public static function registry($key)
{
if (isset(self::$_registry[$key])) {
return self::$_registry[$key];
}
return null;
}

Mage::getBaseUrl以及其他路径获取函数详解：
获取当前店铺的路径。默认参数是Mage_Core_Model_Store::URL_TYPE_LINK，返回http://example.com/index.php/。
还可以使用以下几个参数：
Php代码
Mage_Core_Model_Store::URL_TYPE_LINK link http://example.com/index.php/
Mage_Core_Model_Store::URL_TYPE_DIRECT_LINK direct_link http://example.com/index.php/
Mage_Core_Model_Store::URL_TYPE_WEB web http://example.com/
Mage_Core_Model_Store::URL_TYPE_SKIN skin http://example.com/skin/
Mage_Core_Model_Store::URL_TYPE_JS js http://example.com/js/
Mage_Core_Model_Store::URL_TYPE_MEDIA media http://example.com/media/

当然，也可以使用简短的代码来获取js。Mage::getBaseUrl(‘js’);
Php代码
/**
* Get base URL path by type
*
* @param string $type
* @return string
*/
public static function getBaseUrl($type = Mage_Core_Model_Store::URL_TYPE_LINK, $secure = null)
{
return self::app()->getStore()->getBaseUrl($type, $secure);
}

Mage_Core_Helper_Url类调用路径
函数位于app/code/core/Mage/Core/Model/Url.php当中。
1.获取当前路径Mage::help(‘core/url’)->getCurrentUrl();
Php代码
/**
* Retrieve current url
*
* @return string
*/
public function getCurrentUrl()
{
return $this->_getUrl('*/*/*', array('_current' => true, '_use_rewrite' => true));

2.获取主页路径 Mage::help(‘core/url’)->getHomeUrl();
Php代码
/**
* Retrieve homepage url
*
* @return string
*/
public function getHomeUrl()
{
return Mage::getBaseUrl();
}

在Block和Phtml文件中，可以使用getUrl函数直接调用路径，一般使用在Block文件中。该函数定义在app/code/core/Mage/Core/Block/Abstract.php文件中。
如$this->getUrl(‘customer/account/login’);表示用户登录页面。
Php代码
/**
* Generate url by route and parameters
*
* @param   string $route
* @param   array $params
* @return  string
*/
public function getUrl($route='', $params=array())
{
return $this->_getUrlModel()->getUrl($route, $params);//该函数调用Mage::help('core/url')->getUrl($route, $params);来进行处理，效果一样。
}

如果调用skin中某个文件，可以直接使用getSkinUrl函数，一般用在Phtml文件中。如$this->getSkinUrl(‘images/calendar.gif’);表示获取指定模板中的images/calendar.gif文件。
Php代码
/**
* Retrieve url of skins file
*
* @param   string $file path to file in skin
* @param   array $params
* @return  string
*/
public function getSkinUrl($file=null, array $params=array())
{
return Mage::getDesign()->getSkinUrl($file, $params);
}

getData 函数:
可以直接获取对象中的某个值，如获取产品的sku值，可以使用$product->getData (‘sku’);，也可以使用$product->getSku();
在没有参数的情况下，getData 函数会返回一个数组，你可以print_r($Product->getData()); 讲所有数据打印出来。也可以使用$arrProduct = $Product->getData(); echo $arrProduct->sku;
,

Magento 常用技巧与方法
http://www.magentolog.com/magento-%E5%B8%B8%E7%94%A8%E6%8A%80%E5%B7%A7%E4%B8%8E%E6%96%B9%E6%B3%95/

Mangento config.xml说明
http://www.magentocommerce.com/wiki/5_-_modules_and_development/reference/module_config.xml#adminhtml

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

SELECT *
FROM `dev_com_mocommerce`.`catalog_product_entity_text`
WHERE (
CONVERT( `value_id`
USING utf8 ) LIKE '%%@@Highlights@@%%'
OR CONVERT( `entity_type_id`
USING utf8 ) LIKE '%%@@Highlights@@%%'
OR CONVERT( `attribute_id`
USING utf8 ) LIKE '%%@@Highlights@@%%'
OR CONVERT( `store_id`
USING utf8 ) LIKE '%%@@Highlights@@%%'
OR CONVERT( `entity_id`
USING utf8 ) LIKE '%%@@Highlights@@%%'
OR CONVERT( `value`
USING utf8 ) LIKE '%%@@Highlights@@%%'
)
LIMIT 0 , 30

此表中存储着用户填写的具体内容：
table:catalog_product_entity_text
entity_id 4 对应 entity, entity_type_code:catalog_product
attribute_id 135,73 对应 attribute：attribute_code:groupdeal_highlights
value_id 501,507 对应 具体值

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
20130117 git commit
1./app/code/community/Devinc/Groupdeals/block/adminhtml/groupdeals/edit/tabs.php ->19
2./app/code/community/Devinc/Groupdeals/controllers/adminhtml/groupdealscontroller.php
3./app/code/core/mage/core/model/design/source/design.php
4./app/design/frontend/base/default/layout/customer.xml <block type="customer/form_login" name="customer_form_login" template="customer/form/login.phtml" />
5./app/design/frontend/ultimo/default/template/persistent/customer/form/login.phtml


>from:
/app/code/local/tmo/comwidget/
>to:
/app/code/local/tmo/widget/

linux commands:
mysqldump dev_com_mocommerce > dev_com_mocommerce.sql
mysql db < sql
cd /etc/php5/conf.d/
nano apc.ini
nano apache2.conf
time dd if=/dev/urandom of=/var/dev/test.bak bs=4096 count=16384
cd .ssh/
ls
scp id-maxwell-shi* admin@192.168.0.134:~/



dev02:~ maxwellshi$ more .bash_history
su admin
cd .ssh/
ls
cd ..
ls
cd workspace/
ls
cd ..
nano .gitconfig
nano .ssh/config
ls -l .ssh/
nano .ssh/config
ssh scm
ls -l
sudo chown -R maxwellshi:staff workspace/
su admin
cd
ls
exit
cd /Library/Java/JavaVirtualMachines/1.6.0_37-b06-434.jdk/Contents/
ls -l
cd Home/
ls
cd lib/
ls
cd ../bin/
ls
cd ../lib/
ls
more jvm.
more jvm.cfg
ls -l
cd ext/
ls
cd ..
cd ..
ls
cd ..
ls
cd MacOS/
ls
ls -l
cd ../Libraries/
ls -l
pwd
cd ..
ls
nano /etc/hosts
nano /etc/hosts
cd /var/db/crls/
ls
more C2831C06D125B43B62919E1A126EB9225F676B66.crl
ls -l
ks
sudo rm & .db
su admin
exit
sudo bash
exit
ssh scm
ssh scm
sudo bash
logout
exit
cd /var/www/
ls -l
rm dev
su admin
cd
ls
nano .my.cnf
mysql
nano .my.cnf
mysql dev_com_mocommerce_maxwellshi < workspace/com.mo-commerce/config/dev/mysql5.sql
cd workspace/
ls -l
chown -R maxwellshi:www .
cd log/
ls -l
cd
more .bash_history
su admin
exit
dev02:~ maxwellshi$ su admin
Password:
bash-3.2$ more .bash_history
.bash_history: Permission denied
bash-3.2$ su root
Password:
sh-3.2# more .bash_history
su admin
cd .ssh/
ls
cd ..
ls
cd workspace/
ls
cd ..
nano .gitconfig
nano .ssh/config
ls -l .ssh/
nano .ssh/config
ssh scm
ls -l
sudo chown -R maxwellshi:staff workspace/
su admin
cd
ls
exit
cd /Library/Java/JavaVirtualMachines/1.6.0_37-b06-434.jdk/Contents/
ls -l
cd Home/
ls
cd lib/
ls
cd ../bin/
ls
cd ../lib/
ls
more jvm.
more jvm.cfg
ls -l
cd ext/
ls
cd ..
cd ..
ls
cd ..
ls
cd MacOS/
ls
ls -l
cd ../Libraries/
ls -l
pwd
cd ..
ls
nano /etc/hosts
nano /etc/hosts
cd /var/db/crls/
ls
more C2831C06D125B43B62919E1A126EB9225F676B66.crl
ls -l
ks
sudo rm & .db
su admin
exit
sudo bash
exit
ssh scm
ssh scm
sudo bash
logout
exit
cd /var/www/
ls -l
rm dev
su admin
cd
ls
nano .my.cnf
mysql
nano .my.cnf
mysql dev_com_mocommerce_maxwellshi < workspace/com.mo-commerce/config/dev/mysql5.sql
cd workspace/
ls -l
chown -R maxwellshi:www .
cd log/
ls -l
cd
more .bash_history
su admin
exit
sh-3.2# clear

sh-3.2# more .bash_history
su admin
cd .ssh/
ls
cd ..
ls
cd workspace/
ls
cd ..
nano .gitconfig
nano .ssh/config
ls -l .ssh/
nano .ssh/config
ssh scm
ls -l
sudo chown -R maxwellshi:staff workspace/
su admin
cd
ls
exit
cd /Library/Java/JavaVirtualMachines/1.6.0_37-b06-434.jdk/Contents/
ls -l
cd Home/
ls
cd lib/
ls
cd ../bin/
ls
cd ../lib/
ls
more jvm.
more jvm.cfg
ls -l
cd ext/
ls
cd ..
cd ..
ls
cd ..
ls
cd MacOS/
ls
ls -l
cd ../Libraries/
ls -l
pwd
cd ..
ls
nano /etc/hosts
nano /etc/hosts
cd /var/db/crls/
ls
more C2831C06D125B43B62919E1A126EB9225F676B66.crl
ls -l
ks
sudo rm & .db
su admin
exit
sudo bash
exit
ssh scm
ssh scm
sudo bash
logout
exit
cd /var/www/
ls -l
rm dev
su admin
cd
ls
nano .my.cnf
mysql
nano .my.cnf
mysql dev_com_mocommerce_maxwellshi < workspace/com.mo-commerce/config/dev/mysql5.sql
cd workspace/
ls -l
chown -R maxwellshi:www .
cd log/
ls -l
cd
more .bash_history
su admin
exit

http://reyo.cn/news/20120325184192.html

Mac OS启动服务优化高级篇（launchd tuning）

时间：2012年03月25日 18:41人气：16529纠错

Mac下的启动服务主要有三个地方可配置：
1，系统偏好设置->帐户->登陆项
2，/System/Library/StartupItems 和 /Library/StartupItems/
3，launchd 系统初始化进程配置。

前两种优化比较简单，本文主要介绍的是第三种更为复杂的launchd配置优化。
launchd是Mac OS下，用于初始化系统环境的关键进程。类似Linux下的init, rc。

我们先来看一下Mac OS X的启动原理：
1，mac固件激活，初始化硬件，加载BootX引导器。
2，BootX加载内核与内核扩展(kext)。
3，内核启动launchd进程。
4，launchd根据 /System/Library/LaunchAgents , /System/Library/LaunchDaemons , /Library/LaunchDaemons, Library/LaunchAgents , ~/Library/LaunchAgents 里的plist配置，启动服务守护进程。

看完了Mac OS X的启动原理，我们不难发觉 /System/Library/LaunchAgents , /System/Library/LaunchDaemons , /Library/LaunchDaemons, Library/LaunchAgents 五个目录下的plist属性文件是优化系统的关键。

下面再来理解几个基础概念：
/System/Library和/Library和~/Library目录的区别？
/System/Library目录是存放Apple自己开发的软件。
/Library目录是系统管理员存放的第三方软件。
~/Library/是用户自己存放的第三方软件。

LaunchDaemons和LaunchAgents的区别？
LaunchDaemons是用户未登陆前就启动的服务（守护进程）。
LaunchAgents是用户登陆后启动的服务（守护进程）。

上面提到的五个目录下的plist文件格式及每个字段的含义：
Key 	Description 	Required
Label 	The name of the job 	yes
ProgramArguments 	Strings to pass to the program when it is executed 	yes
UserName 	The job will be run as the given user, who may not necessarily be the one who submitted it to launchd. 	no
inetdCompatibility 	Indicates that the daemon expects to be run as if it were launched by inetd 	no
Program 	The path to your executable. This key can save the ProgramArguments key for flags and arguments. 	no
onDemand 	A boolean flag that defines if a job runs continuously or not 	no
RootDirectory 	The job will be chrooted into another directory 	no
ServiceIPC 	Whether the daemon can speak IPC to launchd 	no
WatchPaths 	Allows launchd to start a job based on modifications at a file-system path 	no
QueueDirectories 	Similar to WatchPath, a queue will only watch an empty directory for new files 	no
StartInterval 	Used to schedule a job that runs on a repeating schedule. Specified as the number of seconds to wait between runs. 	no
StartCalendarInterval 	Job scheduling. The syntax is similar to cron. 	no
HardResourceLimits 	Controls restriction of the resources consumed by any job 	no
LowPriorityIO 	Tells the kernel that this task is of a low priority when doing file system I/O 	no
Sockets 	An array can be used to specify what socket the daemon will listen on for launch on demand 	no

看不懂上面地plist配置吗？没关系，我们的优化策略是完全卸载服务，所以我们不用关心plist里的配置含义。
开始优化

禁用服务，我们需要用到Mac OS提供的一个工具指令－launchctl
launchctl 指令会针对服务设置一个禁用标志，launchd启动时会先检查这个服务是否被禁用，从而确定是否需要启用这个服务。

禁用服务的方法1
先找到禁用标志文件 /var/db/launchd.db/com.apple.launchd/overrides.plist，查看你要禁用的服务是否已被禁用了。
有些服务已被禁用，但未列在overrides.plist里。此时，你还需要检查这个服务的plist文件Label字段是否已经标记为 Disable。

确认这个服务未禁用后，我们就可以通过调用如下命令，来禁用服务：
sudo launchctl unload plist文件路径
sudo launchctl unload -w plist文件路径
比如，我想禁用spotlight，则输入
sudo launchctl unload /System/Library/LaunchAgents/com.apple.Spotlight.plist
sudo launchctl unload -w /System/Library/LaunchAgents/com.apple.Spotlight.plist

禁用完服务以后，重启Mac OS即可生效。

禁用服务的方法2，一种更有效且暴力的方法（推荐）
先卸载服务
sudo launchctl unload /System/Library/LaunchAgents/com.apple.Spotlight.plist
然后将plist文件mv到其他目录备份。重启。搞定。是不是很简单!

我个人比较喜欢这种禁用服务的方式，所以推荐一下。

如果发现服务禁用后，系统或软件出现异常，可以通过如下命令，还原服务：
方法1:
sudo launchctl load -wF plist文件路径
方法2:
将备份的plist文件mv回原来的文件夹。
sudo launchctl load plist文件路径

注意：系统级服务的禁用要异常小心，请在禁用前google，确保你熟知这个服务的作用。否则可能导致系统无法启动。
最安全的做法就是不要去禁用它了。

当然，用户服务我们还是可以放心禁用的，有问题最多再启用呗。

下面是我禁用的服务列表：
/System/Library/LaunchDaemons/com.apple.metadata.mds.plist (禁用spotlight的前提)
/System/Library/LaunchAgents/com.apple.Spotlight.plist (Spotlight)
/Library/LaunchDaemons/com.google.keystone.daemon.plist (Google Software Update)
/Library/LaunchAgents/com.google.keystone.root.agent (Google Software Update)
~/Library/LaunchAgents/com.google.keystone.agent.plist (Google Software Update，用户下的进程不需要加 sudo)
~/Library/LaunchAgents/com.apple.CSConfigDotMacCert-ken.wug\@me.com-SharedServices.Agent.plist (me.com的共享服务，我不用)
/System/Library/LaunchDaemons/org.cups.cupsd.plist （打印机）
/System/Library/LaunchDaemons/org.cups.cups-lpd.plist （打印机）
/System/Library/LaunchDaemons/com.apple.blued.plist （蓝牙）
/System/Library/LaunchAgents/com.apple.AirPortBaseStationAgent.plist （apple无线基站，我没有这个设备）

知道守护进程（服务）名，如何找到对应的plist文件？
将进程（服务）名拷贝，然后到 /System/Library/LaunchAgents , /System/Library/LaunchDaemons , /Library/LaunchDaemons, Library/LaunchAgents , ~/Library/LaunchAgents 五个目录里，通过以下命令查找：

ll|grep 进程(服务)名
比如
ll|grep blued
在 /System/Library/LaunchDaemons 中找到了它。接下来，请按上面指导的步骤，禁用该服务。

config store folder:
/System/Library/LaunchDaemons

$$$$$$$$$$$$$
our system:

1.nano .my.cnf
2.more /Library/LaunchDaemons/org.macports.apache2.plist
3.launchctl unload /Library/LaunchDaemons/org.macports.apache2.plist
3.launchctl load /Library/LaunchDaemons//Users/maxwellshi/workspace/com.mo-commerce/config/dev/local.php.dist /Users/maxwellshi/workspace/com.mo-commerce/config/dev/local.xml.dist
4.ps aux | grep apa
5.ps aux | grep apa
6. cp -Rvf /var/www/dev/vhosts .

git address:
Merge branch 'master' of ssh://git@scm.tmogroup.asia/var/git/repositories/com.mo-commerce.git

20130117/ today all for environment setup

about apache:
1.link /var/www/dev to ±/workspace
2.link /var/www/dev/vhosts/dev.com.mo-commerce.vhost to ±/gitfolder/config/dev/dev.com.mo-commerce.vhost
--->>> documentroot: var/www/
3.apache2 Server Root: 	/opt/local/apache2 -> conf/envvars->export HTTPD_WEB_ROOT=/var/www
4.PHP Version 5.3.18
5.host file
6.plug of firefox: DownThemAll, firebug
7.shortcut keys about pdt-eclipse :http://www.minihowtos.net/eclipse-shortcut-keys
 Most useful Eclipse shortcut keys
Ctrl + M = maximize active view/editor
Ctrl + / = line comment
Ctrl + Shift + / = block comments
Ctrl + D = delete line
Alt + Up = move lines up
Alt + Down = move lines down
Shift + Enter = insert line below current line
Ctrl + Shift + Enter = insert line above current line
Ctrl + Shift + Y = to lower case
Ctrl + Shift + X = to upper case
Ctrl + Space = control assist
Ctrl + K = find next
Ctrl + Shift + K = find previous

Current Task:
1.transfer Tmo/ComWidget to Tmo/Widget

<models>
      <widget>
        <class>Tmo_ComWidget_Model</class>
      </widget>
    </models>

com.mo-commerce.devinc.groupdeals
com.mo-commerce	[All Projects] Development	public	Mon, 07. Jan 2013 18:13	Thu, 17. Jan 2013 19:03

git@scm:/var/git/repositories/com.mo-commerce.git

===============================================================================
20130118
1.auth of pull
git@scm:/var/git/repositories/com.mo-commerce.git: Auth cancel
git@scm:/var/git/repositories/com.mo-commerce.git: Auth cancel
Maxwell Shi <maxwell.shi@tmogroup.asia>
setting of eclipse ->perference->general->network of connections->ssh2->General->ssh key

2.php.ini and other setting, specially apc
2.1.launchctl unload /Library/LaunchDaemons/org.macports.apache2.plist
above kind command only for start and loading
2.2.not only php.ini but also apc.ini of apache

3.apc is the main reason of speed
ref:http://www.hellokeykey.com/speed-up-magento-with-apc/
ref:http://wlservers.blog.163.com/blog/static/1206223042011825348939/
***/app/etc/local.xml -><cache>-><backend>apc</backend>

apc
APC Support enabled
Version   3.1.13
APC Debugging   Disabled
MMAP Support  Enabled
MMAP File Mask  no value
Locking type  spin Locks
Serialization Support   php
Revision  $Revision: 327136 $
Build Date  Sep 5 2012 08:24:07

google search "apc enable spin locks"
running: phpize
Configuring for:
PHP Api Version:         20090626
Zend Module Api No:      20090626
Zend Extension Api No:   220090626
Enable internal debugging in APC [no] :
Enable per request file info about files used from the APC cache [no] :
Enable spin locks (EXPERIMENTAL) [YES] :
Enable memory protection (EXPERIMENTAL) [no] :
Enable pthread mutexes (default) [yes] :
Enable pthread read/write locks (EXPERIMENTAL) [no] :

4.shortcut key of pdt
Ctrl + M = maximize active view/editor
Ctrl + / = line comment
Ctrl + Shift + / = block comments
Ctrl + D = delete line
Alt + Up = move lines up
Alt + Down = move lines down
Shift + Enter = insert line below current line
Ctrl + Shift + Enter = insert line above current line
Ctrl + Shift + Y = to lower case
Ctrl + Shift + X = to upper case
Ctrl + Space = control assist
Ctrl + K = find next
Ctrl + Shift + K = find previous

5.widget issue:
work:http://mo-commerce.com.dev/index.php/admin/widget/index/key/427de332b51ed42cdf3d2e2d0db686e2/widget_target_id/groupdeal_fineprint
doesnot_work:http://mo-commerce.com.dev/index.php/admin/widget/index/key/427de332b51ed42cdf3d2e2d0db686e2/widget_target_id/groupdeal_fineprint

6:
http://www.magentochina.org/blog/the-mct-the-magento-chengdu-exchange-is-completed
structure of magento:
http://files.magentochina.org/nav.html?index.html
tutorial:
************************************************************************************************************************************
http://www.magentochina.org/magento-admin-panel-introduction
http://www.hellokeykey.com/magento-chinese-tutorial-videos/
http://www.wemvc.com/1020.html
http://blog.csdn.net/shuishui8310/article/details/5928471
?showLayout=page
?showConfig=true
************************************************************************************************************************************

SELECT e.entity_id AS product_id, var.value AS groupdeal_highlights
FROM catalog_product_entity e, eav_attribute eav, catalog_product_entity_text var
WHERE e.entity_type_id = eav.entity_type_id
AND eav.attribute_code = 'groupdeal_highlights'
AND eav.attribute_id = var.attribute_id
AND var.entity_id = e.entity_id

select * from
catalog_product_entity_text
where attribute_id = 135

******************************************************************************
>entity_type_id -> entity_type_code: catalog_product
>entity_id -> sku -> app-shanghai-five-star-JC-Mandarin-hotel-cn
>attribute_id -> attribute_code: groupdeal_highlights
>store_id -> code: admin
******************************************************************************

eav_entity_type

attribute_model:catalog/resource_eav_attribute

dev_com_mocommerce_maxwellshi

========================================================================================================================================
20130121:
Continue to configurate of server
1.config of appache: /opt/local/apache2
2.all var of environment of appale in the file: /opt/local/apache2/conf/envvars
3.all php,apc,mysql in the folder: /var/www/common/

Issue:images of product:

*table: catalog_product_entity_text:
value_id    entity_type_id    attribute_id    store_id    entity_id   value
501         4                 135             0           15          xxxxxx
->
entity_type_id=4 -> entity_type_code: catalog_product

select * from catalog_product_entity_text where entity_id = '15'
->
attribute_id:134: SHUO MING
attribute_id:135: LIANG DIAN *
attribute_id:147: TI SHI *
attribute_id:146: short SHUO MING : groupdeal_shortdesc

SELECT *
FROM `dev_com_mocommerce_maxwellshi`.`catalog_product_entity`
WHERE `entity_id` =15
->
*table: catalog_product_entity:
entity_id   entity_type_id    attribute_set_id    type_id   sku   has_options   required_options    created_at    updated_at
15          4                 9                   virtual   deal15  1             1                 2013-01-10    2013-01-10

*table: eav_entity_type
entity_type_id    entity_type_code    entity_model    attribute_model   entity_table    value_table_prefix additional_attribute_table   entity_attribute_collection
4                 catalog_product     catalog/product catalog/resource_eav_attribute  catalog/product      catalog/eav_attribute        catalog/product_attribute_collection
->
*table: catalog_eav_attribute
UPDATE `dev_com_mocommerce_maxwellshi`.`catalog_eav_attribute` SET `is_visible` = '0' WHERE `catalog_eav_attribute`.`attribute_id` =135;

->
Mage::getModel('catalog/product') that means get table: catalog_product
***catalog_eav_attribute store all attribute***
eav_attribute
db:  127.0.0.1  » dev_com_mocommerce_maxwellshi
(89, NULL, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, NULL, 0, 0, 0, 0),
->
SELECT *
FROM `eav_attribute`
WHERE `attribute_id` =135
AND `entity_type_id` =4
LIMIT 0 , 30

I know the code has not been produced by you, but I am giving hereby its ownership to you :).
Please fix it according to the TODOs I added in code as well as to our coding conventions.
->
In general, major task is to make all those widgets "dynamic" in terms of variable amount of input. Currently they are all only working with a predefined set of input data.
Besides that, they all have to follow our coding conventions, need to be localized (en/zh), should not be vulnerable for XSS etc.

///////////////////////////////////////////////////////////////////////////////
*/app/code/core/mage/adminhtml/controllers/catalog/productcontroller.php
*/app/code/community/devinc/groupdeals/controllers/adminhtml/groupdealscontroller.php
->_initProduct: initial product (mage & groupdeal)
all initial eav store in table:
* eav_attribute 存储attribute的基表 ->设置基本属性
* catalog_eav_attribute -> is_visible=1则后台显示
以上两张表存着 135 － 147 的attribute信息
上面的结果信息存储去table: catalog_product_entity_text
*locale issue:https://wiki.tmogroup.asia/
===================================================================================================================================
20130122

********************************************************************************************************************************************************************************************************
add a new attribute for groupdeal:
1.table: eav_attribute
INSERT INTO `eav_attribute` (`attribute_id`, `entity_type_id`, `attribute_code`, `attribute_model`, `backend_model`, `backend_type`, `backend_table`, `frontend_model`, `frontend_input`, `frontend_label`, `frontend_class`, `source_model`, `is_required`, `is_user_defined`, `default_value`, `is_unique`, `note`) VALUES
(NULL, 4, 'groupdeal_abc', NULL, NULL, 'text', NULL, NULL, 'textarea', 'GroupDeal ABC', NULL, NULL, 1, 1, NULL, 0, NULL)
2.table: catalog_eav_attribute
INSERT INTO `catalog_eav_attribute` (`attribute_id`, `frontend_input_renderer`, `is_global`, `is_visible`, `is_searchable`, `is_filterable`, `is_comparable`, `is_visible_on_front`, `is_html_allowed_on_front`, `is_used_for_price_rules`, `is_filterable_in_search`, `used_in_product_listing`, `used_for_sort_by`, `is_configurable`, `apply_to`, `is_visible_in_advanced_search`, `position`, `is_wysiwyg_enabled`, `is_used_for_promo_rules`) VALUES
(153, NULL, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 'simple,virtual,configurable,downloadable,ecoupon,eticket', 1, 0, 1, 0)
3.table: eav_entity_attribute:
INSERT INTO `eav_entity_attribute` (`entity_attribute_id`, `entity_type_id`, `attribute_set_id`, `attribute_group_id`, `attribute_id`, `sort_order`) VALUES
(null, 4, 9, 24, 153, 47)

attribute_code: groupdeal_fineprint attribute id: 134
frontend_label: Fine Print
********************************************************************************************************************************************************************************************************

layout:catalog.xml
    <adminhtml_catalog_product_edit>
        <update handle="editor"/>
        <reference name="content">
            <block type="adminhtml/catalog_product_edit" name="product_edit"></block>
        </reference>
        <reference name="left"> ***this part is key part of layout***
            <block type="adminhtml/store_switcher" name="store_switcher" before="-"></block>
            ***********<block type="adminhtml/catalog_product_edit_tabs" name="product_tabs"></block>***********
        </reference>
        <reference name="js">
            <block type="adminhtml/catalog_product_edit_js" template="catalog/product/js.phtml" name="catalog_product_js"></block>
            <block type="core/template" name="catalog.wysiwyg.js" template="catalog/wysiwyg/js.phtml"/>
        </reference>
    </adminhtml_catalog_product_edit>

/app/code/core/mage/adminhtml/block/catalog/product/edit/tabs.php
->this part is for default attribute of product
//                 $this->addTab('group_'.$group->getId(), array(
//                     'label'     => Mage::helper('catalog')->__($group->getAttributeGroupName()),
//                     'content'   => $this->_translateHtml($this->getLayout()->createBlock($this->getAttributeTabBlock(),
//                         'adminhtml.catalog.product.edit.tab.attributes')->setGroup($group)
//                             ->setGroupAttributes($attributes)
//                             ->toHtml()),
//                 ));
/app/code/core/mage/adminhtml/block/catalog/product/edit/tab/attributes.php
->_prepareForm() for detail of form
$group = $this->getGroup(); 产品包含的属性组
general,price,meta information,images,recurring profile,design,gift options,
      'attribute_group_id' => string '24' (length=2)
      'attribute_set_id' => string '9' (length=1)
      'attribute_group_name' => string 'General' (length=7)
      'sort_order' => string '1' (length=1)
      'default_id' => string '1' (length=1)
      ,
      'attribute_group_id' => string '23' (length=2)
      'attribute_set_id' => string '9' (length=1)
      'attribute_group_name' => string 'Prices' (length=6)
      'sort_order' => string '2' (length=1)
      'default_id' => string '0' (length=1)
      ,
      'attribute_group_id' => string '22' (length=2)
      'attribute_set_id' => string '9' (length=1)
      'attribute_group_name' => string 'Meta Information' (length=16)
      'sort_order' => string '3' (length=1)
      'default_id' => string '0' (length=1)
      ,
      'attribute_group_id' => string '21' (length=2)
      'attribute_set_id' => string '9' (length=1)
      'attribute_group_name' => string 'Images' (length=6)
      'sort_order' => string '4' (length=1)
      'default_id' => string '0' (length=1)
      ,
      'attribute_group_id' => string '20' (length=2)
      'attribute_set_id' => string '9' (length=1)
      'attribute_group_name' => string 'Recurring Profile' (length=17)
      'sort_order' => string '5' (length=1)
      'default_id' => string '0' (length=1)
      ,
      'attribute_group_id' => string '19' (length=2)
      'attribute_set_id' => string '9' (length=1)
      'attribute_group_name' => string 'Design' (length=6)
      'sort_order' => string '6' (length=1)
      'default_id' => string '0' (length=1)
      ,
      'attribute_group_id' => string '18' (length=2)
      'attribute_set_id' => string '9' (length=1)
      'attribute_group_name' => string 'Gift Options' (length=12)
      'sort_order' => string '7' (length=1)
      'default_id' => string '0' (length=1)
->
table: eav_attribute_group: 存放产品的属性组信息
attribute_group_id    attribute_set_id    attribute_group_name    sort_order    default_id
24                    9                   General                 1             1

****这个文件存储着后台groupdeal模块修改产品属性的内容，内容是定死的。原版产品属性应该是在数据库中定义：/app/code/community/Devinc/groupdeals/block/adminhtml/groupdeals/edit/tab/general.php
****这个文件是原版的修改产品属性的程序/app/code/core/mage/adminhtml/block/catalog/product/edit/tabs.php
if (!Mage::app()->isSingleStoreMode()) {
                $this->addTab('websites', array(
                    'label'     => Mage::helper('catalog')->__('Websites'),
                    'content'   => $this->_translateHtml($this->getLayout()
                        ->createBlock('adminhtml/catalog_product_edit_tab_websites')->toHtml()),
                ));
            }

********************************************************************************************************************************************************
前台产品展示页面修改相关:
reference page: http://www.magentocommerce.com/knowledge-base/entry/understanding-store-scopes
Layout定义文件: /app/design/frontend/ultimo/default/layout/local.xml
->
<block type="catalog/product_view_tabs" name="product.info.tabs" as="info_tabs" template="catalog/product/view/tabs.phtml" >
/app/design/frontend/ultimo/default/layout/infortis_custom.xml
->
<block type="catalog/product_view_tabs" name="product.info.tabs" as="info_tabs" template="custom/catalog/product/view/custom_tabs.phtml" >

bug: layout setting files was duplicated!!!!

local.xml
v.s.
infortis_custom.xml
->
1.change all template to custom/catalog/product/view/custom_tbs.phtml
catalog/app/code/core/mage/catalog/block/product/view/tabs.php
2.bug:**********addTab 都在layout.xml中设置********
3.************** groupdeal提交后用的是:local.xml catalog提交后用的是:infortis_custom **************
4.这个文件是前台产品展示页面具体的模块内容/app/design/frontend/ultimo/default/template/custom/catalog/product/view/groupdeal_highlights.phtml ********** 用这个文件逆推所有配置文件和程序

****这个文件存储着前台产品页面的展示内容：作者:ChunYin Tang: 纯手工页面
/app/design/frontend/ultimo/default/template/custom/catalog/product/custom_groupdeal_view.phtml （前台产品页面）
/app/design/frontend/ultimo/default/template/custom/catalog/product/custom_view.phtml（前台产品页面）

$groupdealsModel = Mage::getModel('groupdeals/groupdeals');
frontend/ultimo/default/template/custom/catalog/product/custom_groupdeal_view.phtml
frontend/ultimo/default/template/infortis/cloudzoom/product/view/media.phtml
frontend/ultimo/default/template/infortis/cloudzoom/product/view/lightbox_config.phtml
frontend/ultimo/default/template/custom/catalog/product/view/custom_tabs.phtml
frontend/ultimo/default/template/custom/catalog/product/view/groupdeal_description.phtml

attribute_code: groupdeal_fineprint
attribute_id: 134



/app/code/core/mage/cms/helper/page.php
->renderPage
->
For Translate: core_translate
Table: "core_translate" 也存储着翻译内容
core_translate v.s. locale/*.csv
->



//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
20130123:
1.Jing TMO Zhou <jing.zhou@tmogroup.asia>
2.helper of magento
3.pending issue: 5 link
->
/app/design/frontend/ultimo/default/template/custom/custom_left_homepage.phtml
sql:block_id IN (SELECT block_id FROM cms_block_store WHERE store_id = 3) AND identifier LIKE 'homepage_left%'
table: cms_block_store
可见内容是写s的，需要修改成动态调用的方式
->
********************************************************************************************************
文件/app/code/local/tmo/widget/etc/widget.xml存储着所有插件的配置信息 / widget means 小工具 /
********************************************************************************************************

About Helper:
it's rather simple and you have to call your helper from template like this:
Mage::helper('yourmodule/yourclassfile')->prtHelloWorld();
************************************************************************************
Default helper class is Data and this defaults to Yourmodule/Helper/Data.php
Mage::helper('yourmodule')->prtHelloWorld();
************************************************************************************
,
To add to Anton S's, if you want to be able to access the helper's function using $this->prtHelloWorld() in the phtml instead, add it to your Block like this:
public function prtHelloWorld() { return Mage::helper(whatever)->prtHelloWorld(); }
,
$helper = Mage::helper('catalog/product_compare');
,
默认的helper引入的是helper文件夹下面的data.php文件，但是以下样例说的是helper引入helper目录下的page.php文件
Mage::helper('cms/page')->renderPage($this, $pageId)
,
页面上打印输出文字时用“Mage::helper('module name')->__('内容')”输出,这样可以起到多语言版本！
eg: Mage::throwException(Mage::helper('cms')->__('A page URL key for specified store already exists.'));
->
Mage::helper('catalog')->__('Websites')
程序错误输出
eg: Mage::throwException();
,

************************************************************************************
???
Very good tutorial!
http://www.pierrefay.com/magento-developper-guide-howto-tutorial-5
http://www.pierrefay.com/magento-create-controller-36
http://www.magentocommerce.com/blog/comments/introducing-magento-widgets/
Very good tutorial!
,
Magento – Rewrite 运行机制:(need to check it more carefully)
http://hi.baidu.com/wolf_62/item/02a6f8d99bcd0310d68ed06d
http://blog.csdn.net/shangxiaoxue/article/details/8216970
,
???
,
command: rm -rf var/cache/* to empty whole cache!
Flush Magento Cache (for store in disk) / Flush Cache Storage (for store in memcached)
,
->
magento在后台form里面添加css和js
1.在后台创建的html元素，一般都是在function _prepareForm()里面调用addField；
$fieldset->addField('runfile', 'button', array(
            'name' => 'runfile',
            'style'=> $buttonstyle,//定义按钮的css
            'onclick'=>'runfile()',//js方法
            'value' => 'Run Profile',
        ));
2.field->setRenderer($this->getLayout()->createBlock('mode/adminhtml_dect_edit_renderer_html'));
3.after_element_html
    $addcomment->addField('rtype', 'radios',
            array(
                'label' => $this->__('Select Type'),
                /* 'class' => 'validate-one-required-by-name', */
                'name'  => 'rtype',
                'required' => true,
                'values' => array(array('label'=>'Masculino', 'value'=> 'M','class' => 'validate-genero'),array('label'=>'Feminino', 'value'=>'F')),
                /* double error message bug */
                'after_element_html' => '<script type="text/javascript">//js代码 </script>'
            )
     );
->

************************************************************************************************************************************************************************


http://www.magentocommerce.com/resources/magento-user-guide
,
setting different store in system->manage stores.
,
Magento Version: 1.7
,
tutorial:
folders 1:
Block : Where you go to the « controller » of your block
Controllers: the controllers of your module
Models: Performers of your module
Helper: of your helpers module
etc: the configuration of your module
sql: SQL query to execute to create your module during the instalation
,
folders 2:
folder / app / code:
Community: the plugins you have recovered (on magentoconnect for example).
Core: the default magento modules (especially not EDIT)
Local: the modules you have developed
,
config.xml that is in etc folder:
<?xml version="1.0"?>
  <config>
     <modules>
        <Pfay_Test>
          <version>1.0.0</version>
        </Pfay_Test>
     </modules>
     <frontend>
       <routers>
          <routeurfrontend>
              <use>standard</use>
              <args>
                 <module>Pfay_Test</module>
                 <frontName>test</frontName>
              </args>
           </routeurfrontend>
       </routers>
    </frontend>
</config>

************************************************************************************************************************************************************************

======================================================================================================================================================
20130124
Task:
1.find out controller of product view
->以下是程序初始化代码:
public function __construct()
{
    parent::__construct();
    echo 'i m here';
}
2.issue: #49
->
<img data-mce-src="http://mo-commerce.com.dev/skin/adminhtml/default/default/images/widget/default.gif"
alt=""
src="http://mo-commerce.com.dev/skin/adminhtml/default/default/images/widget/default.gif"
title="{widget type=&quot;tmo_widget_block_linkbox&quot; linkboxname=&quot;Home Link&quot; linkname1=&quot;Home&quot; link1=&quot;http://hilton.mo-commerce.com.dev&quot; linkname2=&quot;Latest&quot; link2=&quot;http://hilton.mo-commerce.com.dev/christmas-eve-buffet-dinner-at-hilton-shanghai-hongqiao.html&quot; linkname3=&quot;Recommended&quot; link3=&quot;http://hilton.mo-commerce.com.dev/christmas-eve-buffet-dinner-at-hilton-shanghai-hongqiao.html&quot; linkname4=&quot;Sale&quot; link4=&quot;http://hilton.mo-commerce.com.dev/thanksgiving-buffet-dinner-at-hilton-shanghai-hongqiao.html&quot; linkname5=&quot;Coupon&quot; link5=&quot;http://hilton.mo-commerce.com.dev/coupon.html&quot;}"
id="e3t3aWRnZXQgdHlwZT0idG1vX3dpZGdldF9ibG9ja19saW5rYm94IiBsaW5rYm94bmFtZT0iSG9tZSBMaW5rIiBsaW5rbmFtZTE9IkhvbWUiIGxpbmsxPSJodHRwOi8vaGlsdG9uLm1vLWNvbW1lcmNlLmNvbS5kZXYiIGxpbmtuYW1lMj0iTGF0ZXN0IiBsaW5rMj0iaHR0cDovL2hpbHRvbi5tby1jb21tZXJjZS5jb20uZGV2L2NocmlzdG1hcy1ldmUtYnVmZmV0LWRpbm5lci1hdC1oaWx0b24tc2hhbmdoYWktaG9uZ3FpYW8uaHRtbCIgbGlua25hbWUzPSJSZWNvbW1lbmRlZCIgbGluazM9Imh0dHA6Ly9oaWx0b24ubW8tY29tbWVyY2UuY29tLmRldi9jaHJpc3RtYXMtZXZlLWJ1ZmZldC1kaW5uZXItYXQtaGlsdG9uLXNoYW5naGFpLWhvbmdxaWFvLmh0bWwiIGxpbmtuYW1lND0iU2FsZSIgbGluazQ9Imh0dHA6Ly9oaWx0b24ubW8tY29tbWVyY2UuY29tLmRldi90aGFua3NnaXZpbmctYnVmZmV0LWRpbm5lci1hdC1oaWx0b24tc2hhbmdoYWktaG9uZ3FpYW8uaHRtbCIgbGlua25hbWU1PSJDb3Vwb24iIGxpbms1PSJodHRwOi8vaGlsdG9uLm1vLWNvbW1lcmNlLmNvbS5kZXYvY291cG9uLmh0bWwifX0-" _moz_resizing="true">
->
widgetTools.openDialog('http://mo-commerce.com.dev/index.php/admin/widget/index/key/768689f52e952d6e1063068a0cf9a7ac/widget_target_id/block_content')
->
remove limit of Linkbox,admin can add more custom links use magento text editor
->

all configuration of class rewrite:
original: /app/code/core/mage/adminhtml/block/cms/page/grid.php
rewrite: /app/code/local/tmo/cms/block/adminhtml/page/grid.php
tempate name in block control:adminhtml/cms/page/grid.php
->
    <blocks>
      <tmo_cms>
        <class>Tmo_Cms_Block</class>
      </tmo_cms>
      <adminhtml>
        <rewrite>
          <cms_block_grid>Tmo_Cms_Block_Adminhtml_Block_Grid</cms_block_grid>
          <cms_block_edit_form>Tmo_Cms_Block_Adminhtml_Block_Edit_Form</cms_block_edit_form>
          <cms_page_grid>Tmo_Cms_Block_Adminhtml_Page_Grid</cms_page_grid>
          <cms_page_edit_tab_main>Tmo_Cms_Block_Adminhtml_Page_Edit_Tab_Main</cms_page_edit_tab_main>
        </rewrite>
      </adminhtml>
    </blocks>
->
/app/code/core/mage/adminhtml/etc/config.xml:
    <layout>
      <updates>
        <adminhtml>
          <file>main.xml</file>
        </adminhtml>
        <report>
          <file>report.xml</file>
        </report>
        <catalog>
          <file>catalog.xml</file>
        </catalog>
        <customer>
          <file>customer.xml</file>
        </customer>
        <promo>
          <file>promo.xml</file>
        </promo>
      </updates>
    </layout>
以上这一部分设置了系统后台的layout!
->
/app/code/local/infortis/ultimo/etc/config.xml
由于系统使用的是ultimo模板所以，按理前台页面的layout配置信息应该存储在以上文件内，如果以上文件内没有layout信息。则默认的layout配置信息应该存储在以下文件内:
/app/design/frontend/ultimo/default/layout/local.xml这个文件里有记录页面布局的信息例如：
  <catalog_category_default>
    <reference name="root">
      <action method="setTemplate"><template>page/2columns-left.phtml</template></action>
    </reference>
->
前台定制首页的layout配置页面如下
Layout configure file of HOME PAGE: /app/design/frontend/ultimo/default/layout/infortis_custom.xml
前台首页配置区间
<cms_index_index></cms_index_index>
->
首页controller是/app/code/core/mage/cms/controllers/indexcontroller.php
->

产品页面的controller是<catalog_product_view>:
/app/code/core/mage/catalog/controllers/productcontroller.php -> viewAction();
/app/code/local/Tmo/Groupdeals/controllers/ProductController.php

block: catalog/product_view
系统最基本的page-layout存储在这个文件内/app/design/frontend/base/default/layout/page.xml
->
table:cms_page store the page of cms
->
dev_com_mocommerce_maxwellshi  » cms_page

<div class="nested-container">
    <div class="page-banners clearer">
        <div class="grid12-4 banner">
            <a href="{{store direct_url="#"}}" title="Replace this image with your own">
                <img src="{{media url="wysiwyg/infortis/ultimo/custom/banners/01.png"}}" alt="Sample banner" />
            </a>
        </div>
        <div class="grid12-4 banner">
            <a href="{{store direct_url="#"}}" title="Replace this image with your own">
                <img src="{{media url="wysiwyg/infortis/ultimo/custom/banners/02.png"}}" alt="Sample banner" />
            </a>
        </div>
        <div class="grid12-4 banner">
            <a href="{{store direct_url="#"}}" title="Replace this image with your own">
                <img src="{{media url="wysiwyg/infortis/ultimo/custom/banners/03.png"}}" alt="Sample banner" />
            </a>
        </div>
    </div>
</div>

Task:
1.老外的问号教程完成
2.carsten.schipke的todo完成
3.找出为什么首页的layout定制使用的是infortis_custom而不是local.xml
->首页定制流程：
1.在后台cms模块中先定义static block
2.前台再将模块调出依此显示（当前用sql语句控制区分不同区域的模块）

======================================================================================================================================================
20130125
table: cms_block 存储着cms页面静态block
table: widget_instance cms widget instance
table: cms_block_store 存储着cms block与store的对应关系
所以测试widget的的最好地方就是后台cms模块中创建static blocks

***&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&***
关于页面layout的使用，
1.页面定制的layout－>系统默认的layout（两套系统互相转换）
2.layout.xml中包含所有页面的定义信息，如果有rewite的模块则要对应的对rewrite的模块进行layou的定义
3.
***&&&***
所有的fucking base layout都存储在以下文件内：
1./app/design/frontend/base/default/layout/page.xml
<block type="page/html" name="root" output="toHtml" template="page/3columns.phtml">
->
2.
/app/design/frontend/base/default/layout/groupdeals.xml
<reference name="root">
<action method="setTemplate"><template>page/2columns-right.phtml</template></action>
</reference>
->
/app/design/frontend/default/default/layout/groupdeals.xml
<reference name="root">
<action method="setTemplate"><template>page/2columns-right.phtml</template></action>
</reference>
->
/app/design/frontend/ultimo/default/layout/infortis_custom.xml
->
<reference name="root">
<action method="setTemplate"><template>page/1column.phtml</template></action>
</reference>
->
***&&&***
***&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&******&&&***

{{widget type="tmo_widget_block_googlemap" phone_number="021-33236666" number="1116" street="Hongsong east road" city="Shanghai" hours="24 Hours" cards="unionpay,visa,maestro,mastercard" height="250"}}

======================================================================================================================================================
20130128
Create and set first template,not only xml but also oop:

1.block: Linkbox
2.block: map
3.block: company
<? echo "123";?>
<div class="block block-list">
<div class="block-title"><strong><span>
<?=Mage::helper('Widget')->__('Overview')?>
</span></strong></div>
<div class="borderwhite"></div>
<div class="block-content"><p><strong>
<?=Mage::helper('Widget')->__('Phone:')?>
</strong> <?=$this->getData('phone_number')?>
</p><p><strong>
<?=Mage::helper('Widget')->__('ADDRESS:')?>
</strong> <?=$this->getData('address')?> <?=$this->getData('city')?>
</p><p><strong>
<?=Mage::helper('Widget')->__('HOURS')?>
:</strong> <?=$this->getData('hours')?>
</p></div></div>
4.block: sinaweibo
5.socialmediaasia
6.socialwestern
7.image
8.and so on...
9.


Create templates for Tmo_Widget
Merge socialmediaasia with socialmediawestern
Localize of block:company
and some code update of Tmo_Widget

Tmo_Widget update:
Block:image,gallery,slideshow

 protected function _construct()
    {
      parent::_construct();

      $this->setTemplate('custom/widget/linkbox.phtml');
    }


{{widget type="tmo_widget_block_image" kop1="fi" image1="wysiwyg/com_mocommerce_hilton_en_us/com_mocommerce_hilton_en_us/en.png/en.png" kop2="si" image2="wysiwyg/com_mocommerce_hilton_en_us/com_mocommerce_hilton_en_us/en.png/en.png" kop3="ti" image3="wysiwyg/com_mocommerce_hilton_en_us/com_mocommerce_hilton_en_us/en.png/en.png" kop4="foi" image4="wysiwyg/com_mocommerce_hilton_en_us/com_mocommerce_hilton_en_us/en.png/en.png" kop5="fii" image5="wysiwyg/com_mocommerce_hilton_en_us/com_mocommerce_hilton_en_us/en.png/en.png"}}

MediabrowserUtility.openDialog('http://mo-commerce.com.dev/index.php/admin/cms_wysiwyg_images_chooser/index/target_element_id/options_fieldset35424cf4f59f87bff19a98618147d363_image1/key/75ebdf4df28d7366ea2dc5dda7630c4d/')
http://mo-commerce.com.dev/index.php/admin/cms_wysiwyg_images_chooser/index/target_element_id/options_fieldset35424cf4f59f87bff19a98618147d363_image1/key/75ebdf4df28d7366ea2dc5dda7630c4d
admin/cms_wysiwyg_images_chooser/index/target_element_id

wysiwyg images related file:
Controller: /app/code/core/mage/adminhtml/controllers/cms/wysiwyg/imagescontroller.php
Controller: /app/code/core/mage/adminhtml/controllers/cms/wysiwyg/imagescontroller.php
public function onInsertAction() 这个函数控制pop窗口到实际窗口的插入内容

Layout: /app/design/adminhtml/default/default/layout/aijko/widgetimagechoose.xml
Block: /app/code/core/mage/adminhtml/block/cms/wysiwyg/images/content.php

$("#fragment-<?=$key?>").show()
<?echo "$(\"#fragment-".$key."\").show()"?>

/app/code/community/devinc/groupdeals/model/coupons.php
->
$this->_init('groupdeals/coupons');
->
include(Devinc/Groupdeals/Model/Mysql4/Coupons.php)

->
This file is very very important of order:
/app/code/community/devinc/groupdeals/model/observer.php

dispatchEvent('sales_order_inv

/* coupon statuses
           1 Pending
          2 Used
          3 Refunded
          4 Expired
          5 Available
          6 Cancelled
          */
$coupon_status = 5;  // default coupon status is available

$items = $order->getItemsCollection();
$billaddress = $order->getBillingAddress();
$billaddress->getTelephone();
以上代码可以获取到bill中的telephone
$address = Mage::getModel('sales/order_address')->getCollection()->addFieldToFilter('customer_address_id','3')->getFirstItem();
echo $address->getTelephone();

****************************************************************************************************************************************
widget related:
Controller: /app/code/community/aijko/widgetimagechooser/controllers/adminhtml/cms/wysiwyg/images/choosercontroller.php
Block: /app/code/community/aijko/widgetimagechooser/block/chooser.php
Config: /app/code/community/aijko/widgetimagechooser/etc/config.xml
<admin>
    <routers>
        <adminhtml>
            <args>
                <modules>
                    <widgetimagechooser before="Mage_Adminhtml">Aijko_WidgetImageChooser_Adminhtml</widgetimagechooser>
                </modules>
            </args>
        </adminhtml>
    </routers>
</admin>
****************************************************************************************************************************************


CSS: /skin/adminhtml/default/default/boxes.css
JS: /js/mage/adminhtml/wysiwyg/tiny_mce/setup.js
JS: /js/mage/adminhtml/wysiwyg/widget.js

widget: image不能正常显示，应是js的问题-done.
widget: slideshow-done.
widget: gallery-done.

***********************************************************************************************************************************************

paypal:
<block type="checkout/onepage_payment_methods" name="checkout.payment.methods" as="methods" template="checkout/onepage/payment/methods.phtml">
<action method="setMethodFormTemplate"><method>purchaseorder</method><template>payment/form/purchaseorder.phtml</template></action>
</block>

block中的type表示action或者block的路径
block中的name
block中的as
block中的template
block中的action'smethod:addtab,addjs,setmethodformtemplate,settemplate...

***********************************************************************************************************************************************

20130130
http://stackoverflow.com/questions/12222601/make-magento-continue-shopping-button-redirect-to-the-last-added-to-cart-produ
http://shuimu.js.cn/magento-shopping-checkout-process-to-pay.html
http://shuimu.js.cn/magento-shopping-checkout-process-to-pay.html

Alipay Payment:
Gateway: www.alipay.com/cooperate/gateway.do
partner id: 2088601071646094/2088601071646094
security code: wyb3uyfq1lttxywtqx40zc1nh7uhn7dy/wyb3uyfq1lttxywtqx40zc1nh7uhn7dy
seller email:payment@juzine.com


restructure widget:
->
1.Company - done.
2.Image - done.
3.Linkbox - done.
4.map - done.
5.gallery - done.
6.slidshow.php - done.
7.weibo - done.
8.buttons - done.
,
{{widget type="tmo_widget_block_image" kop1="2222" image1="wysiwyg/com_mocommerce_hilton_en_us/de_de.png" kop2="1111" image2="wysiwyg/com_mocommerce_hilton_en_us/en.png"}}
,
public function getImage()
,
sales:存储着订单信息:
<block type="sales/order_history" name="sales.order.history">
frontend/base/default/template/customer/account/dashboard.phtml
->

,
Payment - paypal:
Task:
Test Checkout Process & Payment Provider Integration
- Order & Receive Coupon Code via SMS
- Order & Download Coupon
- Order, Pay (Alipay, Paypal) & Receive Voucher Code via SMS
- Order, Pay (Alipay, Paypal) & Download Voucher
- Order, Billing & Shipping Information, Pay Standard Product

付款的相关页面:
/app/code/core/mage/payment/block/form/container.php
,
/app/code/core/mage/payment/helper/data.php
->isAvailable是zend的基本函数
,
->isCurrencyCodeSupported in php: /app/code/core/mage/paypal/model/config.php
,

/app/code/core/mage/paypal/model/config.php
/app/code/local/tmo/paypal/model/config.php
/app/code/core/mage/payment/helper/data.php

,
table:
sales_flat_quote
sales_flat_quote_address
sales_flat_quote_item
,
sales_order_status

,
用户相关:
Table:
customer_entity
,
eg:
username: dominiek@tmogroup.asia
old_password: a0af83eeafd0e0b09a50016278067fbf:PQ (123456)

<translate>
    <modules>
        <Mage_Customer>
            <files>
                <default>Mage_Customer.csv</default>
            </files>
        </Mage_Customer>
    </modules>
</translate>

etc/config.xml的层级结构如下：
**********************************/app/code/core/mage/customer/etc/config.xml**********************************
config
  modules
    mage_customer
      version
  admin
    fieldsets
  global
    fieldsets
    customer
    blocks
    models
    resources
    template
    events
  adminhtml
    translate
      modules
        mage_customer
          files
            default

  frontend
    secure_url
    events
    routers
    layout
      updates
        customer module="Mage_Customer"
          file
    translate
      modules
        mage_customer
          files
            default
  default
    customer
      account_share
      create_account
      default
      password
      address
      startup
      address_templates
**********************************/app/code/core/mage/customer/etc/config.xml**********************************

/persistent--persistent is a special folder
/app/design/frontend/base/default/template/persistent/customer/form/register.phtml
$this->__('Create an Account') 在template中$this->__()这种方式也可以实现多语言支持

以下地址是用户创建地址:
http://hilton.mo-commerce.com.dev/customer/account/createpost/
,
======================================================================================================================================================
20130131
.DS_Store
.buildpath
.project
.settings/

original magento:

        Path "/Users/maxwellshi/workspace/magento_ori/app/etc" must be writable.
        Path "/Users/maxwellshi/workspace/magento_ori/var" must be writable.
        Path "/Users/maxwellshi/workspace/magento_ori/media" must be writable.
,
chmod -R 777 media/
,
打开模板
1,
INSERT INTO core_config_data SET scope = 'default', scope_id = 0,
            path = 'dev/debug/template_hints', value = 1;
INSERT INTO core_config_data SET scope = 'default', scope_id = 0,
            path = 'dev/debug/template_hints_blocks', value = 1;
Create a custom extension, and inside the etc folder create a system.xml file with the following contents.
?

<?xml version="1.0"?>
<config>
   <sections>
       <dev>
           <groups>
               <debug>
                   <fields>
                        <template_hints>
                            <show_in_default>1</show_in_default>
                            <show_in_website>1</show_in_website>
                            <show_in_store>1</show_in_store>
                        </template_hints>
                        <template_hints_blocks>
                            <show_in_default>1</show_in_default>
                            <show_in_website>1</show_in_website>
                            <show_in_store>1</show_in_store>
                        </template_hints_blocks>
                    </fields>
               </debug>
           </groups>
       </dev>
    </sections>
</config>
,
password: a123456
,
    /**
     * TODO Return all neccessary information in appropriate form.
     *
     * This method should prepare and return the images in a form that
     * the template (or other templates) can work with it.
     *
     * The template(s) or any external code should not call this method
     * for "initialization" of above member variables and then access
     * them directly.
     *
     * Btw. above members are declared as "protected" and should
     * therefor not be accessible for the template anyway.
     *
     * Also always escape any user data / generated content before sending it
     * to the client (XSS).
     *
     * @example Implementation
     * class Tmo_Widget_Block_Image_Gallery
     * {
     *   public function getImages()
     *   {
     *     array(
     $       imageUrl=>$this->escapeHtml($imageTitle),
     $         ...
     *      );
     *   }
     * }
     *
     * @example Template
     * <ul class="tmo_widget_image_gallery">
     *   <? foreach($this->getImages() as $url=>$title): ?>
     *     <li>
     *       <img src="<?= $url; ?>" alt="<?= $title; ?>" title="<?= $title; ?>"/>
     *     </li>
     *   <? endforeach; ?>
     * </ul>
     */

<ul class="ui-tabs-nav">
<? foreach ($this->getImageNav() as $key => $contents): ?>
<? if(isset($key)&&isset($contents)): ?>
<li class="ui-tabs-nav-item" id="nav-fragment-<?=$key?>"><a href="#fragment-<?=$key?>"><?=$contents?></a></li>
<? endif ?>
<? endforeach ?>
</ul>

<? foreach ($this->getImageNav() as $key => $contents): ?>
<? if(isset($key)&&isset($contents)): ?>
<div id="fragment-<?=$key?>" class="ui-tabs-panel">

<?=$this->_newImageArray_image[$key]?>
<div class="info">
<?=$this->_newImageArray_imagekop[$key]?>
</div>

</div>
<? endif ?>
<? endforeach ?>

/**
       * TODO Exceptions generate stack traces, fill memory, slow down script execution.
       *
       * Exceptions can be used very elegant, but not like this!
       * file_get_contents throws an internal error if something goes very very
       * bad - not a user exception. In case of an exception, file_get_contents
       * simply returns 'false'.
       *
       * So this code does not make sense. Always read PHP documentation - it
       * is VERY important to know exactly what internal methods return
       * what type/value in what situation
       * (eclipse shows that valuable information on mouse-over).
       *
       * This topic is also covered by our coding conventions (please read carefully):
       * https://wiki.tmogroup.asia/wiki/Coding_Style_%26_Conventions:_PHP#Assertions_.26_Conditions
       *
       * Possible solution:
       * To make sure the user does not receive a blank screen, you can
       * explicitly surpress the internal error and check the return value.
       *
       * @example
       * $contents=@file_get_contents($url);
       *
       * if(false===$contents)
       * {
       *   Error handling / logging / warning or notification to user...
       * }
       */


======================================================================================================================================================
20130201
username: admintmo
password: admintmo2012
url: juzine.com/admin
website: http://www.juzine.com/
website: http://www.juzine.com/admin/sales_order/view/order_id/717/
website: http://demo.mo-commerce.com/e-voucher-test.html
,
<!--SMS related begin//-->
SMS Provider

Carsten Schipke

TMO Group
Jiangning Road 495, room 2403
Jing'an District, Shanghai

e: carsten.schipke@tmogroup.asia

-------- Original Message --------
Subject:  [TMO-MOC] API Documentation SMS Provider + access
Date: Fri, 18 Jan 2013 18:24:44 +0800
From: Dominiek Pouwer <dominiek@tmogroup.asia>
To: Carsten Schipke <carsten.schipke@tmogroup.asia>

Dear Carsten,


Find below the details.

Login page:

http://10086.dxcx.com

Login: tmogroup
PW: tm0gr0up2011

See API documentation below.

Regards,

Dominiek

PS: it supports MT / MO so can be in the future also be used for SMS verification.



http://10086.dxcx.com
,

related:
/app/code/local/tmogroup/customerold/controllers/indexcontroller.php

<!--SMS related end//-->

git of juzine:
git@scm:/var/git/repositories/com.juzine.git
->
git clone scm:~/repositories/com.mo-commerce.git
git clone scm:~/repositories/com.juzine.git - it works
//

normal process of frontend page:
1. cms module.
1.1. page module.
1.2. page config.xml ****
->
<two_columns_left module="page" translate="label">
  <label>2 columns with left bar</label>
    <template>page/2columns-left.phtml</template>
  <layout_handle>page_two_columns_left</layout_handle>
</two_columns_left>
->
2. cms config.xml
3. cms cms.xml
************************************************************************
如果没有cms－page的overwrite，则系统使用page.xml中定义的all page中的template
************************************************************************

<reference name="content">
        <block type="catalog/product_new" name="home.catalog.product.new" alias="product_new" template="catalog/product/new.phtml" after="cms_page">
            <action method="addPriceBlockType">
                <type>bundle</type>
                <block>bundle/catalog_product_price</block>
                <template>bundle/catalog/product/price.phtml</template>
            </action>
        </block>
        <block type="reports/product_viewed" name="home.reports.product.viewed" alias="product_viewed" template="reports/home_product_viewed.phtml" after="product_new">
            <action method="addPriceBlockType">
                <type>bundle</type>
                <block>bundle/catalog_product_price</block>
                <template>bundle/catalog/product/price.phtml</template>
            </action>
        </block>
        <block type="reports/product_compared" name="home.reports.product.compared" template="reports/home_product_compared.phtml" after="product_viewed">
            <action method="addPriceBlockType">
                <type>bundle</type>
                <block>bundle/catalog_product_price</block>
                <template>bundle/catalog/product/price.phtml</template>
            </action>
        </block>
    </reference>
    <reference name="right">
        <action method="unsetChild"><alias>right.reports.product.viewed</alias></action>
        <action method="unsetChild"><alias>right.reports.product.compared</alias></action>
    </reference>

======================================================================================================================================================

20130204:
The old one sms provider: http://www.cosms.cn/index/
The new one sms provider: http://vip.dxcx.com/sms.aspx?action=send
,
sms related files:
/app/code/local/tmogroup/digitalmarketing/block/adminhtml/queue/grid.php
/app/code/local/tmogroup/digitalmarketing/controllers/adminhtml/smscontroller.php
/app/code/local/tmogroup/digitalmarketing/model/queue.php
/app/code/local/tmogroup/sms/helper/data.php
/sms/template/config.xml
In folder: /sms/
In file: receive_message.php

php文件保存为utf-8格式的，最终可顺利发送中英文的php程序是： cc.php(form.php - 是gb2312格式的)

cosms交互短信相关的tables:
1.log_mt_history
2.log_mt
3.log_mo_history
->
4.groupdeals_coupons
生成groupdeals_coupons后，用pincode从次表中找出相应数据
检测状态status,根据不同的状态通知用户
状态为5的话，则通过customer_id再找出客户的手机号码，并推送消息至最终客户
customer_id->attribute_id->mobile#
同时通知通知到请求客户
->
6.customer_entity
7.eav_attribute
8.customer_entity_varchar
->
hotel project's table:
customer_address_entity_varchar

Next step:
1.groupdeals_coupons条目的创建!
2.创建用户手机属性
3.groupdeals_coupons

DB username & password of http://www.juzine.com/phpMyAdmin/
User: juyougoumg
Password: LeycZ9Rr

coupon_id   groupdeals_id   order_id  customer_id   product_id  coupon_code   pincode   created_at  last_updated  email_sent  sms_sent  status
2080  284   718   1107  313   -488-130131-1(自动生成，短信中的单号)   70935272(自动生成，短信中的密码)  2013-02-05 14:39:12   2013-02-05 14:39:12   0   0   5

  coupon_code: -488-130131-1
  pincode: 70935272

  http://hilton.mo-commerce.com.dev/checkout/onepage/
  http://hilton.mo-commerce.com.dev/checkout/onepage/

  sku:shanghai-red-bee-leasing-car-rental-3 -> sku信息存储再table: catalog_product_entity

  *****当用户下单成功后向 groupdeals_coupons 中操作插入数据*****

related file:
mage/OnepageController.php
/skin/frontend/base/default/js/opcheckout.js

frontend/base/default/template/checkout/onepage/payment.phtml
在核心参数设置表core_config_data中可以设置付款方式

onepagecontroller.php

/app/code/core/mage/checkout/model/type/onepage.php ->savePayment()
/app/code/core/mage/checkout/controllers/onepagecontroller.php -> saveOrderAction()

/app/design/frontend/base/default/template/checkout/cart/coupon.phtml 购物车模板
/app/code/local/tmogroup/dbupdate/sql/dbupdate_setup/mysql4-install-0.1.0.php table: groupdeals_coupons 更新sql语句

/app/code/core/mage/salesrule/model/coupon/codegenerator.php coupon_code generator -> generateCode()
/app/code/community/devinc/groupdeals/controllers/couponscontroller.php

/app/code/core/mage/salesrule/model/rule.php -> acquireCoupon

/app/code/community/devinc/groupdeals/etc/config.xml

======================================================================================================================================================

table: core_config_ata
table:

/app/code/core/mage/core/block/text/list.php

.buildpath
.project
.settings
resource
source

通常Static Blocks放入在layout/cms.xml

********************************************************************************************************************************************************
20130208
1.
/app/code/local/tmo/cms/block/adminhtml/block/edit/form.php
2.
/app/code/local/tmo/security/model/resource/collection/managed.php
3.
/app/code/local/tmo/newsletter/block/adminhtml/newsletter/edit/tab/basic.php
4.
/app/code/local/tmo/newsletter/model/resource/content/collection.php
5.
/app/code/local/tmo/security/model/resource/collection/managed/abstract.php
6.
/app/code/local/tmo/cms/model/resource/block/collection.php
7.
/app/code/local/tmo/security/block/widget/grid/column/filter/relationship.php
8.
/app/code/local/tmo/security/block/widget/grid/column/renderer/relationship/12n.php
9.
/app/code/local/tmo/security/block/widget/grid/column/renderer/relationship/12n/store.php
10.
/app/code/local/tmo/cms/block/adminhtml/block/grid.php
11.
/app/code/local/tmo/cms/block/adminhtml/block/edit/form.php
12.
/app/code/local/tmo/groupdeals/model/coupons.php
13.
/app/code/local/tmo/groupdeals/etc/config.xml
14.
/app/code/local/tmo/groupdeals/model/mysql4/coupons/collection.php
15.
/app/code/community/devinc/groupdeals/model/mysql4/coupons/collection.php
16.
/app/code/local/tmo/security/block/form/element/relationship/12n.php
17.
/app/code/local/tmo/security/helper/data.php
18.
/app/code/local/tmo/groupdeals/model/groupdeals.php
19.
sql -> core_resource
20.
/app/code/local/tmo/security/block/form/element/relationship/m2n.php
21.
/app/code/local/tmo/security/block/form/element/relationship/m2n/store.php
22.
/app/code/local/tmo/security/block/form/element/relationship/12n/store.php
23.
/app/code/local/tmo/cms/model/resource/block.php
24.
/app/code/community/devinc/groupdeals/helper/data.php
25.
/app/code/community/devinc/groupdeals/controller/adminhtml/couponscontroller.php

related url
http://docs.magentocommerce.com/
http://blog.csdn.net/column/details/magentoyipyip.html?page=2#6592657
http://alloyteam.github.com/

如何删除magento后台的订单（order）详解
TRUNCATE TABLE `sales_flat_invoice_grid`;
TRUNCATE TABLE `sales_flat_invoice_item`;
TRUNCATE TABLE `sales_flat_order`;
TRUNCATE TABLE `sales_flat_order_address`;
TRUNCATE TABLE `sales_flat_order_grid`;
TRUNCATE TABLE `sales_flat_order_item`;
TRUNCATE TABLE `sales_flat_order_payment`;
TRUNCATE TABLE `sales_flat_order_status_history`;
TRUNCATE TABLE `sales_flat_shipment`;
TRUNCATE TABLE `sales_flat_shipment_grid`;
TRUNCATE TABLE `sales_flat_shipment_item`;
TRUNCATE TABLE `sales_flat_shipment_track`;
TRUNCATE TABLE `sales_payment_transaction`;

Task:
1.add two colunms of table: groupdeals_coupons :product_id, telephone
product_id->sku#

2.remove no need functions of manager coupons
3.security module apply
4.ailipy
5.

＊
deal manager 中 同时搜索name和city的时候报错

********************************************************************************************************************************************************
========================================================================================================================================================================
20130216
1.Install ultimo theme - done.
- chmod -R 777 skin/frontend/ultimo/default/css/_css/
2.original search function in backend:(module: Customers)
-
Template:
1).adminhtml/default/default/template/widget/grid/container.phtml
2).adminhtml/default/default/template/widget/grid.phtml
3).adminhtml/default/default/template/widget/grid/massaction.phtml
4).adminhtml/default/default/template/formkey.phtml
Controller:
admin/customer/index/
Block:
没有特殊说明，block默认都是进入grid
Work on below:
<adminhtml_customer_group_index>
        <reference name="content">
            <block type="adminhtml/customer_group" name="customer_group"></block>
        </reference>
    </adminhtml_customer_group_index>
rewrite this block - done.
adminhtml controller rewrite method:eg:
<!-- Admin Router -->
<admin>
  <routers>
    <adminhtml>
      <args>
        <modules>
          <max_customer before="Mage_Adminhtml">Max_Customer_Adminhtml</max_customer>
        </modules>
      </args>
    </adminhtml>
  </routers>
</admin>


3.
apply security module to coupons
.community/Devinc/Groupdeals/*.*
->
/local/tmo/groupdeals/model/coupons.php
/local/tmo/groupdeals/model/mysql4/coupons.php
/local/tmo/groupdeals/model/mysql4/coupons/collection.php
/local/tmo/groupdeals/etc/config.xml
->

///////////////////////////////////////////////////
Next NameSpace:
/local/Tmo/ContactManager/
这里面储存这store的控制信息
table:
1.tmo_contactmanager_contact_types_core_store 此表储存着store与管理员之间的对应关系
2.admin_user
3.and so on
4.

<models>
      <tmo_security>
        <class>Tmo_Security_Model</class>
        <resourceModel>tmo_security_mysql</resourceModel>
      </tmo_security>
      <tmo_security_mysql>
        <class>Tmo_Security_Model_Mysql</class>
        <entities>
          <permission>
            <table>tmo_security_permissions</table>
          </permission>
        </entities>
      </tmo_security_mysql>
      <events>
        <class>Tmo_Security_Model</class>
      </events>
    </models>

///////////////////////////////////////////////////

**************************************************************************************************
管理员与store的对应关系在：
system->permissions->roles->role stores
对应的name space就是: /local/Tmo/Security/*.*
table:tmo_security_permissions (此表中存储着不同角色role与store之间的对应关系)
Step one:
直接比照表内容，存在则显示，反之则不显示

Add tmo_security_permissions for "Manager Coupons" in backend
reference web page:
http://fishpig.co.uk/blog/direct-sql-queries-magento.html

**************************************************************************************************

========================================================================================================================================================================
20130217
Task:
1.Implement tmo_security_permissions from exist tmo - done.
related files:
tmo/groupdeals/model/coupons.php
tmo/groupdeals/model/mysql4/coupons.php
tmo/groupdeals/model/mysql4/coupons/collection.php
tmo/groupdeals/etc/config.xml (rewrite the models -> <coupons>Tmo_Groupdeals_Model_Coupons</coupons>)

Old codes:
//get permission list from table: tmo_security_permissions begin
    $roleid = Mage::getModel('admin/Session')->getUser()->getRole()->getRoleId();
    $resource = Mage::getSingleton('core/resource');
    $readConnection = $resource->getConnection('core_read');
    $query = 'SELECT * FROM ' . $resource->getTableName('tmo_security_permissions'). ' Where admin_role_id = '.$roleid;
    $results = $readConnection->fetchAll($query);
    foreach ($results as $key => $value)
    {
      if(15==$value['privileges'])
      $storeArray[] = $value['value'];
    }

$collection = Mage::getModel('Tmo_Security_Model_Permission')->getCollection()->addFieldToFilter('admin_role_id', 1)->addFieldToFilter('privileges', 15);
$data = $collection->getData();
var_dump($data);die();
->
以上代码通过magento方式达到同样的效果

********************************************************************
/lib/varien/data/collection.php
非常重要的文件，储存着基本的data collection方式
********************************************************************

//get permission list from table: tmo_security_permissions end
//$coupons_collection->addFieldToFilter('store_id',$storeArray);


SQL:

CREATE TABLE IF NOT EXISTS `groupdeals_coupons` (
  `coupon_id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `groupdeals_id` int(11) NOT NULL,
  `order_item_id` int(11) DEFAULT NULL,
  `customer_id` int(11) NOT NULL,
  `store_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Store Id',
  `sku` varchar(64) NOT NULL,
  `telephone` varchar(255) NOT NULL,
  `coupon_code` varchar(255) NOT NULL DEFAULT '',
  `redeem` varchar(255) DEFAULT NULL,
  `pincode` varchar(255) NOT NULL,
  `created_at` datetime NOT NULL,
  `last_updated` datetime NOT NULL,
  `email_sent` int(11) NOT NULL,
  `sms_sent` int(11) NOT NULL,
  `status` int(255) NOT NULL DEFAULT '1',
  PRIMARY KEY (`coupon_id`),
  KEY `fk_groupdeals_coupons_core_store` (`store_id`),
  UNIQUE KEY `pincode` (`pincode`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 ;

ALTER TABLE `groupdeals_coupons`
  ADD CONSTRAINT `fk_groupdeals_coupons_core_store` FOREIGN KEY (`store_id`) REFERENCES `core_store` (`store_id`) ON DELETE SET NULL ON UPDATE CASCADE;

<?php
$installer = $this;

$installer->startSetup();
$installer->run("
ALTER TABLE {$this->getTable('groupdeals_coupons')}
    ADD CONSTRAINT `fk_groupdeals_coupons_core_store` FOREIGN KEY (`store_id`)
    REFERENCES {$this->getTable('core_store')} (`store_id`)
        ON UPDATE CASCADE
        ON DELETE SET NULL;
");

$installer->endSetup();
?>

ALTER TABLE articles DROP FOREIGN KEY fk_groupdeals_coupons_core_store;

INSERT INTO `groupdeals_coupons` (`coupon_id`, `groupdeals_id`, `order_item_id`, `customer_id`, `store_id`, `sku`, `telephone`, `coupon_code`, `redeem`, `pincode`, `created_at`, `last_updated`, `email_sent`, `sms_sent`, `status`) VALUES
(9, 12, 164, 19, 5, '123', '18621798517', '27645509', 'not_used', '26547538', '2013-02-17 10:49:35', '2013-02-08 16:02:03', 1, 1, 5),
(10, 12, 171, 19, 5, 'deal16', '18621798517', '74431349', 'not_used', '35309718', '2013-02-08 16:14:09', '2013-02-08 16:14:09', 1, 1, 5),
(11, 12, 172, 19, 3, 'deal16', '18621798517', '07498685', 'not_used', '68962296', '2013-02-16 15:40:36', '2013-02-16 15:40:35', 1, 1, 5),
(12, 12, 183, 19, 3, 'deal16', '18621798517', '86547448', 'not_used', '39026618', '2013-02-16 16:20:14', '2013-02-16 16:20:14', 1, 1, 5),
(13, 12, 186, 19, 4, 'deal16', '18621798517', '73170295', 'not_used', '12364594', '2013-02-16 16:26:44', '2013-02-16 16:26:43', 1, 1, 5);

Task 2:

reference:
/app/code/core/mage/customer/model/resource/customer/collection.php 这个文件就是addNameToSelect()的来源！！！搞定她！！！
public function addNameToSelect()

Know how to work about the addFieldToFilter getCollection()后设置查询条件 -done.
Know what is Mage::getSingleton( Mage::getSingleton('admin/session') -> //trying to load EC/Custom/Model/Blah.php -> Mage::getSingleton('EC_Custom_Model_Blah');
与Mage::getModel('groupdeals/coupons')起到载入model几乎一致,除去线程上的不同 -done.
Know what is Mage::registry( Mage::registry($registryKey) -holding.
Know what is Mage::getConfig() -

========================================================================================================================================================================
20130218
Related files:
->
/community/devinc/groupdeals/block/adminhtml/coupons/grid.php
/community/devinc/groupdeals/sql/groupdeals_setup/mysql4-upgrae-0.1.3.2-0.1.3.3.php
->
/local/tmo/groupdeals/model/mysql4/coupons/collection.php
/local/tmo/groupdeals/etc/config.xml
->
/local/tmo/contactmanager/model/mysql/contact/collection.php
/local/tmo/contactmanager/block/adminhtml/contact/groups/grid/contacts.php
/local/tmo/contactmanager/block/adminhtml/contact/groups/edit.php
/local/tmo/contactmanager/block/adminhtml/contact/groups/edit/form.php
/local/tmo/contactmanager/block/adminhtml/contact/groups/overview.php
/local/tmo/contactmanager/model/mysql/contact.php
/local/tmo/contactmanager/model/contact.php
/local/tmo/contactmanager/block/adminhtml/contacts/overview.php
/local/tmo/contactmanager/block/adminhtml/contacts/overview/grid.php
/local/tmo/contactmanager/block/adminhtml/contacts/edit.php
/local/tmo/contactmanager/block/adminhtml/contacts/edit/form.php
/local/tmo/contactmanager/block/adminhtml/contacts/edit/tab/basic.php

*********************************************************************************************************************************************************************

OOP
->
Object-Oriented Programming very interesting!!!

*********************************************************************************************************************************************************************

Tasks:
1.Become familiar with the tmo_security_permissions. (Very good learn case for object oriented programming!)
Tmo/security/permissions(model)

***********************
step one:
/etc/config.xml
***********************
->layout
->rewrite
->before=
->model
<models>
<tmo_security>
<class>Tmo_Security_Model</class>
<resourceModel>tmo_security_mysql</resourceModel>
</tmo_security>

<tmo_security_mysql>
<class>Tmo_Security_Model_Mysql</class>
<entities>
<permission>
<table>tmo_security_permissions</table>
</permission>
</entities>
</tmo_security_mysql>

<events>
<class>Tmo_Security_Model</class>
</events>
</models>
->block
<blocks>

<tmo_security>
<class>Tmo_Security_Block</class>
</tmo_security>

<adminhtml>
<rewrite>
<permissions_editroles>Tmo_Security_Block_Adminhtml_Permissions_Roles_Edit</permissions_editroles>
</rewrite>
</adminhtml>

</blocks>
->helpers
->events
->and so on
***********************
step two:
layout.xml
***********************
step three:Models:
***********************
->Tmo_Security_Model_Relationship
->
Above class is the root class of Tmo_Security_Model_Relationship
abstract 抽象的 class Tmo_Security_Model_Relationship
->related books:
[1] Thinking in Java, Bruce Eckel
[2] Design Patterns Explained: A New Perspective on Object-Oriented Design, Alan Shalloway and James R. Trott
[3] Effective C++: 50 Specific Ways to Improve Your Programs and Design, Scott Meyers
->notes:
1.instanceof用来检测一个给定的对象是否属于（继承于）某个类（class）、某个类的子类、某个接口（interface）。如果是则返回true。
2.base class: Mage_Core_Model_Abstract related: Mage::getModel
->getIdFieldName = get Pk = get primate key
3./local/tmo/security/model/resource/collection/managed/abstract.php 一般此类abstract文件相当于初始化类
->
abstract class Tmo_Security_Model_Resource_Collection_Managed_Abstract
extends Mage_Core_Model_Resource_Db_Collection_Abstract (this one indicate where the class is from)
implements Tmo_Security_Model_Resource_Collection_Managed (use same interface)
->
Grid:
Mage::helper('tmo_security')->addRelationshipToGrid($this, Tmo_Security_Model_Relationship_Managed_12N_Store::NAME);
throw new Exception('[tmo/security/helper] Expected resource collection of type Tmo_Security_Model_Resource_Collection_Managed.');

Relationship class instance process->

/local/tmo/security/model/relationship/managed/12n.php
__construct(
1.$name_,
2.$permission_,
3.Mage_Core_Model_Resource_Db_Collection_Abstract $resource_,
4.Mage_Core_Model_Resource_Db_Collection_Abstract $foreignResource_,
5.$foreignKey_=null,
6.$title_=null)
parent::__construct(
1.$name_,
3.$resource_,
4.$foreignResource_,
5.$foreignKey_,
6.$title_);
->
/local/tmo/security/model/relationship/12n.php
__construct(
1.$name_,
3.Mage_Core_Model_Resource_Db_Collection_Abstract $resource_,
4.Mage_Core_Model_Resource_Db_Collection_Abstract $foreignResource_,
5.$foreignKey_=null,
6.$title_=null)
{
parent::__construct(
1.$name_,
3.$resource_,
4.$foreignResource_,
6.$title_);
->
/local/tmo/security/model/relationship.php
__construct(
1.$name_,
3.$resource_,
4.$foreignResource_,
6.$title_)
-->
bacause:
/local/tmo/groupdeals/model/mysql4/coupons/collection.php -> addRelationship
->
/local/tmo/security/model/relationship/managed/12n/store.php
->
public static function create(Mage_Core_Model_Resource_Db_Collection_Abstract $resource_,
      $foreignKey_=self::STORE_KEY, $title_=self::TITLE)
$instance=new self(
        1.self::NAME,
        2.Tmo_Security_Model_Permission_Store::NAME,
        3.$resource_,
        4.Mage::getModel(self::STORE_MODEL)->getCollection(),
        5.$foreignKey_,
        6.$title_
      );
->
below is related above
object(Tmo_Security_Model_Relationship_Managed_12N_Store) = Tmo_Security_Model_Relationship_Managed_12N_Store
->
/local/tmo/security/model/relationship/managed/12n/store.php
initial filter and renderer for grid
->
"
const TYPE_GRID_COLUMN_FILTER_STORE='Tmo_Security_Block_Widget_Grid_Column_Filter_Relationship_12N_Store';
const TYPE_GRID_COLUMN_RENDERER_STORE='Tmo_Security_Block_Widget_Grid_Column_Renderer_Relationship_12N_Store';
"
->
/local/tmo/groupdeals/model/mysql4/coupons/collection.php
"
private $m_fields=array();
private $m_relationships=array();
"
以上为本类的自有变量，外部通过以下公有函数获得:
"
public function getFields()
public function getRelationships()
"
->
Next Step: Tmo_Security_Block_Widget_Grid_Column_Renderer_Relationship_12N_Store
->
public function render(Varien_Object $row_)
->
KEY FUNCTION: Mage::helper('tmo_security')->getStoreOptions(true, false, false, true);
getStoreOptions
由以上的函数创建了新的数组（范围数组），这个数组又和data之间的某个对应的key（store_id）之间有着联系，最终对应区别输出内容。
>
************************************************************************************************************************
getStoreOptions这是一个将同一项目存储在不同表内的内容拼接在一起的函数，同时此函数还包含帐号与store,permission之间关系验证的功能good case!
************************************************************************************************************************
/local/tmo/security/helper/data.php ->
public function getStoreOptions($flat_=true, $includeAdmin_=true, $includeWebsite_=true, $includeGroup_=true)
>
->
/code/core/mage/adminhtml/model/system/store.php
$this->_storeCollection = Mage::app()->getStores();
public function getStoreData($storeId) return Object: Mage_Core_Model_Store
return 的是 Object 则可以用 get"collumn"() 获得数据
而可以使用这种方式的class都是 extends from Varien_Object
->
/local/tmo/security/model/authority.php root class Tmo_Security_Model_Authority->
/local/tmo/security/model/permission/store.php extends from->
/local/tmo/security/model/permission.php->
public function getPrivileges(Mage_Admin_Model_User $user_=null)
以上函数返回从表“tmo_security_permissions”中获得当前用户store-permission的对应关系!(fetchAll)
getPrivileges函数中同样包含着原始的magento原始sql查询方式：
$query=sprintf(
  'SELECT value,privileges FROM %1$s WHERE name = \'%2$s\' AND admin_role_id IN (%3$s)',
  $this->getResource()->getMainTable(),
  $this->getName(),
  implode(',', Mage::helper('tmo_security')->getUserRoleIds($user_))
);
$stmt=$this->getResource()->getReadConnection()->query($query);
$this->m_cacheUserPrivileges[$user_->getId()][$this->getName()]=$stmt->fetchAll(PDO::FETCH_KEY_PAIR);
->
getStoreOptions->中包含的magento的另一种sql查询方式:
$connection=$modelStoresResource->getResource()->getReadConnection();
$stmt=$connection->query(sprintf('SELECT * FROM %1$s WHERE %2$s IN ( %3$s )',
  $modelStoresResource->getCollection()->getMainTable(),
  $modelStoresResource->getIdFieldName(),
  implode(',', array_keys($privileges))
));
$records=$stmt->fetchAll(PDO::FETCH_ASSOC);
以上sql语句含义是：从表core_store中找出用户有权限的store信息！
->
implode(',', array_keys($privileges))
分解数组by','->eg.->string '1,2,3,5';
->
SELECT * FROM %1$s WHERE %2$s IN ( %3$s )
->
在第一个参数%1$s中查找，当第二个参数%2$s在第三个参数%3$s中
第三个参数%3$s应该是逗号分割的字符串
->
foreach($records as $record)
{
  $path=array();
  if($includeWebsite_)
    $path[]=$this->escapeHtml($websites[$record['website_id']]);
  if($includeGroup_)
    $path[]=$this->escapeHtml($groups[$record['group_id']]);

  $path[]=$this->escapeHtml($record['name']);

  $stores[$record['store_id']]=implode(' / ', $path);
}
->
以上是不同store的拼接函数
->
asort() 函数对数组进行排序并保持索引关系。主要用于对那些单元顺序很重要的结合数组进行排序。
->
getStoreOptions ->return $stores;
->
Next Step:
Filter: Tmo_Security_Block_Widget_Grid_Column_Filter_Relationship_12N_Store
***********************************************************************************
KEY FUNCTION: Mage::helper('tmo_security')->getStoreOptions(
          true, false, false, true, $this->m_emptyOption
        );
So,other grid function should be follow the structure of this above function
***********************************************************************************
Very Good Learn Case!

So->
1.let's rewrite grid by tmo/groupdeals/coupons:) -done.
2.open sql file in tmo_groupdeals -
1.
<resources>
<coupons_setup>
    <setup>
        <module>Tmo_Groupdeals</module>
        <class>Mage_Customer_Model_Entity_Setup</class>
    </setup>
    <connection>
        <use>core_setup</use>
    </connection>
</coupons_setup>
<groupdeals_write>
    <connection>
        <use>core_write</use>
    </connection>
</groupdeals_write>
<groupdeals_read>
    <connection>
        <use>core_read</use>
    </connection>
</groupdeals_read>
</resources>
2.
insert data to table: core_resource
3.
do sql file like before
-done.
P.S.
Grid 中 $coupons_collection = Mage::getModel('groupdeals/coupons')->getCollection(); 到这一步还是groupdeals/coupons中所有的数据
程序是在？

/local/tmo/security/etc/config.xml
->
  <events>
    <class>Tmo_Security_Model</class>
  </events>
</models>

<!-- Observer(s) -->
<events>
  <model_save_before>
    <observers>
      <tmo_security_model_observer_auditing>
        <type>singleton</type>
        <class>events/observer_auditing</class>
        <method>beforeSave</method>
      </tmo_security_model_observer_auditing>
    </observers>
  </model_save_before>

  <core_collection_abstract_load_before>
    <observers>
      <tmo_security_model_observer_authority>
        <type>singleton</type>
        <class>events/observer_authority</class>
        <method>beforeLoad</method>
      </tmo_security_model_observer_authority>
    </observers>
  </core_collection_abstract_load_before>
</events>

设置初始化observers
<core_collection_abstract_load_before>
  <observers>
    <tmo_security_model_observer_authority>
      <type>singleton</type>
      <class>events/observer_authority</class>
      <method>beforeLoad</method>
    </tmo_security_model_observer_authority>
  </observers>
</core_collection_abstract_load_before>
->
/local/tmo/security/model/authority.php -> public function manage(Tmo_Security_Model_Resource_Collection_Managed $resource_)
以上函数起最终过滤作用
->

20130219
Task:
1.find out /local/tmo/security/model/authority.php function manage and so on.

/lib/varien/data/collection/filesystem.php
public function addFieldToFilter($field, $cond, $type = 'and')
addFieldToFilter->基本函数 / $field表中的column值 / $cond是条件 / $type is type
eg.:
$resource_->addFieldToFilter($relationship_->foreignKey, array('in'=>array_keys($privileges)));
$relationship_->foreignKey ->
'store_id'
array('in'=>array_keys($privileges) ->
array (size=1)
  'in' =>
    array (size=5)
      0 => int 0
      1 => int 1
      2 => int 2
      3 => int 3
      4 => int 5
所以$resource_->addFieldToFilter(这个才是实际的数据过滤函数
1.$resource_是groupdeals_coupons的的初始化model
2.对store_id进行过滤
3.过滤条件是store_id应该在(in)从表中tmo_security_permissions对应找出的此帐号对应的store_id
－done.
P.S.
/lib/varien/data/collection/filesystem.php 文件中包含db操作方式

2.work out filter function for name

M.A.R.C. van
Dam
+86 186-2165-4606
Current Location :  Netherlands
Phone: 31623528195
Email:  styley@gmail.com / Marinco.van.Dam@gmail.com
Multiple years of working experience in e-commerce.
   Extended experience with web browser version compatibility, especially IE.
   Advanced knowledge of HTML, CSS, PHP, Java, C#, .NET, MySQL/MSSQL, JavaScript, XML, JSON, jQuery and Ajax.
   Moderate experience with HTML5.
   Ability to completely code by hand (no WYSIWYG) The opportunity to work for TMO Group Co. Ltd.
  WYSIWYG（所见即所得） 是 What You See Is What You Get 的首字母缩略词。
Desired Position /Career Objective: I am an ambitious professional who is looking to work in China for at least 5 years. I have recently moved to Shanghai and am available for job interviews. Interested in: Project Management, Software Engineering, Website Development, Medical Applications.
////

/local/tmo/groupdeals/block/adminhtml/coupons/grid/column/filter/name.php
public function setColumn($column_)
$column_->setData('filter_condition_callback', array($this, 'onFilter'));
->filter_condition_callback
->array($this, 'onFilter')->onFilter->function onFilter()
以上部分是filter起作用的主要函数,固定写法，没有花头!
******
$collection->addFieldToFilter('coupon_id',array('in',array('12')))
    ->getSelect()->where(sprintf('1=1'))->group(sprintf('customer_id'));

    var_dump($connection->getColumnValues('store_id'));
    var_dump($collection->getData());die();
some sql like above!

**********************************************************************************************************************************************************************************************************
reference:
？？？一定要看的资料？？？
http://tope.me/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3magento-%E7%AC%AC%E4%B8%80%E7%AB%A0-magento%E5%BC%BA%E5%A4%A7%E7%9A%84%E9%85%8D%E7%BD%AE%E7%B3%BB%E7%BB%9F.html
http://tope.me/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3magento-%E7%AC%AC%E4%B8%80%E7%AB%A0-magento%E5%BC%BA%E5%A4%A7%E7%9A%84%E9%85%8D%E7%BD%AE%E7%B3%BB%E7%BB%9F.html
**************************************************************************************************************************************************************************************************************************

http://www.juzine.com/
Account of backend:
user:admintmo
password:admintmo2013
->
eton/1234567t

========================================================================================================================================================================
20130220
Task:
1.complete, improve filter function -done.
1.1. complete -done.
1.2. improve -> remember submit data -> value="<?=$this->getValue()?>" -done.

2.other functions of grid
/local/tmo/groupdeals/block/adminhtml/coupons/grid.php
->
protected function _prepareMassaction()
以上函数是控制grid mass action的主控制函数

Controller:
/devinc/groupdeals/controllers/adminhtml/couponscontroller.php
public function massStatusAction()
Mass Controller ->
2.1. change status -done.
2.2. send email -





reference:
命名的规则
  加一个为公有的
  加两个一般都是系统默认的，系统预定义的，即所谓：
=====================
“魔术方法”与“魔术常量”
=====================
★PHP起止为双下划线的常量即为“魔术常量”：
__LINE__文件中的当前行号。
__FILE__文件的完整路径和文件名。
__DIR__文件所在的目录。如果用在被包括文件中，则返回被包括的文件所在的目录。它等价于 dirname(__FILE__)。除非是根目录，否则目录中名不包括末尾的斜杠
,
php规定以两个下划线（__）开头的方法都保留为魔术方法，所以建议大家函数名最好不用__开头，除非是为了重载已有的魔术方法。

->

1，General Contact
/* Sender Name */
 Mage::getStoreConfig('trans_email/ident_general/name');
/* Sender Email */
 Mage::getStoreConfig('trans_email/ident_general/email');

2，Sales Representative
/* Sender Name */
 Mage::getStoreConfig('trans_email/ident_sales/name');
/* Sender Email */
 Mage::getStoreConfig('trans_email/ident_sales/email');

3，Customer Support
/* Sender Name */
 Mage::getStoreConfig('trans_email/ident_support/name');
/* Sender Email */
 Mage::getStoreConfig('trans_email/ident_support/email');

4，Custom Email 1
/* Sender Name */
 Mage::getStoreConfig('trans_email/ident_custom1/name');
/* Sender Email */
 Mage::getStoreConfig('trans_email/ident_custom1/email');

5，Custom Email 2
/* Sender Name */
 Mage::getStoreConfig('trans_email/ident_custom2/name');
/* Sender Email */
 Mage::getStoreConfig('trans_email/ident_custom2/email');

http://hilton.mo-commerce.com.dev/coupon.html
========================================================================================================================================================================
20130221
Task:
1.Change email template.
->
object(Mage_Core_Model_Email_Template)[576]
  protected '_templateFilter' => null
  protected '_preprocessFlag' => boolean false
  protected '_mail' => null
  protected '_designConfig' => null
  protected '_emulatedDesignConfig' => boolean false
  protected '_initialEnvironmentInfo' => null
  protected '_eventPrefix' => string 'core_abstract' (length=13)
  protected '_eventObject' => string 'object' (length=6)
  protected '_resourceName' => string 'core/email_template' (length=19)
  protected '_resource' => null
  protected '_resourceCollectionName' => string 'core/email_template_collection' (length=30)
  protected '_cacheTag' => boolean false
  protected '_dataSaveAllowed' => boolean true
  protected '_isObjectNew' => null
  protected '_data' =>
    array (size=0)
      empty
  protected '_hasDataChanges' => boolean false
  protected '_origData' =>
    array (size=0)
      empty
  protected '_idFieldName' => null
  protected '_isDeleted' => boolean false
  protected '_oldFieldsMap' =>
    array (size=0)
      empty
  protected '_syncFieldsMap' =>
    array (size=0)
      empty
->
Table:
core_email_template
->
file:
/core/mage/core/model/email/template.php
->
public function loadDefault($templateId, $locale=null)
->
get all email template at here
public function sendTransactional($templateId, $sender, $email, $name, $vars=array(), $storeId=null)
if (is_numeric($templateId)) {
    $this->load($templateId);
} else {
    $localeCode = Mage::getStoreConfig('general/locale/code', $storeId);
    $this->loadDefault($templateId, $localeCode);
}

/core/mage/adminhtml/model/system/config/source/email/template.php
->system->configuration->SALES->Sales Emails->
->
$this->getPath() -> sales_email/order/template
->
$nodeName = 'sales_email_order_template'
->
self::XML_PATH_TEMPLATE_EMAIL . $nodeName . '/label' = global/template/email/sales_email_order_template/label

/app/design/frontend/base/default/layout/sales.xml
<sales_email_order_items>
    <block type="sales/order_email_items" name="items" template="email/order/items.phtml">
        <action method="addItemRender"><type>default</type><block>sales/order_email_items_order_default</block><template>email/order/items/order/default.phtml</template></action>
        <action method="addItemRender"><type>grouped</type><block>sales/order_email_items_order_grouped</block><template>email/order/items/order/default.phtml</template></action>
        <block type="sales/order_totals" name="order_totals" template="sales/order/totals.phtml">
            <action method="setLabelProperties"><value>colspan="3" align="right" style="padding:3px 9px"</value></action>
            <action method="setValueProperties"><value>align="right" style="padding:3px 9px"</value></action>
            <block type="tax/sales_order_tax" name="tax" template="tax/order/tax.phtml">
                <action method="setIsPlaneMode"><value>1</value></action>
            </block>
        </block>
    </block>
    <block type="core/text_list" name="additional.product.info" />
</sales_email_order_items>
-done.

***************************************************************************************************************************************

/core/mage/contacts/etc/config.xml
->
<global>
<template>
    <email>
        <contacts_email_email_template translate="label" module="contacts">
            <label>Contact Form</label>
            <file>contact_form.html</file>
            <type>text</type>
        </contacts_email_email_template>
    </email>
</template>
</global>
->
'contacts_email_email_template' =>
    array (size=4)
      '@' =>
        array (size=2)
          'translate' => string 'label' (length=5)
          'module' => string 'contacts' (length=8)
      'label' => string 'Contact Form' (length=12)
      'file' => string 'contact_form.htmll' (length=18)
      'type' => string 'text' (length=4)
!!!
/core/mage/core/model/email/template.php
/core/mage/core/model/email/template.php
!!!
static public function getDefaultTemplates()
self::$_defaultTemplates = Mage::getConfig()->getNode(self::XML_PATH_TEMPLATE_EMAIL)->asArray();
以上写法从object中获取元素并且转变为数组!good case!
->
/core/mage/core/model/config.php
/core/mage/core/model/template.php
***************************************************************************************************************************************


Task:
2.massDelete function
-done.
========================================================================================================================================================================
20130222

双功能收款
https://b.alipay.com/order/productDetail.htm?productId=2012111300373136
->
http://act.life.alipay.com/shopping/promotion/subject/new_paytype/video.htm?filename=shuangjiekou#part3
->


手机网站支付
https://b.alipay.com/order/productDetail.htm?productId=2012120700377308

Task: Alipay mobile / 手机网站支付
->
一个支付接口可以用于多个网站上收款 但是每个网站在接入支付宝接口前都要经过支付宝公司的审核的，否则公司会认为您是滥用接口，会有清退的风险的。
所以您网站改变了，或者增加了，是要联系支付宝公司作网站地址变更记的.
->
Namespace: bysoft
Module: alipay
/code/local/bysoft/alipay/
->
交易号 2013022250678779
商户订单号 100000002
-done.
->
Related Alipay Business Account:
username: payment@juzine.com
password: NK1292144ALIP
->
???
Database backup:
1.mo-commerce.com-done.
2.magento_ori-done.
3.drupal72-done.
???
->
/opt/local/etc/php53/php.ini
->
* Changes to the php.ini file must be done in "/opt/local/etc/php53/php.ini".
->
afp://192.168.0.125
--done.

========================================================================================================================================================================

tail -f var/log/*
Linux命令：显示文件结尾
Head/Tail
head 与 tail 就像它的名字一样的浅显易懂，它是用来显示开头或结尾某个数量的文字区块，head 用来显示档案的开头至标准输出中，而 tail 想当然就是看档案的结尾，看看下面的范例：

========================================================================================================================================================================
20130223

1.Symfony : http://symfony.com/doc/current/quick_tour/the_view.html

2.Alipay:
/core/mage/adminhtml/model/system/config/source/order/status.php 后台system-config部分得显示->to be continued->
========================================================================================================================================================================
20130225
->dev_com_mocommerce
->sql5
/sms/template/config.xml中的DB控制信息，主要是存储SMS发送记录LOG的

1.same page with different template:
->
?showConfig=true
->
1.1.adminhtml ->
Controller:
/core/mage/adminhtml/controllers/catalog/productcontroller.php
Module:
/core/mage/catalog/model/product.php
->_afterSave()
Mage::getSingleton('index/indexer')->processEntityAction(
            $this, self::ENTITY, Mage_Index_Model_Event::TYPE_SAVE
        );
/core/mage/index/model/event.php
/core/mage/index/model/indexer.php
后台设置：
Category Products 	Indexed category/products association
system->index management->"category products"->change index mode->update on save->manual update.
后台设置无用，一定要屏蔽Mage::getSingleton('index/indexer')
->

2.Mobile Alipay
->
Namespace: Tmo
module: Alipay
->
/etc/config.xml
->
/sql/

->

Magento: Adding attribute from MySql setup file:
http://blog.chapagain.com.np/magento-adding-attribute-from-mysql-setup-file/

->

/Mage/Core/Model/Resource/Setup.php


========================================================================================================================================================================
20130226
->
1.Wapalipay
1.1. sql setup
1.2. mobile alipay API
1.2.1. Linux: /etc/init.d/apache2 start
1.2.2. Firefox OS Simulator - plus of firefox
->
2.config of mac os
2.1. .ssh
2.2. config of apache,php,memcache and so on.
2.3.
->
3.
Mobile Alipay Gateway:
调用alipay.wap.trade.create.direct接口，POST或者GET方式提交给支付宝网关
http请求地址:http://wappaygw.alipay.com/service/rest.htm
https请求地址:https://wappaygw.alipay.com:443/service/rest.htm

调用alipay.wap.auth.authAndExecute接口，浏览器通过GET方式跳转支付宝网关
http请求地址:http://wappaygw.alipay.com/service/rest.htm
https请求地址:https://wappaygw.alipay.com:443/service/rest.htm

->
用户在支付宝收银台完成支付后，会以GET方式跳转到call_back_url（用户直接点击或自动跳转），同时会携带交易参数。
支付宝系统的通知包括同步和异步两种方式，同步是指在支付完成后支付宝直接调用商户指定的call_back_url
在交易完成后，支付宝会通过Post请求该地址notify_url，将交易状态信息发送给商户服务器。


Post Data(Mobile Alipay):
array
  0 => string 'req_data=<direct_trade_create_req><subject>300000006</subject><out_trade_no>300000006</out_trade_no><total_fee>0.01</total_fee><seller_account_name>payment@juzine.com</seller_account_name><notify_url>http://hilton.mo-commerce.com.dev/wapalipay/payment/confirm/</notify_url><out_user>19</out_user><call_back_url>http://hilton.mo-commerce.com.dev/wapalipay/payment/success/</call_back_url></direct_trade_create_req>' (length=413)
  1 => string 'service=alipay.wap.trade.create.direct' (length=38)
  2 => string 'sec_id=MD5' (length=10)
  3 => string 'partner=2088601071646094' (length=24)
  4 => string 'req_id=20130226050218' (length=21)
  5 => string 'format=xml' (length=10)
  6 => string 'v=2.0' (length=5)
  7 => string '_input_charset=utf-8' (length=20)
  8 => string 'sign=676454069dbfd14f2fea338f5d0aa2be' (length=37)
array(sort)
  0 => string 'format=xml' (length=10)
  1 => string 'partner=2088601071646094' (length=24)
  2 => string 'req_data=<direct_trade_create_req><subject>300000006</subject><out_trade_no>300000006</out_trade_no><total_fee>0.01</total_fee><seller_account_name>payment@juzine.com</seller_account_name><notify_url>http://hilton.mo-commerce.com.dev/wapalipay/payment/confirm/</notify_url><out_user>19</out_user><call_back_url>http://hilton.mo-commerce.com.dev/wapalipay/payment/success/</call_back_url></direct_trade_create_req>' (length=413)
  3 => string 'req_id=20130226050221' (length=21)
  4 => string 'sec_id=MD5' (length=10)
  5 => string 'service=alipay.wap.trade.create.direct' (length=38)
  6 => string 'v=2.0' (length=5)
  7 => string 'sign=fbd139261d533855da74267efe044c0e' (length=37)

Token(Mobile Alipay):
1.correct:
array
  0 => string 'partner=2088101000137799' (length=24)
  1 => string 'req_id=1282889689836' (length=20)
  2 => string 'res_data=<?xmlversion="1.0" encoding="utf-8"?><direct_trade_create_res><request_token>20100830e8085e3e0868a466b822350ede5886e8</request_token></direct_trade_create_res>' (length=168)
  3 => string 'sec_id=MD5' (length=10)
  4 => string 'service=alipay.wap.trade.create.direct' (length=38)
  5 => string 'v=2.0' (length=5)
  6 => string 'sign=72a64fb63f0b54f96b10cefb69319e8a' (length=37)

2.wrong:
array
  0 => string 'partner=2088601071646094' (length=24)
  1 => string 'req_id=20130226050222' (length=21)
  2 => string 'res_error=<?xml version="1.0" encoding="utf-8"?><err><code>0005</code><sub_code>0005</sub_code><msg>partner illegal</msg><detail>合作伙伴没有开通接口访问权限</detail></err>' (length=186)
  3 => string 'sec_id=MD5' (length=10)
  4 => string 'service=alipay.wap.trade.create.direct' (length=38)
  5 => string 'v=2.0' (length=5)

========================================================================================================================================================================
20130227

1.Mobile alipay
->
Related Alipay Business Account:
username: payment@juzine.com
password: NK1292144ALIP

2.API of taobao
->
First App : MC_AIUHIO.COM
400000_21401226@App1MC_iPhone_1.0
400000_21401226@App1MC_iPad_1.0
400000_21401226@App1MC_Android_1.0
400000_21401226@App1MC_WP_1.0
400000_21401226@App1MC_Other_1.0
http://www.taobao.com/market/null/ttid.php
->
taobao.vas.order.search
http://my.open.taobao.com/app/router.htm?app_id=1118355
http://open.taobao.com//doc/api_cat_detail.htm?scope_id=287&category_id=102

3.config the new PC / new DEV
->
3.1. /app/etc/local.xml - have to
3.2. set port of website:
Table: core_config_data
path: web/unsecure/base_url
path: web/secure/base_url
Table: core_website
add port at end of name of site
3.3. netstat -an | grep LISTEN

configure information about acquia dev desktop - apache:
1.httpd.conf
->
ServerRoot "/Applications/acquia-drupal/apache"
DocumentRoot "/Users/user/Documents/workspace/com.mo-commerce"
2.vhosts.conf
->
DocumentRoot /Users/user/Documents/workspace/com.mo-commerce
3.static.ini
siteDir=/Users/user/Sites !!!this should be indicated the exist folder(sites) in the file system!!!
-done.

========================================================================================================================================================================
20130228
1.update database -done.
2.check git -it still have problem with "pull
->
error message:
error: refs/heads/groupdeals1.3 does not point to a valid object!
remote: error: refs/heads/groupdeals1.3 does not point to a valid object!
remote: error: Could not read 53d92d13470bbe9b8446baaec09a8cd5de39c062
remote: fatal: Failed to traverse parents of commit 7321282984a6bc2d678938f6358deb047584dbd7
error: git upload-pack: git-pack-objects died with error.
fatal: git upload-pack: aborting due to possible repository corruption on the remote side.
remote: aborting due to possible repository corruption on the remote side.
fatal: early EOF
fatal: index-pack failed
->error from server-done.
2.2.->
/local/tmo/newsletter/model/resource/queue/collection.php
->change to
$this->addColumn('message_id', Varien_Db_Ddl_Table::TYPE_TEXT, 32); - work for me
$this->addColumn('message_id', Varien_Db_Ddl_Table::TYPE_CHAR, 32); - the old one
->don't commit above change!


3.Mobile Alipay
->
Waiting for the approving process
To be continued.


4.Taobao
->
First App : MC_AIUHIO.COM
400000_21401226@App1MC_iPhone_1.0
400000_21401226@App1MC_iPad_1.0
400000_21401226@App1MC_Android_1.0
400000_21401226@App1MC_WP_1.0
400000_21401226@App1MC_Other_1.0
http://www.taobao.com/market/null/ttid.php
->
taobao.vas.order.search
http://my.open.taobao.com/app/router.htm?app_id=1118355
http://open.taobao.com//doc/api_cat_detail.htm?scope_id=287&category_id=102
->
Testing FTP: csgraphics.gotoftp1.com
,
Related Alipay Business Account:
username: payment@juzine.com
password: NK1292144ALIP
->
related web page:
http://open.taobao.com//doc/api_cat_detail.htm?scope_id=289&category_id=102
http://open.taobao.com/doc/detail.htm?spm=0.0.0.0.RcKlbf&id=101236
http://open.taobao.com/xtao/loginWidget.htm?spm=0.0.0.0.DQt4UB
->


淘宝电子商务组件地址：
http://open.taobao.com//doc/detail.htm?spm=0.0.0.0.DPx9NH&id=996
,
组件API使用指南
http://open.taobao.com/doc/detail.htm?spm=0.0.0.0.NTdImv&id=1015
,
*组件API错误码*
http://open.taobao.com/doc/detail.htm?spm=0.0.0.0.JzT0wa&id=1016
,
如何使用组件API
http://open.taobao.com/doc/detail.htm?spm=0.0.0.0.7Y27Rw&id=1013

session
->
session获取工具-填入appkey获取session
->
http://api.taobao.com/apitools/sessionPage.htm
->
session: 6102919d683cac930c1e7012d4815555e9e4c2f3eb7630983232138
refresh_token: 6100819c49a991cd1c81bc11c001f1f8c8a56d3fcb20cb083232138
->
API BEGIN - Very Important
http://api.taobao.com/apidoc/api.htm?spm=0.0.0.0.cthwTA&path=scopeId:379-apiId:21348
V.S.
http://api.taobao.com/apidoc/apiSample.htm?apiId=21348
API END - Very Important
淘宝客初级包
http://open.taobao.com//doc/api_cat_detail.htm?scope_id=289&category_id=102
->
Zend Studio Layout: Inkpot

========================================================================================================================================================================
20130301

1.Taobao API
->
1.1.test login page in local
->
work well(need to definition the domain name in hosts file)
1.2.get session
->
entry address:
沙箱访问地址：
http://container.api.tbsandbox.com/container?appkey=21401226
,
线上客户端应用获取授权方式
访问 http://my.open.taobao.com/auth/authorize.htm?appkey=123 即可获得授权码，通过http方式访问 http://container.open.taobao.com/container?authcode={授权码}，会得到类似如下的字符串：
top_appkey=1142&top_parameters=xxx&top_session=xxx&top_sign=xxx&encode=utf-8 字符串里面的top_session值即为SessionKey
,
正式环境访问地址：
http://container.api.taobao.com/container?appkey=21401226
->
**************************************************************************************************************************************************************************
1.
http://open.taobao.com/doc/detail.htm?id=101423
http://open.taobao.com/doc/detail.htm?spm=0.0.0.0.IGFrO1&id=105
http://container.api.taobao.com/container?appkey=21401226&encode=utf-8
top_session=6102919d683cac930c1e7012d4815555e9e4c2f3eb7630983232138
授权连接
!sandbox!
http://open.taobao.com/doc/detail.htm?id=105
->
http://container.api.tbsandbox.com/container?appkey={appkey}
sandbox_c_1/taobao1234
http://mini.tbsandbox.com/?spm=a2107.1.0.2
!sandbox!
2.
http://container.api.taobao.com/container/transform?spm=0.0.0.0.2CfztL&appkey=21401226
实际的app登录连接
3.
->
Method:
(1) 通过用户授权获取授权码Code； （获取授权码 :https://oauth.taobao.com/authorize ；沙箱访问 https://oauth.tbsandbox.com/authorize ）
(2) 用上一步获取的Code和应用密钥（AppSecret）通过Https Post方式换取Token。 （获取访问令牌： https://oauth.taobao.com/token ； 沙箱访问 https://oauth.tbsandbox.com/token ）
Example:
(1)->
send:
https://oauth.taobao.com/authorize ?
response_type=code(Fixed) &
client_id=21401226(App ID) &
redirect_uri=http%3A%2F%2Faiuhio.com%3A8083%2Flogin%2Flogin.php(redirect_url) &
state=spm%3A0.0.0.0.2CfztL &
from_site=fuwu
return:
http://aiuhio.com:8083/login/login.php ?
code=BkVATTnnG1hiPgnb9dXgKQaB1209330(code) &
state=spm%3A0.0.0.0.2CfztL
(2)
https_Post($gatewayUrl, $submitData);
Success->
http://open.taobao.com/doc/detail.htm?spm=0.0.0.0.lBZIOH&id=118#s6
http://open.taobao.com/doc/detail.htm?spm=0.0.0.0.lBZIOH&id=118#s6
（以上页面详细记录了登陆成功后token返回的数据内容）

4.
解析以上code部分参数即可实现站点之间的整合
->

**************************************************************************************************************************************************************************
Reference(Rule) from Open.taobao:
（1）对于Server-side flow，redirect_uri是必选参数，并且要求redirect_uri与callback的顶级域名一致。
（2）对于Client-side flow，redirect_uri是可选参数，如果传了redirect_uri，则相应的中间参数会返回到redirect_uri，并且要求redirect_ur与callback的顶级域名一致，如果没有传redirect_uri，则不做校验，返回相应的中间参数到淘宝默认授权返回页面。
（3）在不可预知错误的情况下，返回到默认错误页面。
Access Token即用户授权后颁发的session key
Session Key definition:
http://open.taobao.com/doc/detail.htm?spm=0.0.0.0.kOh8nb&id=162

login example:
https://oauth.taobao.com/authorize?response_type=user&client_id=21401226&redirect_uri=http://aiuhio.com:8083/login/login.php
logout退出流程:
https://oauth.taobao.com/logoff?client_id=21401226&redirect_uri=http://aiuhio.com:8083/login/login.php
return url:
http://aiuhio.com:8083/login/login.php?top_appkey=21401226&top_parameters=ZXhwaXJlc19pbj04NjQwMCZpZnJhbWU9MSZyMV9leHBpcmVzX2luPTg2NDAwJnIyX2V4cGlyZXNfaW49ODY0MDAmcmVfZXhwaXJlc19pbj0yNTkyMDAwJnJlZnJlc2hfdG9rZW49NjEwMDYyNTVlN2NkYWM5NWZkZWM4ZjBlYjYxM2FjMDNkMTU2NDhhYWE1NDMxNzk4MzIzMjEzOCZ0cz0xMzYyMTA5MTk5MjcxJnZpc2l0b3JfaWQ9ODMyMzIxMzgmdmlzaXRvcl9uaWNrPWFpdWhpbyZ3MV9leHBpcmVzX2luPTg2NDAwJncyX2V4cGlyZXNfaW49MTgwMA%3D%3D&top_session=6101d259f73a9b6ad193e18395dbbb93914e85d00d6579a83232138&timestamp=2013-03-01+11%3A39%3A53&sign=jNivwpavmALOiorEESeIfA%3D%3D&agreement=true&agreementsign=21401226-22701819-83232138-418BB722C3B483F8E332B4F613EDCCDC&top_sign=CDyvWBFJEe8B5U8LzOsXqA%3D%3D
->

Connect to App eg:
http://container.api.taobao.com/container/transform?spm=0.0.0.0.2CfztL&appkey=12418525
->
(LOGIN ENTRY: )
http://container.api.taobao.com/container/transform?spm=0.0.0.0.2CfztL&appkey=21401226
redirect to below address:
http://aiuhio.com:8083/login/login.php?code=FvZ5Mf86256We9o5NetvpP2u1193800&state=spm%3A0.0.0.0.2CfztL
,
http://www.chaobaida.com/
http://yingyong.taobao.com/show.htm?app_id=140002
->
http://yingyong.taobao.com/show.htm?app_id=21401226
->
c-done.
v-:
the account for v
->
username: payment@juzine.com
password: NK1292144ALIP
,
http://aiuhio.com:8083/login/login.php ?

sendbox:
http://www.tbsandbox.com/
http://www.tbsandbox.com/doc/index.html#appkey_acount
http://www.tbsandbox.com/doc/auth.html
http://www.cnblogs.com/zhuolaiqiang/archive/2011/06/17/2088918.html

========================================================================================================================================================================
20130302
淘宝开放平台:
1.错误码一览表
http://open.taobao.com/doc/detail.htm?id=114

========================================================================================================================================================================
20130303
【操作】入驻运营服务商指南25/5248
http://bangpai.taobao.com/group/thread/14598017-267818147.htm?spm=0.0.265474.17.43mXOY
========================================================================================================================================================================
20130304
Project: com.mo-commerce
1.
Issue: 0000049 / Refactor according to review notes
Please see & fix according to TODOs in module tmo/widget.
-hold
2.
Issue: 0000022 / Send Coupon / Voucher Code via SMS
Coupon / voucher codes should be send via SMS to the customer as soon as he completes and pays (for vouchers) the order.
-already done?
3.
Issue: 0000081 / Alipay (mobile) Integration
- Check existing Alipay integration as well as its mobile compatibility
- Evaluate integration of available extension(see link below) over in-house implementation/customization of existing checkout & payment process.
-waiting for the approval from alibaba
4.
Issue: 0000023 / Coupon / Voucher Code Redemption & Verification via SMS
Coupon and voucher codes can be verified & redeemed via SMS.
This functionality has been provided by a modification of the devinc/groupdeals module. The module has been updated at 10/27/2012 and all customizations have been overwritten in this step.
Code can still be viewed/restored via GIT history, yet the re-implementation should be an extension to the groupdeals module rather than a direct modification to keep ability for updating the module in future.
-already done? & please follow up
5.
Issue: 0000034 / Images Type/Position Selection Lost when Adding Deal
The selection of images' positions is only stored when editing an existing deal, not when initially saving a new deal.
-It's okay on my PC
->
The web address of image:
http://hilton.mo-commerce.com.dev:8082/media/catalog/product/cache/3/image/650x650/9df78eab33525d08d6e5fb8d27136e95/d/e/design.png

*****************************************************************************************************************************************************************************************************************************************************
Taobao Open Platform:
********************************************************************************************************************************************************************
->What we need is: API from "卖家/在线订购应用/卖家基础开放" - taobao.logistics.orders.detail.get - LogisticsOrdersDetailGetRequest;
********************************************************************************************************************************************************************
Sample Goods link:
http://item.taobao.com/item.htm?spm=686.1000925.1000774.6.xGPDqC&id=17395241945
Order status:
["status"]=> string(20) "ACCEPTED_BY_RECEIVER"
["tid"] : trade id => "303282483227775"
->
For more details,please check on taobao/login/login.php
-done.
*****************************************************************************************************************************************************************************************************************************************************

Testing Wap alipay again:
File:
Model/Payment.php
Line:
77
Output:
array(8) {
[0]=> string(10) "format=xml"
[1]=> string(24) "partner=2088601071646094"
[2]=> string(423) "req_data=3000000083000000080.01payment@juzine.comhttp://hilton.mo-commerce.com.dev:8082/wapalipay/payment/confirm/19http://hilton.mo-commerce.com.dev:8082/wapalipay/payment/success/"
[3]=> string(21) "req_id=20130304040330" [4]=> string(10) "sec_id=MD5" [5]=> string(38) "service=alipay.wap.trade.create.direct" [6]=> string(5) "v=2.0" [7]=> string(37) "sign=63c776ef8a4edf520ad878d69c32e0c7" }
Line:
99
Output:
array(6) {
[0]=> string(24) "partner=2088601071646094"
[1]=> string(21) "req_id=20130304040319"
[2]=> string(186) "res_error=00050005partner illegal合作伙伴没有开通接口访问权限"
[3]=> string(10) "sec_id=MD5"
[4]=> string(38) "service=alipay.wap.trade.create.direct"
[5]=> string(5) "v=2.0" }
->
Pass:
array(7) {
[0]=> string(169) "res_data=201303040d368d0cec49d2df25348fab152760a0"
[1]=> string(38) "service=alipay.wap.trade.create.direct"
[2]=> string(10) "sec_id=MD5" [3]=> string(24) "partner=2088601071646094"
[4]=> string(21) "req_id=20130304060346"
[5]=> string(37) "sign=c12b61802dc7047a86687fe4e59cf534" [6]=> string(5) "v=2.0" }

========================================================================================================================================================================
20130305
1.Wap alipay - testing.
->
1.1.http
1.2.https
-done.

2.Issues.
Continued of 20130304
6.
0000083 / Same page with different template (Catalog/products V.S. Group Deals)
Please refer to below:
protected function _afterSave()
in
/app/code/core/mage/catalog/model/product.php
->
Error symptom
#1:
6.1. after save(manage deal) -> ultimo
->
http://mo-commerce.com.dev:8082/index.php/groupdealsadmin/adminhtml_groupdeals/save/key/9486fe26e88284296d88c8d9ddf0b985/groupdeals_id/12/id/16/type//set/9/store/0/
controller:
/community/devinc/groupdeals/controllers/adminhtml/groupdealscontroller.php
6.2. after reindex(Category Products) -> change to basic
#2:
6.3. after save(catalog/manage product) -> basic
->
http://mo-commerce.com.dev:8082/index.php/admin/catalog_product/save/id/16/key/fc3cc43fb825e768a131d844583f577f/
controller:
core/mage/adminhtml/controllers/catalog/productcontroller.php

6.4. after reindex(Category products) -> basic
Analysis(n.)Analyse:
->
Problem occur from "category products".
reindex "category products" will load different layout configure file(.xml),is it?

Handles For This Request(Ultimo)
	default
    STORE_com_mocommerce_hilton_zh_cn
    THEME_frontend_ultimo_default
    catalog_product_view
    PRODUCT_TYPE_eticket
    PRODUCT_16
    customer_logged_in

V.S.

Handles For This Request(Basic)
    default
    STORE_com_mocommerce_hilton_zh_cn
    THEME_frontend_ultimo_default
    groupdeals_product_view
    PRODUCT_TYPE_eticket
    PRODUCT_16
    customer_logged_in

************************************************************************************************************************************************
Because:
<block type="page/html_breadcrumbs" name="breadcrumbs" as="breadcrumbs" ignore="1"/>  <remove name="breadcrumbs"/>
Then,below is reindex layout:
/app/design/frontend/base/default/layout/groupdeals.xml (this configure file work out the reindex layout!)

below is layout after save(manage deal)
/app/design/frontend/base/default/layout/catalog.xml

after save(manage deal) use catalog_product_view (controller & block) - because it extend from catalog_product?

<reference name="content">
   <block type="catalog/product_view" name="product.info" template="catalog/product/view.phtml">
      <block type="catalog/product_view_media" name="product.info.media" as="media" template="catalog/product/view/media.phtml"/>
      <block type="core/text_list" name="alert.urls" as="alert_urls" translate="label">
         <label>Alert Urls</label>
      </block>

       <block type="catalog/product_view" name="product.info.addto" as="addto" template="catalog/product/view/addto.phtml"/>

       <block type="catalog/product_view" name="product.info.addtocart" as="addtocart" template="catalog/product/view/addtocart.phtml"/>

       <block type="catalog/product_view" name="product.info.options.wrapper" as="product_options_wrapper" template="catalog/product/view/options/wrapper.phtml" translate="label">
         <label>Info Column Options Wrapper</label>
         <block type="core/template" name="options_js" template="catalog/product/view/options/js.phtml"/>
         <block type="catalog/product_view_options" name="product.info.options" as="product_options" template="catalog/product/view/options.phtml">
            <action method="addOptionRenderer">
               <type>text</type>
               <block>catalog/product_view_options_type_text</block>
               <template>catalog/product/view/options/type/text.phtml</template>
            </action>
            <action method="addOptionRenderer">
               <type>file</type>
               <block>catalog/product_view_options_type_file</block>
               <template>catalog/product/view/options/type/file.phtml</template>
            </action>
            <action method="addOptionRenderer">
               <type>select</type>
               <block>catalog/product_view_options_type_select</block>
               <template>catalog/product/view/options/type/select.phtml</template>
            </action>
            <action method="addOptionRenderer">
               <type>date</type>
               <block>catalog/product_view_options_type_date</block>
               <template>catalog/product/view/options/type/date.phtml</template>
            </action>
         </block>
         <block type="core/html_calendar" name="html_calendar" as="html_calendar" template="page/js/calendar.phtml"/>
      </block>

      <block type="catalog/product_view" name="product.info.options.wrapper.bottom" as="product_options_wrapper_bottom" template="catalog/product/view/options/wrapper/bottom.phtml" translate="label">
         <label>Bottom Block Options Wrapper</label>
         <action method="insert">
            <block>product.tierprices</block>
         </action>
         <block type="catalog/product_view" name="product.clone_prices" as="prices" template="catalog/product/view/price_clone.phtml"/>
         <action method="append">
            <block>product.info.addtocart</block>
         </action>
         <action method="append">
            <block>product.info.addto</block>
         </action>
      </block>



...
but,
after save(catalog product) / reindex use groupdeal_product_view - because catalog has been overwritted by groupdeals

update URL Rewrite Management
Correct one:
http://mo-commerce.com.dev:8082/index.php/   catalog/product/view/id/16/
Wrong one:
mo-commerce.com.dev:8082/index.php/   groupdeals/product/view/id/16/groupdeals_id/12

core/url_rewrite

/app/code/community/devinc/groupdeals/model/observer.php
-done.

************************************************************************************************************************************************

3.

========================================================================================================================================================================
20130306

1.Wap alipay improve
notify_url:
怎么做订单更新？
http://help.alipay.com/support/help_detail.htm?help_id=243091&sh=Y&tab=null&info_type=9
"当该笔交易在支付宝交易管理中存在且交易状态改变时，支付宝会主动发送通知到参数notify_url对应的页面文件，"
notify_url页面文件是POST方式获取
1、 必须保证服务器异步通知页面（notify_url）上无任何字符，如空格、HTML标签、开发系统自带抛出的异常提示信息等；
2、 该页面中获得参数的方式，需要使用POST方式获取.
5、 服务器间的交互，不像页面跳转同步服务器异步通知页面可以在页面上显示出来，这种交互方式是不可见的；
Can not testing at this moment,because it is server by server.
->
return_url页面文件是GET方式获取
订单审核通过后，若您已完成接口代码集成，则当您的网站成功发生一笔交易后，次日12点产品会生效。- 15mins -done.
->
BTW,财付通公司
/code/community/bysoft/tenpay/ect/config.xml 财付通公司
Gateway: https://www.tenpay.com/cgi-bin/v1.0/pay_gate.cgi
-done.

3.Taobao open platform:
3.1.buyer - 商品信息展示
Followup:Buyer
So,there's no any api to get trade infomation from c(buyer) side.
P.S.related value added package:
taobao.user.tradestate.get 查询用户当前未付款订单、收藏夹、购物车内宝贝数量
-done.

2.bug issues
->
Coding Style & Conventions: PHP
->Wap alipay:
Mage::getSingleton('wapalipay/payment')->confirmPayment($this->getRequest()->getPost());
Mage::getSingleton('alipay/payment')->confirmPayment($data);
$order = Mage::getModel('sales/order')->loadByIncrementId($postData['reference']);
Mage::getUrl('wapalipay/payment/redirect');
return Mage::getSingleton('checkout/session');
-done.

7. Apple Passbook:
More info about Passbook
https://developer.apple.com/passbook/

========================================================================================================================================================================
20130307
remark:
1.
$this->addColumn('message_id', Varien_Db_Ddl_Table::TYPE_TEXT, 32);
2.
http://hilton.mo-commerce.com.dev:8082
3.

Recheck bug issue in the com.mo-commerce
Project: com.mo-commerce
1.
Issue: 0000049 / Refactor according to review notes
Please see & fix according to TODOs in module tmo/widget.
-hold

2.
Issue: 0000022 / Send Coupon / Voucher Code via SMS
Coupon / voucher codes should be send via SMS to the customer as soon as he completes and pays (for vouchers) the order.
->
/community/devinc/groupdeals/model/observer.php
public function updateGroupdealAfterInvoice($observer)
sms will send out after invoice(complete pay)
-done.

3.
Issue: 0000081 / Alipay (mobile) Integration
- Check existing Alipay integration as well as its mobile compatibility
- Evaluate integration of available extension(see link below) over in-house implementation/customization of existing checkout & payment process.
-done.

4.
Issue: 0000023 / Coupon / Voucher Code Redemption & Verification via SMS
Coupon and voucher codes can be verified & redeemed/兑现 via SMS.
This functionality has been provided by a modification of the devinc/groupdeals module. The module has been updated at 10/27/2012 and all customizations have been overwritten in this step.
Code can still be viewed/restored via GIT history, yet the re-implementation should be an extension to the groupdeals module rather than a direct modification to keep ability for updating the module in future.
->
Request url:
http://hilton.mo-commerce.com.dev:8082/sms/receive_message.php?msg=25174551&mobs=18621798517
-done.

5.
Issue: 0000034 / Images Type/Position Selection Lost when Adding Deal
The selection of images' positions is only stored when editing an existing deal, not when initially saving a new deal.
-It's okay on my PC
-done.

6.
0000083 / Same page with different template (Catalog/products V.S. Group Deals)
Please refer to below:
protected function _afterSave()
in
/app/code/core/mage/catalog/model/product.php
->
************************************************************************************************************************************************
Because:
<block type="page/html_breadcrumbs" name="breadcrumbs" as="breadcrumbs" ignore="1"/>  <remove name="breadcrumbs"/>
Then,below is reindex layout:
/app/design/frontend/base/default/layout/groupdeals.xml (this configure file work out the reindex layout!)

below is layout after save(manage deal)
/app/design/frontend/base/default/layout/catalog.xml

after save(manage deal) use catalog_product_view (controller & block) - because it extend from catalog_product?

<reference name="content">
   <block type="catalog/product_view" name="product.info" template="catalog/product/view.phtml">
      <block type="catalog/product_view_media" name="product.info.media" as="media" template="catalog/product/view/media.phtml"/>
      <block type="core/text_list" name="alert.urls" as="alert_urls" translate="label">
         <label>Alert Urls</label>
      </block>

       <block type="catalog/product_view" name="product.info.addto" as="addto" template="catalog/product/view/addto.phtml"/>

       <block type="catalog/product_view" name="product.info.addtocart" as="addtocart" template="catalog/product/view/addtocart.phtml"/>

       <block type="catalog/product_view" name="product.info.options.wrapper" as="product_options_wrapper" template="catalog/product/view/options/wrapper.phtml" translate="label">
         <label>Info Column Options Wrapper</label>
         <block type="core/template" name="options_js" template="catalog/product/view/options/js.phtml"/>
         <block type="catalog/product_view_options" name="product.info.options" as="product_options" template="catalog/product/view/options.phtml">
            <action method="addOptionRenderer">
               <type>text</type>
               <block>catalog/product_view_options_type_text</block>
               <template>catalog/product/view/options/type/text.phtml</template>
            </action>
            <action method="addOptionRenderer">
               <type>file</type>
               <block>catalog/product_view_options_type_file</block>
               <template>catalog/product/view/options/type/file.phtml</template>
            </action>
            <action method="addOptionRenderer">
               <type>select</type>
               <block>catalog/product_view_options_type_select</block>
               <template>catalog/product/view/options/type/select.phtml</template>
            </action>
            <action method="addOptionRenderer">
               <type>date</type>
               <block>catalog/product_view_options_type_date</block>
               <template>catalog/product/view/options/type/date.phtml</template>
            </action>
         </block>
         <block type="core/html_calendar" name="html_calendar" as="html_calendar" template="page/js/calendar.phtml"/>
      </block>

      <block type="catalog/product_view" name="product.info.options.wrapper.bottom" as="product_options_wrapper_bottom" template="catalog/product/view/options/wrapper/bottom.phtml" translate="label">
         <label>Bottom Block Options Wrapper</label>
         <action method="insert">
            <block>product.tierprices</block>
         </action>
         <block type="catalog/product_view" name="product.clone_prices" as="prices" template="catalog/product/view/price_clone.phtml"/>
         <action method="append">
            <block>product.info.addtocart</block>
         </action>
         <action method="append">
            <block>product.info.addto</block>
         </action>
      </block>



...
but,
after save(catalog product) / reindex use groupdeal_product_view - because catalog has been overwritted by groupdeals

update URL Rewrite Management
Correct one:
http://mo-commerce.com.dev:8082/index.php/   catalog/product/view/id/16/
Wrong one:
mo-commerce.com.dev:8082/index.php/   groupdeals/product/view/id/16/groupdeals_id/12

core/url_rewrite

/app/code/community/devinc/groupdeals/model/observer.php
->
6.a.normal page:
http://hilton.mo-commerce.com.dev:8082/catalog/product/view/id/16/groupdeals_id/12
6.b.groupdeal page:
http://hilton.mo-commerce.com.dev:8082/groupdeals/product/view/id/16/groupdeals_id/12

Handles For This Request(Ultimo)
	default
    STORE_com_mocommerce_hilton_zh_cn
    THEME_frontend_ultimo_default
    catalog_product_view
    PRODUCT_TYPE_eticket
    PRODUCT_16
    customer_logged_in

V.S.

Handles For This Request(Basic)
    default
    STORE_com_mocommerce_hilton_zh_cn
    THEME_frontend_ultimo_default
    groupdeals_product_view
    PRODUCT_TYPE_eticket
    PRODUCT_16
    customer_logged_in

table: index_event
type: save
entity: catalog_product
entity_pk: 1

groupdeals moudle
catalog_product
save
catalog_product
save
cataloginventory_stock_item
save
catalog_product
save
cataloginventory_stock_item
save
catalog_product
save
catalog_product
save
cataloginventory_stock_item
save
catalog_product
save
cataloginventory_stock_item
save
catalog_product
save
cataloginventory_stock_item
save
catalog_product
save
cataloginventory_stock_item
save

-done->

New task:
1.backup database: dev_com_mocommerce - good
2.rebuild database: dev_com_mocommerce - bad
->
3.merge sms into magento
4.update merchants

========================================================================================================================================================================
20130308
Issues:
1.
0000022: [com.mo-commerce.devinc.groupdeals] Send Coupon / Voucher Code via SMS
->
0000023: [com.mo-commerce.devinc.groupdeals] Coupon / Voucher Code Redemption & Verification via SMS (Extended)
As discussed, please refactor contents of /sms folder into a new module: app/code/local/tmo/sms
- Remove included db-related script and replace by regular magento model implementation.
- Implement generic helper to provide sms sending to other modules.
+ Implement configuration option in magento backend / system configuration to allow:
  - Store-specific definition of SMS templates / contents etc.
  - Definition of sending quota (available sms per store to send & already sent/consumed sms per store) - Accordingly a store should only be able to send SMS if its amount of available/free SMS is not consumed yet.
- Implement basic logging of sent SMS.
- Make sure all data (logged messages etc) is stored store-specific and only visible to related stores' users.
2.0000038: [com.mo-commerce] Test Checkout Process & Payment Provider Integration
0000103: [com.mo-commerce] Customized Checkout Process - Coupons
Coupons do not require payment / delivery addresses / options etc.
Therefore implement a customized / short-cut checkout providing following:
- Enter e-mail address / mobile (skip if user is registered with this information & logged-in / offer possibility to login)
- E-mail & SMS coupon on success
+ Redirect to confirmation dialog and list / provide user with additional delivery options:
  - View & Print Coupon
  - Download Coupon
  - Mail/SMS Coupon
  - Import into Passbook (Passbook is a registered trademark of Apple Inc. blabla ...) (Ignore for now until specified & implemented)
3.
0000105: [com.mo-commerce] Customized Checkout Process - Vouchers
Vouchers require a payment process but no delivery address / options.
Therefore implement a customized checkout process providing following features:
- Enter firstname, lastname, e-mail address, mobile number
- Lead through payment process
- E-mail & SMS voucher on success
+ Redirect to confirmation dialog and list / provide user with additional delivery options:
  - View & Print Coupon
  - Download Coupon
  - Mail/SMS Coupon
  - Import into Passbook (Passbook is a registered trademark of Apple Inc. blabla ...) (Ignore for now until specified & implemented)
4.
0000107: [com.mo-commerce] Customized Checkout Process - Simple Products
It is possible to define allowed countries for a shop in magento.
If a shop is configured to provide services for China only (see attached screenshot for configuration example), the checkout process should be slightly simplified:
- No separation between delivery & billing address - just call it "Address"
- No country selection for "Address" (China should be internally pre-selected and country selector hidden, or the China is pre-selected and the only available selection.)
- Automatically list available states/provinces for China
- Re-order fields as listed: (country), state/province, zip & city
- Remove field: fax
- Remove field: telephone
- Add field: mobile
5.
0000109: [com.mo-commerce] Customized Checkout Process - Update Payment Provider Logos
Add/Update logos for payment providers displayed during checkout process.
6.
0000111: [com.mo-commerce] Payment Process - PayPal
Implement payment process with PayPal as follows / verify existing implementation accordingly:
- Convert RMB to USD via google webservices either real-time or by implementing an hourly cron to fetch & store/update conversion rate (make sure last successfully synchronized rate is used - do not overwrite with empty value if synchronization fails etc).
- Round converted price to 2 decimals.
- Use final price to initiate paypal transaction.
- Check via paypal transaction id whether payment is accepted / succeeded.
- Store applied conversion rate and final price sent to paypal as well as paypal transaction id and payment status with order and/or paypal transactions (which are already stored by magento/corresponding modules).
- Test whether paypal automatically redirects to a mobile version when paying via mobile device (or whether it can be defined to do so - and if so, do so :))
ˆ2.

7.
0000083: Same page with different template (Catalog/products V.S. Group Deals)
Please verify & set to resolved if done ..
8.
0000117: [com.mo-commerce] Groupdeal Merchants must be related to their Store
Currently all merchants are available to all stores.
Use following demo accounts (username/password) to see backend like it is supposed to be for our customers:
- hilton/tmo2012
- azul/tmo2012
- demo/tmo2012
Each Store View belonging to listed accounts should have its own dedicated merchant account in groupdeals module.
Therefore merchants must be associated to their corresponding store view and hidden for other store views / store users.
tmo/security/helper contains all possibly required methods to check users permissions and access to websites/stores/store-views etc.
tmo/security/model can be integrated as for groupdeal coupons to add basic relationship & filtering of store views to merchants.
9.
0000034: [com.mo-commerce.devinc.groupdeals] Images Type/Position Selection Lost when Adding Deal
10.
0000115: [com.mo-commerce] Fix Coding Style & Code Review of Recent Commits
I added comments to some files in app/code/local/tmo/groupdeals, prefixed with: TODO (CR|MAX)
Yet I did not comment on every file violating coding style, so please check added modules & modifications accordingly (e.g. app/code/local/tmo/wapalipay).
=>

(now)

1.sms of groupdeal - 0000023
->
bugs:
1.1.
request:
http://mo-commerce.com.dev:8082/index.php/admin/sales_order_invoice/save/order_id/8/key/dade4f86a6e82d4571e58de2df8b2047/
->
Fatal error: Class 'Mage_Sms_Helper_Data' not found in /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/Mage.php on line 546
2013-03-08T11:59:50+08:00 ERR (3): Warning: include(Mage/Sms/Helper/Data.php) [<a href='function.include'>function.include</a>]: failed to open stream: No such file or directory  in /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/Varien/Autoload.php on line 93
2013-03-08T11:59:50+08:00 ERR (3): Warning: include() [<a href='function.include'>function.include</a>]: Failed opening 'Mage/Sms/Helper/Data.php' for inclusion (include_path='/Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/local:/Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/community:/Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core:/Users/maxwellshi/Documents/workspace/com.mo-commerce/lib:.:/Applications/acquia-drupal/common/pear:/usr/lib/php')  in /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/Varien/Autoload.php on line 93
-active module: Tmogroup_sms
2013-03-08T12:07:44+08:00 DEBUG (7): sendCouponSMS =18621798517 62366446 72416161 2013-03-31 deal37
-pass
1.2.
request:
http://mo-commerce.com.dev:8082/index.php/groupdealsadmin/adminhtml_coupons/massSendEmail/key/5161cd4813e01885f09a7c008a60fd23/
Fatal error: Class 'Mage_Customproduct_Helper_Data' not found in /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/Mage.php on line 546
->
Tmogroup_Customproduct/Helper/Data.php
->
(can not send out email)
SEND EMAIL module should be set up in backend:
System -> SMTP Pro Email General Settings ->
Choose extension option: SMTP
Log all messages: Yes -> System->Tools->Email Log.
&
Host: mail.grid.tmogroup.asia
Port: 25
SSL Security: No SSL
-pass

2.Groupdeal Merchants must be related to their Store - 0000117 - Pass

3.0.
0000023: [com.mo-commerce.devinc.groupdeals] Coupon / Voucher Code Redemption & Verification via SMS (Extended)
As discussed, please refactor contents of /sms folder into a new module: app/code/local/tmo/sms
- Remove included db-related script and replace by regular magento model implementation.
- Implement generic helper to provide sms sending to other modules.
+ Implement configuration option in magento backend / system configuration to allow:
  - Store-specific definition of SMS templates / contents etc.
  - Definition of sending quota (available sms per store to send & already sent/consumed sms per store) - Accordingly a store should only be able to send SMS if its amount of available/free SMS is not consumed yet.
- Implement basic logging of sent SMS.
- Make sure all data (logged messages etc) is stored store-specific and only visible to related stores' users.

3.1.Fix Coding Style & Code Review of Recent Commits - 0000115

BTW
->
study on
Zero Subtotal Checkout:
-done.
->
wap alipay - done.
send sms & verify sms works - done.
http://hilton.mo-commerce.com.dev:8082/sms/receive_message.php?msg=72416161&mobs=18621798517
,
Send Email WebAddress:
http://mo-commerce.com.dev:8082/index.php/admin/sales_order/email/order_id/12/key/686da756d41a52a94c06b7d749b67372/
Email will be sent out after invoice(need to do some configration in backend)
eg. Zero Subtotal Checkout:
->
New Order Status: Processing
Automatically invoice all items: Yes(then send out email)
related configuration at:
sales emails->Invoices->Yes!

/local/tmo/wapalipay/model/payment.php
->
public function getOrderPlaceRedirectUrl() {
->
Mage::getUrl('wapalipay/payment/redirect');
->Mage::getUrl get data from table: core_config_data where path = 'web/unsecure/base_url' and scope_id=0
-done.

default, 0, web/secure/base_url http://mo-commerce.com.dev:8082/
default, 0, web/unsecure/base_url http://mo-commerce.com.dev:8082/
websites, 6, web/unsecure/base_url http://hilton.mo-commerce.com.dev:8082
->
->
need to set used site to default!


http://mo-commerce.com.dev:8082/wapalipay/payment/redirect/
http://hilton.mo-commerce.com.dev:8082/wapalipay/payment/redirect


<-system.xml
->
payment_action related to action after payment!
<order_status translate="label">
	 <label>New Order Status</label>
    <frontend_type>select</frontend_type>
    <source_model>adminhtml/system_config_source_order_status_newprocessing</source_model>
    <sort_order>12</sort_order>
    <show_in_default>1</show_in_default>
    <show_in_website>1</show_in_website>
    <show_in_store>0</show_in_store>
</order_status>
<payment_action translate="label">
    <label>Automatically Invoice All Items</label>
    <frontend_type>select</frontend_type>
    <source_model>payment/source_invoice</source_model>
    <sort_order>12</sort_order>
    <show_in_default>1</show_in_default>
    <show_in_website>1</show_in_website>
    <show_in_store>0</show_in_store>
    <depends>
        <order_status separator=",">processing,processed_ogone</order_status>
    </depends>
</payment_action>
system.xml->

->
backup database:
========================================================================================================================================================================
20130310
file:
/local/tmo/groupdeals/block/adminhtml/coupons/grid/column/renderer/order.php
update:

public function render(Varien_Object $row)
	{

	  $order_item_id = $row->getOrderItemId();

    if ($order_item_id>0)
    {
      $order_item = Mage::getModel('sales/order_item')->load($order_item_id);
      $order_id = $order_item->getOrderId();

      $order = Mage::getModel('sales/order')->load($order_id);
      $real_order_id = $order->getRealOrderId();

      return '<a href="/admin/sales_order/view/order_id/'.$order_id.'/" style="text-decoration:none">'.$real_order_id.'</a>';
    }
    else
    {
      return 'N/A';
    }

	}

========================================================================================================================================================================
20130312
Main task:
->
sms module:
class Mage_Adminhtml_Block_Catalog_Product_Helper_Form_Price extends Varien_Data_Form_Element_Text
parent::__construct($attributes);
array(5) { ["name"]=> string(5) "price" ["label"]=> string(5) "Price" ["class"]=> string(15) " required-entry" ["required"]=> string(1) "1" ["note"]=> NULL }
1.1. new -> save -done.
1.1. if the config is already exist of one site - possible! -pass.
1.2. update -done.
1.3. delete -done.
so,currently all configration information of sms were stored in database-done.
->
P.S.
ALTER TABLE `tmo_sms_template`
  ADD CONSTRAINT `FK_TMO_SMS_TEMPLATE_CONFIG_ID_TMO_SMS_CONFIG_ID` FOREIGN KEY (`config_id`) REFERENCES `tmo_sms_config` (`id`) ON DELETE SET NULL ON UPDATE CASCADE;
  不能直接加外键，参照表需要做索引！
->
use them, apply them
send out testing sms
-done.
->
frondend:
string(7) "fffffff" string(1) "1" string(26) "r064bql9lck341vsbkc3lotgi7"

backend:
NULL NULL string(26) "udrpk4n1togggmrbgg1nn06am0"

http://hilton.mo-commerce.com.dev:8082/index.php/sms/config/index/
http://hilton.mo-commerce.com.dev:8082/index.php/sms/config/index/key/b080119091e1a3a182c65ca6114f6b2f/
http://www.cosms.cn/sms/putMt/?msgFormat=utf8&corpID=2060429&loginName=HONGHEM&password=HONGHEM&Mobs=18621798517&msg=testing&mtLevel=1&MD5str=

string(16) "100 0,875200075 "

CREATE TABLE IF NOT EXISTS `tmo_sms_log` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `store_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Store Id',
  `sent_time` datetime DEFAULT NULL,
  `sms_config_id` smallint(5) unsigned DEFAULT NULL COMMENT 'SMS Config Id',
  `sms_template_type` varchar(255) NULL,
  `phone` varchar(255) NULL,
  `content` varchar(255) NULL,
  `remain` smallint(5) unsigned DEFAULT NULL COMMENT 'How many SMS remain',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

http_build_query($query_data) to work out url
->
new structure of tmo_sms_template
:
CREATE TABLE `tmo_sms_template` (
`id` int(11) unsigned NOT NULL AUTO_INCREMENT,
`config_id` smallint(5) unsigned DEFAULT NULL COMMENT 'SMS Config Id',
`template_type` varchar(255) DEFAULT NULL,
`template_content` varchar(255) DEFAULT NULL,
PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

========================================================================================================================================================================
20130313
0000127: [com.everwines] Project Plan
New project about SAP

Issue list:
->
0000073: [com.mo-commerce] Coupon & Voucher Order Status & Management
Implement status overview & management of available/ordererd/redeemed/expired
coupons & vouchers according to existing implementation of juzine.com.
Location in Backend should be:
Group Deals > Manage Coupons & Vouchers
&
This functionality is already implemented in juzine.com / predecessor of mo-commerce.com. Please migrate/re-implement to/into mo-commerce.com accordingly.
It can be viewed in juzine.com Backend:
Customers > Manage Coupons

->


http://new.tmogroup.asia.dev/%E7%BD%91%E7%AB%99-%E7%A7%BB%E5%8A%A8%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/%E7%94%B5%E5%AD%90%E5%95%86%E5%8A%A1%E7%BD%91%E7%AB%99%E5%BC%80%E5%8F%91/
need short url

->


http://www.dougnorfolk.com.au/jquery-add-table-row/jquery-add-table-row.html#

http://hilton.mo-commerce.com.dev:8082/index.php/smsadmin/adminhtml_config/save/id/1/key/ff2f54802343a316267235524d168f79/back/edit/
http://hilton.mo-commerce.com.dev:8082/index.php/smsadmin/adminhtml_config/save/key/ff2f54802343a316267235524d168f79/id/1/back/edit/

http://hilton.mo-commerce.com.dev:8082/index.php/smsadmin/adminhtml_config/save/id/1/key/ff2f54802343a316267235524d168f79/
http://hilton.mo-commerce.com.dev:8082/index.php/smsadmin/adminhtml_config/save/key/ff2f54802343a316267235524d168f79/id/1/back/edit/
========================================================================================================================================================================
20130315
display log of sms-done.
->
restructure the db

1.provider table - redefinition - setup provider with testing function.
tables:
1.1.tmo_sms_providers
->

for admin

CREATE TABLE `tmo_sms_providers` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) NULL,
  `sms_url` varchar(255) NULL,
  `sms_charset` varchar(255) NULL,
  `sms_username` varchar(255) NULL,
  `sms_password` varchar(255) NULL,
  `sms_corp_id` varchar(255) NULL,
  `sms_level` varchar(255) NULL,
  `sms_type` varchar(255) NULL,
  PRIMARY KEY  (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

for admin

CREATE TABLE `tmo_sms_config` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `provider_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Provider Id',
  `quota_type` int(2) DEFAULT NULL COMMENT '0:daily,1:monthly,2:yearly',
  `quota_valid_until` datetime DEFAULT NULL,
  `quota_available` bigint(20) DEFAULT NULL COMMENT '',
  `quota_sent` bigint(20) DEFAULT NULL COMMENT '',
  `quota_sent_total` bigint(20) DEFAULT NULL COMMENT '',
  PRIMARY KEY  (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

for customer

CREATE TABLE `tmo_sms_template` (
		`id` int(11) unsigned NOT NULL AUTO_INCREMENT,
		`store_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Store Id',
		`template_type` varchar(255) DEFAULT NULL,
		`template_content` varchar(255) DEFAULT NULL,
		PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8;

new table for M2N

CREATE TABLE IF NOT EXISTS `tmo_sms_config_core_store` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'Id',
  `sms_config_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Sms Config Id',
  `core_store_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Core_store_id',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_sms_config_id_core_store_id` (`sms_config_id`,`core_store_id`),
  KEY `fk_tmo_sms_config_core_store` (`core_store_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='tmo_sms_config_core_store';

CREATE TABLE IF NOT EXISTS `tmo_sms_template_core_store` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'Id',
  `template_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Sms Template Id',
  `core_store_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Core_store_id',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_sms_template_id_core_store_id` (`sms_template_id`,`core_store_id`),
  KEY `fk_tmo_sms_template_core_store` (`core_store_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='tmo_sms_template_core_store';


CREATE TABLE IF NOT EXISTS `tmo_sms_template_core_store` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT,
  `sms_template_id` bigint(20) DEFAULT NULL,
  `core_store_id` smallint(5) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 AUTO_INCREMENT=5 ;

2.setup template with store and sms type.
2.1.tmo_sms_config just: store_id,how many remain
2.2.tmo_sms_template

1.1. new -> save -done.
1.2. update -done.
1.3. delete -done.
1.4. send testing sms-done.
1.5. create special template with provider

!!!very importent!!!
use store id to save template!

one store one config information
if already exist,can not save then-done.

tmo_sms_config_core_store

!!!very importent!!!

========================================================================================================================================================================
20130317
1.check provider
1.1. new -> save -done.
1.2. update -done.
1.3. delete -done.

(1, 6, '2', 'http://www.cosms.cn/sms/putMt/?', 'HONGHEM', 'HONGHEM', '2060429', '1', '1', '100');
		");
provider-done.

2. sms config

CREATE TABLE IF NOT EXISTS `tmo_sms_config` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `provider_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Provider Id',
  `quota_type` int(2) DEFAULT NULL COMMENT '1:daily,2:monthly,3:yearly',
  `quota_valid_until` datetime DEFAULT NULL,
  `quota_available` bigint(20) DEFAULT NULL,
  `quota_sent` bigint(20) DEFAULT NULL,
  `quota_sent_total` bigint(20) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8

CREATE TABLE IF NOT EXISTS `tmo_sms_config_core_store` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'Id',
  `config_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Sms Config Id',
  `core_store_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Core_store_id',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_config_id_core_store_id` (`config_id`,`core_store_id`),
  KEY `fk_tmo_sms_config_core_store` (`core_store_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='tmo_sms_config_core_store';

Comments from carsten
//$this->addDefaultColumns();
  /*$this->addColumn('sms_url', Varien_Db_Ddl_Table::TYPE_TEXT, 255);
  $this->addColumn('sms_charset', Varien_Db_Ddl_Table::TYPE_TEXT, 255);
  $this->addColumn('sms_username', Varien_Db_Ddl_Table::TYPE_TEXT, 255);
  $this->addColumn('sms_password', Varien_Db_Ddl_Table::TYPE_TEXT, 255);
  $this->addColumn('sms_url', Varien_Db_Ddl_Table::TYPE_TEXT, 255);*/

  // TODO Move to table sms_quota
  /*$this->addColumn('quota_type', Varien_Db_Ddl_Table::TYPE_INTEGER, 2); // monthly (daily, yearly,, ...)
  $this->addColumn('quota_valid_until', Varien_Db_Ddl_Table::TYPE_DATETIME); // monthly (daily, yearly,, ...)
  $this->addColumn('quota_available', Varien_Db_Ddl_Table::TYPE_BIGINT, 20); // 1000 / month, 10000/year
  $this->addColumn('quota_sent', Varien_Db_Ddl_Table::TYPE_BIGINT, 20); // 100 sent
  $this->addColumn('quota_sent_total', Varien_Db_Ddl_Table::TYPE_BIGINT, 20); // 100 sent*/

  /*
  - quota_valid_until
  If current type is monthly, set quota_valid_until to beginning of next month.
  if quota_valid_until is current day or in the past, reset quota_sent to 0 and set quota_valid_until
  to beginning of next month (or year iif type changes to yearly)

  - Currently available messages for a user is always quota_available - quota_sent.
  - Cron job selects every day all records where quota_valid_until < NOW() and updates quota_valid_until = quota_valid_until + 1 month (or year, depending on quota_type) AND quota_sent = 0.
  - quota_sent and quota_sent_total get increased for every message sent
  */
  //$this->addDefaultFields();
  //$this->addRelationship(Tmo_Security_Model_Relationship_Managed_12N_Store::create($this, 'sms_config_id'));

1.check sms config
1.1. new -> save -done.

// 			$storeId = $smsConfig->load($submitData['store'],'store_id')->getStoreId();
// 			if($storeId)
// 			{
// 				//configuration information can not be duplicated!
// 				Mage::getSingleton('adminhtml/session')->addError(Mage::helper('adminhtml')->__('One store only could have one configuration'));
// 				return;
// 			}

1.2. update -done.
1.3. delete -done.

3. sms template

CREATE TABLE IF NOT EXISTS `tmo_sms_template_core_store` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'Id',
  `template_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Sms Template Id',
  `core_store_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Core_store_id',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_template_id_core_store_id` (`template_id`,`core_store_id`),
  KEY `fk_tmo_sms_template_core_store` (`core_store_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='tmo_sms_template_core_store';

[SQL_QUERY]
1.
Mage::getModel('tmo_sms/template')->load($id_,'config_id');
2.
Mage::getResourceSingleton('tmo_sms/template_collection')->addFieldToFilter('config_id',array('eq'=>$id_))->load();
2.2.
Mage::getResourceSingleton('tmo_sms/template_collection')
			->addFieldToFilter('config_id',array('eq'=>$id_))
			->addFieldToFilter('template_type',array('eq'=>$template_type))
			->load();
3.
$connection = Mage::getResourceSingleton('tmo_sms/log_collection')->getConnection();
$stmt=$connection->query(sprintf('SELECT * FROM tmo_sms_log where sms_config_id='.$sms_config_id.' order by remain asc limit 1'));
$sms_remain_log=$stmt->fetchAll(PDO::FETCH_ASSOC);
4.
$connection = Mage::getResourceSingleton('tmo_sms/config_collection')->getConnection();
$stmt=$connection->query(sprintf('DELETE FROM tmo_sms_config_core_store where core_store_id='.$value.''));
5.
$model_sms_template = Mage::getModel('tmo_sms/template');
$template_id = $model_sms_template->load($value,'config_id')->getId();
$model_sms_template->setId($template_id)->delete();
6.
$coupons_collection->addFieldToFilter('sku',array('like'=>'%'.(string)$filter_data['sku'].'%'));
7.
Mage::getStoreConfig('tmo_sms/configuration/active');
Get value from core_config_data
8.
$providersArray = Mage::getResourceSingleton('tmo_sms/providers_collection')->findall();
9.
Mage::getResourceSingleton('tmo_sms/templatecorestore_collection')->findAllAsArray(array('select'=>array('core_store_id=6')));
10.
$connection = Mage::getResourceSingleton('tmo_sms/config_collection')->getConnection();
$stmt=$connection->query(sprintf('Select config_id FROM tmo_sms_config_core_store where core_store_id='.$store_id.''));
$stmt->fetch(PDO::FETCH_ASSOC)
+only one item

    $collection = Mage::getModel('catalog/category')->load($categoryId)
        ->getProductCollection()
        ->addAttributeToSort('name', 'ASC');

    $collection = Mage::getModel('module/model_name')->getCollection()
        ->addAttributeToSort('order', 'ASC')
        ->addAttributeToSort('last_name', 'ASC')
        ->addAttributeToSort('first_name', 'ASC')
    ;

    $collection = Mage::getModel('module/model_name')->getCollection();
    $collection->getSelect()->order( array('IF(`order`>0, `order`, 9999) ASC',
         'last_name ASC', 'first_name ASC') );

    $collection = Mage::getModel('module/model_name')->getCollection();
    $collection->getSelect()->join( array('table_alias'=>$this->getTable('module/table_name')), 'main_table.foreign_id = table_alias.primary_key', array('table_alias.*'), 'schema_name_if_different');

    http://www.magentocommerce.com/wiki/1_-_installation_and_configuration/using_collections_in_magento
    Mage_Eav_Model_Entity_Collection
	Mage/Eav/Model/Entity/Collection/Abstract.php
	collection ->addAttributeToFilter($attribute, $condition=null, $joinType=’inner’)

$collection = Mage::getModel('tmo_sms/providers')->getCollection()->addFieldToFilter('name',array('eq'=>3));
$collection->getData();
above same fetchall function!

LIMIT
$collection->getSelect()->limit($limit);
LIMIT

[COLLECTION WITH LEFT JOIN]

Method A.
    $connection = Mage::getResourceSingleton('tmo_sms/config_collection')->getConnection();
    $stmt=$connection->query(sprintf('Select b.provider_id,b.id as config_id FROM tmo_sms_config_core_store as a left join tmo_sms_config as b on a.config_id = b.id where a.core_store_id='.$storeId.''));
    $providerConfig = $stmt->fetch(PDO::FETCH_ASSOC);
    $providerConfig = $stmt->fetchall(PDO::FETCH_ASSOC);
    <!--
    fetch only get one row
    fetch all get all rows
    -->

Method B.
//1. create collection
$collection = Mage::getModel('tmo_sms/providers')->getCollection();
//2.1. create sql with left join, group by, order by, limit AND select array('right_table.id as right_table_id','right_table.*')
$collection->getSelect()->joinLeft(array('right_table'=>'tmo_sms_config'),
		'`main_table`.`id`=`right_table`.`provider_id`',array('right_table.id as right_table_id','right_table.*'))->group(array('right_table.provider_id'))->order(array('right_table.quota_available DESC'))->limit(5);
//2.2. set Where sentence
$collection->addFieldToFilter('`right_table`.`quota_type`',array('eq'=>2));
//3. getData means get all data from above sql
$data = $collection->getData();

foreach ($data as $items)
{
	//get data
	echo 'Provider Name is : '.$providerName = $items['name'];
	echo 'Configuration Id is : '.$configId = $items['right_table_id'];
	echo '<hr>';

	//update items
	$providerArray = array(
			'name' => $providerName.'update'
			);

	$configArray = array(
			'quota_available' => $items['quota_available']-1000
			);
	Mage::getModel('tmo_sms/providers')->load($items['id'])->save($providerArray);
	Mage::getModel('tmo_sms/config')->load($items['right_table_id'])->save($configArray);

	//delete items
	Mage::getModel('tmo_sms/config')->load($items['right_table_id'])->delete();

}
//4. print sql sentence
//$collection->printLogQuery(true);

Method C. NOT left join Just query sample:
$roleId = implode('', Mage::getSingleton('admin/session')->getUser()->getRoles());
$collection = Mage::getModel('tmo_security/permission')->getCollection();
//$collection->getSelect()->order(array('value desc'));
$collection->addFieldToFilter('admin_role_id',$roleId)
->addFieldToFilter('privileges',Tmo_Security_Model_Privilege::ALL)
->addFieldToFilter('name',Tmo_Security_Model_Permission_Store::NAME)
->addFieldToSelect('value');
$collection->setOrder('value','desc');
$collection->printLogQuery(true);
$data = $collection->getData();

[OOP OOP OOP PLEASE!]

[COLLECTION WITH LEFT JOIN]

[VERY IMPORTANT]
 →joinInner() →joinLeft() →joinRight() →joinFull() →joinCross() →joinNatural()
See lib/Zend/Db/Select.php for source.
->to CHECK SOURCE CODE IS VERY IMPORTANT!
[VERY IMPORTANT]


sprintf(
          '%1$s IN ( SELECT %3$s FROM %2$s WHERE %4$s IN ( %5$s ) )',
          $relationship_->pkResource,
          $relationship_->joinTable,
          $relationship_->leftKey,
          $relationship_->rightKey,
          implode(',', array_keys($privileges))
        );


[SQL_QUERY]

[role of admin]
$roleId = implode('', Mage::getSingleton('admin/session')->getUser()->getRoles());
$roleName = Mage::getModel('admin/roles')->load($roleId)->getRoleName();

register current_role with role model
Mage::register('current_role', $role);
return Mage::registry('current_role');
[role of magento]

1.1. new -> save -done.
1.2. update -done.
1.3. delete -done.

4. sms log

CREATE TABLE IF NOT EXISTS `tmo_sms_log` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `store_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Store Id',
  `sms_config_id` smallint(5) unsigned DEFAULT NULL COMMENT 'SMS Config Id',
  `sms_template_id` smallint(5) unsigned DEFAULT NULL COMMENT 'SMS Template Id',
  `sms_template_type` varchar(255) DEFAULT NULL,
  `phone` varchar(255) DEFAULT NULL,
  `content` varchar(255) DEFAULT NULL,
  `quota_available` bigint(20) DEFAULT NULL COMMENT '',
  `sent_time` datetime DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8

5.Admin Level and so on
http://www.magentocommerce.com/wiki/5_-_modules_and_development/admin/xml_structure_for_admin_configurations

P.S.


========================================================================================================================================================================
20130318
0.redo database
-done.
1.follow the process
1.1.providers -done.
1.2.sms configuration -done.
1.3.create template -done.(some problem occured once save - done.)

2.function sendSms
2.1.sendSms - done.
2.2.check available -done.
2.3.check on db and sql -done.

[SMS_TABLES]

CREATE TABLE IF NOT EXISTS `tmo_sms_providers` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `name` varchar(255) DEFAULT NULL,
  `sms_url` varchar(255) DEFAULT NULL,
  `sms_charset` varchar(255) DEFAULT NULL,
  `sms_username` varchar(255) DEFAULT NULL,
  `sms_password` varchar(255) DEFAULT NULL,
  `sms_corp_id` varchar(255) DEFAULT NULL,
  `sms_level` varchar(255) DEFAULT NULL,
  `sms_type` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8

CREATE TABLE IF NOT EXISTS `tmo_sms_config` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `provider_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Provider Id',
  `quota_type` int(2) DEFAULT '2' COMMENT '1:daily,2:monthly,3:yearly',
  `quota_valid_until` datetime DEFAULT '0000-00-00 00:00:00',
  `quota_available` bigint(20) DEFAULT '0',
  `quota_sent` bigint(20) DEFAULT '0',
  `quota_sent_total` bigint(20) DEFAULT '0',
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 ;

CREATE TABLE IF NOT EXISTS `tmo_sms_config_core_store` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'Id',
  `config_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Sms Config Id',
  `core_store_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Core_store_id',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_config_id_core_store_id` (`config_id`,`core_store_id`),
  KEY `fk_tmo_sms_config_core_store` (`core_store_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='tmo_sms_config_core_store'

CREATE TABLE IF NOT EXISTS `tmo_sms_template` (
  `id` int(11) unsigned NOT NULL AUTO_INCREMENT,
  `template_type` varchar(255) DEFAULT NULL,
  `template_content` varchar(255) DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8

CREATE TABLE IF NOT EXISTS `tmo_sms_template_core_store` (
  `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'Id',
  `template_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Sms Template Id',
  `core_store_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Core_store_id',
  PRIMARY KEY (`id`),
  UNIQUE KEY `idx_template_id_core_store_id` (`template_id`,`core_store_id`),
  KEY `fk_tmo_sms_template_core_store` (`core_store_id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='tmo_sms_template_core_store'

CREATE TABLE IF NOT EXISTS `tmo_sms_log` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `store_id` smallint(5) unsigned DEFAULT NULL COMMENT 'Store Id',
  `sms_config_id` smallint(5) unsigned DEFAULT NULL COMMENT 'SMS Config Id',
  `sms_template_type` varchar(255) DEFAULT NULL,
  `phone` varchar(255) DEFAULT NULL,
  `content` varchar(255) DEFAULT NULL,
  `quota_available` bigint(20) DEFAULT 0,
  `sent_time` datetime DEFAULT NULL,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB  DEFAULT CHARSET=utf8

[SMS_TABLES]

/*try
{
}
catch (Exception $e)
{
}*/

Potential Issue:
1.check for: ->
quota_type,
quota_valid_until,
quota_available,
quota_sent,
quota_sent_total
->
This needs a exact rule - done.
/*Rule about send sms
 - Currently available messages for a user is always quota_available - quota_sent.
 - Cron job selects every day all records where quota_valid_until < NOW() and updates quota_valid_until = quota_valid_until + 1 month (or year, depending on quota_type) AND quota_sent = 0.
 Cron Job
 - quota_sent and quota_sent_total get increased for every message sent
*/
2.select - onchange(Provider)
/tmo/newsletter/block/form/element/select/transport/type.php
->

========================================================================================================================================================================
20130319

Recheck with Carsten:
->
Providers/edit/tab/basic.php
controllers/providerscontroller.php
/etc/config.xml
model/transport.php
transport/collection.php
-done.

Related files:
1./tmo/newsletter/model/transport.php getTabs()
2./tmo/newsletter/block/adminhtml/transport/edit/tabs.php getTabs() -> addTab
3./tmo/newsletter/model/transport/smtp.php
4./tmo/newsletter/model/resource/transport/collection.php -> $this->addColumn('settings', Varien_Db_Ddl_Table::TYPE_TEXT); (Database)
5./tmo/newsletter/block/form/element/select/transport/type.php ->
public function getElementHtml()
{
  $this->onchange='editForm.submit();';
  return parent::getElementHtml();
}

0.UI update:
0.1.setting->settings
0.2.provider name
-done.
1.update quota_sent & quota_sent_total-done.
->
2.update code of providers
-done.

4.locale->Tmo_Sms.csv
->done.

3.Cron Job for sms available
->?
========================================================================================================================================================================
20130320

Reference:
1.
Linux commands:
->
tail -n 100 error_log
ps aux | grep http
ps aux | grep apache
netstat -ap | grep http
./apachectl configtest
/var/log/
./apachectl start
logs/
./apachectl stop

2.
Apache configuration in folder: apache_configuration
-done.

4.
SMS layout configuration
->
// Initialize product object as form property to use it during elements generation
array(5) { ["attribute_group_id"]=> string(2) "24" ["attribute_set_id"]=> string(1) "9" ["attribute_group_name"]=> string(7) "General" ["sort_order"]=> string(1) "1" ["default_id"]=> string(1) "1" }
array(5) { ["attribute_group_id"]=> string(2) "32" ["attribute_set_id"]=> string(1) "9" ["attribute_group_name"]=> string(6) "Coupon" ["sort_order"]=> string(1) "2" ["default_id"]=> string(1) "0" }
array(5) { ["attribute_group_id"]=> string(2) "21" ["attribute_set_id"]=> string(1) "9" ["attribute_group_name"]=> string(6) "Images" ["sort_order"]=> string(1) "3" ["default_id"]=> string(1) "0" }
array(5) { ["attribute_group_id"]=> string(2) "22" ["attribute_set_id"]=> string(1) "9" ["attribute_group_name"]=> string(16) "Meta Information" ["sort_order"]=> string(1) "4" ["default_id"]=> string(1) "0" }
array(5) { ["attribute_group_id"]=> string(2) "19" ["attribute_set_id"]=> string(1) "9" ["attribute_group_name"]=> string(6) "Design" ["sort_order"]=> string(1) "5" ["default_id"]=> string(1) "0" }
array(5) { ["attribute_group_id"]=> string(2) "23" ["attribute_set_id"]=> string(1) "9" ["attribute_group_name"]=> string(6) "Prices" ["sort_order"]=> string(1) "5" ["default_id"]=> string(1) "0" }
array(5) { ["attribute_group_id"]=> string(2) "20" ["attribute_set_id"]=> string(1) "9" ["attribute_group_name"]=> string(17) "Recurring Profile" ["sort_order"]=> string(1) "7" ["default_id"]=> string(1) "0" }
array(5) { ["attribute_group_id"]=> string(2) "18" ["attribute_set_id"]=> string(1) "9" ["attribute_group_name"]=> string(12) "Gift Options" ["sort_order"]=> string(1) "8" ["default_id"]=> string(1) "0" }
->
coupon_datetime_valid_until
->

[ADMINHTML_FORM_ADDELEMENT]
http://www.excellencemagentoblog.com/magento-admin-form-field
->
$fieldset->addField('date', 'date', array(
          'label'     => Mage::helper('tmo_sms')->__('Date'),
		  'after_element_html' => '<small>Comments</small>',
		  'tabindex' => 1,
		  'image' => $this->getSkinUrl('images/grid-cal.gif'),
	      'format' => Mage::app()->getLocale()->getDateFormat(Mage_Core_Model_Locale::FORMAT_TYPE_SHORT)
		));
[ADMINHTML_FORM_ADDELEMENT]

3.
Dev enviroment
->
debian network configuration:
/etc/network/interfaces
auto lo
allow-hotplug eth0
#iface eth0 inet dhcp
iface eth0 inet static
address 192.168.0.107
netmask 255.255.255.0
network 192.168.0.1
broadcast 192.168.0.255
gateway 192.168.0.1
->MUST REBOOT AFTER CONFIGURATION

With
Linux commands:
->
tail -n 100 error_log
ps aux | grep http
ps aux | grep apache
netstat -ap | grep http
./apachectl configtest
/var/log/
./apachectl start
logs/
./apachectl stop
COPY
cp  -r  /root/*  /tmp/
FIND
find  /  -name  httpd.conf

debian env:
3.1.apache
copy
3.2.php
version: PHP Version 5.3.3-7+squeeze14
Loaded Configuration File 	/etc/php5/apache2/php.ini
Scan this dir for additional .ini files 	/etc/php5/apache2/conf.d
3.3.apc
3.4.memcached

log_url_info
[MYSQL START]
sudo /usr/local/mysql/support-files/mysql.server start
/usr/local/mysql/bin/mysql -v
export PATH="/usr/local/mysql/bin:$PATH"
[MYSQL START]

========================================================================================================================================================================
20130321
->
Linux commands:
0.1. more
0.2. top
0.3. sudo fdisk -l
0.4. time dd if=/dev/urandom of=./test bs=4096 count=32768
0.5. time dd if=/dev/zero of=./test bs=4096 count=16384

1.
code style of Tmo_Sms and other modules
1.1. big comment of every class at beginning of the party
1.2. Why do people add prefix m_ to variables? add m_ to variables! m_ means member variables
1.3. -done.

2.
Other configuration of apache & cache
(    )
(		)

3.Plan of everwines

====================================================

"For the development"
-
-before development -> ask question:(f on development)
--Q:how many parts or things we have to do? What are customer requests?

CMS Navigation & page
-about everwines(create the paget in cms of mangento)
-everwines club
-everwines events
-everwines shops
-wine knowledge
-other pages
-widgets(Displayed on predefined areas,e.g. Frontpage, sidebar

-user account management (KIND OF ACCOUNT)
-->profile/view & edit account information

-e-commerce functionality
--product catalog(ANALYSIS PRODUCT OF EVEWINES)

-Phase #1 everwines.com web services
--interface sap ecc > everwines.com
--interface sap crm <> everwines.com

?

Issue: 	0000127: [com.everwines] Project Plan - Project: com.everwines

This ticket contains all available material and current project plan - pass.
Accordingly please create tickets for development phase 1.
->R: create tickets for the development procedure

Please include estimations and details/descriptions on how you plan to implement the features/tasks.
->Detail Request: detail explain my think about "HOW YOU PLAN TO IMPLEMENT THE FEATURES/TASKS!"

Please also define the target version (calendar week) according to the dates in current project plan.
->Detail request: define the "TARGET VERSION(CALENDAR WEEK)" according to the dates in current project plan.

?

[MAIN TASKS]
1.registration / login / membership / credit loyalty points(need details) / kind of account/user
,
2.online shopping / product structure ->
2.1.catalog->20130304-com.everwines-catalog.xls
2.2.1. function requirements:
2.2.1.1. upload: format: excel or csv, summary of status BEFORE uploading or overwriting
2.2.1.2. edit
2.2.1.3. export
2.2.1.4. search
2.2.1.5. interface
2.2.1.6. user access - login request
,
3.backend functions - sap crm integration / api,service

other main part:
CMS Pages:
about,shops,club,events,knowledge,links,contact info / terms of use / privacy
[MAIN TASKS]
===>

Requests:
1. "HOW YOU PLAN TO IMPLEMENT THE FEATURES/TASKS!"
2. "TARGET VERSION(CALENDAR WEEK)" according to the date.
3. During: Timeline:20130321 - 20130606

Reply:

Carsten,
Here is a short outline of development of everwines project phase #1,please update for your advices,thank you.

I would like to set up 2 sub phases of this project's phase #1
phase 1.1: 20130321-20130503(32 working days) to complete all main functions except SAP.
phase 1.2: 20130506-20130606(24 working days) to test.

Division of work:
Frontend Developer(the new stuff,start from week13)
Main tasks: work with designer to work out static pages by CMS of magento(eg. about,knowledge,contact info etc.)
Backend Developer(me)
Main tasks:1.System backend setup. 2.Online Shopping(Products setup)

Before start,question:
1.The user definition of system,specially, about the backend.for example,sales account,manage account etc.
2.What kind resource that we get from designer,is pure image?and when,the attached files are PDF format.

Time calculator in master plan:
online shopping: 41.1/2 = 20

[BACKEND]
-Structure
1.KIND OF USER
2.PRODUCT STRUCTURE
3.SAP CRM / WEB SERVICE
[BACKEND]
with
[FRONTEND/Designer]
-Design:what we could get from designer? pure design or something else?
CMS Pages, CSS/HTML
[FRONTEND/Designer]
-DONE.

====================================================


--analysis product of evewines asign to team leader
--

->
For consistency please use the same titles for the tickets as in the project plan as far as possible
(though you probably have to split certain points of project plan into multiple issues in mantis,
in those cases please use the title of corresponding point in project plan as prefix for the ticket title).

========================================================================================================================================================================
20130322
1.magento
Carsten:
Locala function __() in file: core/block/abstract/function __()

2.
Configuration of apache
It's none of business of apache / problem is from codes of magento / index page has problems of English version!

Chinese version is okay:
English index page has problem
->
http://mo-commerce.com.dev/?___store=com_mocommerce_en_us&___from_store=com_mocommerce_zh_cn
->

Debian php folder:
/usr/lib/php5/20090626/

[FOLDERS]
1.Mac php folder:
/usr/lib/php/extensions/
2.Mac bin folder:
/usr/bin/php-config
3.Mac/Linux Default install folder:
/usr/local/xxxx(homebrew)
[FOLDERS]

[PATH]
ADD TO $PATH
export $PATH = $PATH:XXXXXX
echo $PATH
[PATH]

=====================================================================================
[INSTALL DEV ENV IN MAC]
0.install Xcode.CLTools to add c compiler

A.install homebrew:
curl -L https://github.com/mxcl/homebrew/tarball/master | tar xz
->./brew install curl libmemcached pcre mcrypt
->add path to env:->You can amend this by altering your ~/.bashrc file

B.install pear
php install-pear-nozlib.phar
Edit/etc/php.ini and find the line: ;include_path = ".:/php/includes" and change it to: include_path = ".:/usr/lib/php/pear"
sudo pear channel-update pear.php.net
sudo pecl channel-update pecl.php.net
sudo pear upgrade-all

B.install autoconf
php:
/usr/lib/php
path:
export PATH=/usr/local/share/python:$PATH
curl -OL http://mirror.bjtu.edu.cn/gnu/autoconf/autoconf-latest.tar.gz
tar xzf autoconf-2.68.tar.gz
cd autoconf-2.68
./configure --prefix=/usr/local
make
make install
(you could ignore the error message!)

C.install memcached
pecl download memcached
gzip -d < memcached-1.0.0.tgz | tar -xvf -
cd memcached-1.0.0;
phpize
./configure --with-php-config=/usr/bin/php-config --with-libmemcached-dir=/usr/local/homebrew/Cellar/libmemcached/1.0.16/
make
make install

D.install APC
pecl download APC
gzip -d < xxxx | tar -xvf -
cd xxxx
phpize
./configure --with-php-config=/usr/bin/php-config
CHANGE: /usr/include/php/ext/pcre/php_pcre.h:29:10: to include homebrew-Cellar-pcre

E.install mcrypt
download sourc code of php -> exact version
cd ext/mcrypt
phpize
./configure --with-php-config=/usr/bin/php-config
make
make install
===================================================================
CHANGE: configure 文件中的路径信息该改的时候就需要改！
if test "$PHP_MCRYPT" != "no"; then
  for i in $PHP_MCRYPT /usr/local/homebrew/Cellar/mcrypt/2.5.8 /usr/local /usr; do
    test -f $i/include/mcrypt.h && MCRYPT_DIR=$i && break
  done

  if test -z "$MCRYPT_DIR"; then
    as_fn_error $? "mcrypt.h not found. Please reinstall libmcrypt." "$LINENO" 5
  fi
===================================================================

[VIRTUALBOX]
mount sharefolder in virtualbox
mount -t vboxsf sites /var/www/dev
[VIRTUALBOX]

[HOST A GIT SERVER]
Server:
https://github.com/sitaramc/gitolite
Documents:
http://www.ossxp.com/doc/git/gitolite.html

install gitolite
1.create user git or maxwell... whatever
$ sudo adduser --system --shell /bin/bash --group git
2.gitolite steup -pk xx.pub
权限的问题啊……
$ ls -la，查看git库的所有者
因为我设置的上传账号是git，但是git库是其他账号git --bare init的，所以就………………
解决：
在git库目录下：
$ chown -vR git *
3.git clone username@servername:/address.git
4./Users/git/.gitolite/conf/gitolite.conf
repo gitolite-admin
RW+=@all
5.open repositories/gitolite-admin.git package
chmod 777 *
6.remove hooks/post-update and hooks/update
[HOST A GIT SERVER]

[MYSQL SETUP]
reimport database
copy macmini config files
[MYSQL SETUP]

[INSTALL DEV ENV IN MAC]
=====================================================================================

CURRENT $PATH
/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/local/git/bin:/usr/local/homebrew/bin/:/usr/local/homebrew/Cellar/pcre/8.32/bin/

[APC]
extension=apc.so
[apc]
;apc.shm_size=64m
apc.rfc1867=1
apc.rfc1867_freq=1k
apc.rfc1867_name=APC_UPLOAD_PROGRESS
apc.rfc1867_prefix=upload_
[APC]
php config-
extension = memcached.so
extension=apc.so
[apc]
;apc.shm_size=64m
apc.rfc1867=1
apc.rfc1867_freq=1k
apc.rfc1867_name=APC_UPLOAD_PROGRESS
apc.rfc1867_prefix=upload_
extension = memcache.so
[memcache]
memcache.dbpath="/var/lib/memcache"
memcache.maxreclevel=0
memcache.maxfiles=0
memcache.archivememlim=0
memcache.maxfilesize=0
memcache.maxratio=0
[session]
session.save_handler = memcache
session.save_path = "tcp://127.0.0.1:11211?persistent=1&amp;weight=1&amp;timeout=1&amp;retry_interval=15"
extension = mcrypt.so
zend_extension="/usr/lib/php/extensions/no-debug-non-zts-20090626/xdebug.so"
-php config

corrent address:http://mo-commerce.com.dev/admin/?locale=en_US
http://mo-commerce.com.dev/admin/?locale=en_US
===
English version error message:
->
Below errow message is because Database MYSQL problem & PHP Configuration
->
a:5:{i:0;s:79:"SQLSTATE[42S22]: Column not found: 1054 Unknown column 'area' in 'where clause'";i:1;s:5541:"#0 /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/Varien/Db/Statement/Pdo/Mysql.php(110): Zend_Db_Statement_Pdo->_execute(Array)
#1 /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/Zend/Db/Statement.php(300): Varien_Db_Statement_Pdo_Mysql->_execute(Array)
#2 /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/Zend/Db/Adapter/Abstract.php(479): Zend_Db_Statement->execute(Array)
#3 /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/Zend/Db/Adapter/Pdo/Abstract.php(238): Zend_Db_Adapter_Abstract->query('SELECT `main_ta...', Array)
#4 /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/Varien/Db/Adapter/Pdo/Mysql.php(419): Zend_Db_Adapter_Pdo_Abstract->query('SELECT `main_ta...', Array)
#5 /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/Zend/Db/Adapter/Abstract.php(734): Varien_Db_Adapter_Pdo_Mysql->query('SELECT `main_ta...', Array)
#6 /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/Varien/Data/Collection/Db.php(734): Zend_Db_Adapter_Abstract->fetchAll('SELECT `main_ta...', Array)
#7 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Model/Resource/Db/Collection/Abstract.php(521): Varien_Data_Collection_Db->_fetchAll('SELECT `main_ta...', Array)
#8 /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/Varien/Data/Collection/Db.php(566): Mage_Core_Model_Resource_Db_Collection_Abstract->getData()
#9 /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/Varien/Data/Collection.php(752): Varien_Data_Collection_Db->load()
#10 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/design/frontend/ultimo/tmo/template/cms/home/banner.phtml(14): Varien_Data_Collection->count()
#11 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/local/Mage/Core/Block/Template.php(244): include('/Users/maxwells...')
#12 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/local/Mage/Core/Block/Template.php(275): Mage_Core_Block_Template->fetchView('frontend/ultimo...')
#13 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/local/Mage/Core/Block/Template.php(373): Mage_Core_Block_Template->renderView()
#14 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Block/Abstract.php(863): Mage_Core_Block_Template->_toHtml()
#15 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Block/Text/List.php(43): Mage_Core_Block_Abstract->toHtml()
#16 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Block/Abstract.php(863): Mage_Core_Block_Text_List->_toHtml()
#17 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Block/Abstract.php(582): Mage_Core_Block_Abstract->toHtml()
#18 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Block/Abstract.php(526): Mage_Core_Block_Abstract->_getChildHtml('content', true)
#19 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/design/frontend/ultimo/tmo/template/page/2columns-left.phtml(18): Mage_Core_Block_Abstract->getChildHtml('content')
#20 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/local/Mage/Core/Block/Template.php(244): include('/Users/maxwells...')
#21 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/local/Mage/Core/Block/Template.php(275): Mage_Core_Block_Template->fetchView('frontend/ultimo...')
#22 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/local/Mage/Core/Block/Template.php(373): Mage_Core_Block_Template->renderView()
#23 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Block/Abstract.php(863): Mage_Core_Block_Template->_toHtml()
#24 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Model/Layout.php(555): Mage_Core_Block_Abstract->toHtml()
#25 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Controller/Varien/Action.php(390): Mage_Core_Model_Layout->getOutput()
#26 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Cms/Helper/Page.php(137): Mage_Core_Controller_Varien_Action->renderLayout()
#27 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Cms/Helper/Page.php(52): Mage_Cms_Helper_Page->_renderPage(Object(Mage_Cms_IndexController), '2')
#28 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Cms/controllers/IndexController.php(45): Mage_Cms_Helper_Page->renderPage(Object(Mage_Cms_IndexController), '2')
#29 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Controller/Varien/Action.php(419): Mage_Cms_IndexController->indexAction()
#30 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Controller/Varien/Router/Standard.php(250): Mage_Core_Controller_Varien_Action->dispatch('index')
#31 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Controller/Varien/Front.php(176): Mage_Core_Controller_Varien_Router_Standard->match(Object(Mage_Core_Controller_Request_Http))
#32 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/code/core/Mage/Core/Model/App.php(354): Mage_Core_Controller_Varien_Front->dispatch()
#33 /Users/maxwellshi/Documents/workspace/com.mo-commerce/app/Mage.php(683): Mage_Core_Model_App->run(Array)
#34 /Users/maxwellshi/Documents/workspace/com.mo-commerce/lib/tmo/components/runtime/source/magento/bootstrap.php(93): Mage::run('com_mocommerce', 'website')
#35 /Users/maxwellshi/Documents/workspace/com.mo-commerce/index.php(8): components_runtime_magento_bootstrap()
#36 {main}";s:3:"url";s:1:"/";s:11:"script_name";s:10:"/index.php";s:4:"skin";s:20:"com_mocommerce_en_us";}
===


Reference:
Linux commands:
lsof -i :80

========================================================================================================================================================================
20130325
SMS Module - Code Style:
1.remove testing function
1.1. froendend -done.
1.2.Data.php - remove:
public function sendTestingSms($t_phone,$sms_provider_id)
{
$this->sendSms($t_phone,'','',array('name'=>'User','company'=>'TMO'),'tmo_testing',$sms_provider_id);
}
1.3.restructure sendSms($phone,$store_id,$template_type,array $content,$sendType='',$providerTesting='')-done.
3.let's independent-pure send-done.
2.no under line in variable name-done.
4.warning for multiply configuration of store!-done.
5.testing-done.

========================================================================================================================================================================
20130326
Tmo_Sms add more send function - done.

[DEV ENV + php.ini]
phpmyadmin warning session error -> check all setting & configuration in php.ini
[+DEV ENV]

[Magento Error]
Mage::logException($e);
Mage::throwException(Mage::helper('install')->__('Database connection error.'));
[Magento Error]

Check on contact group
========================================================================================================================================================================
20130327

1.
Magento model/collection sql method ->
ref:
http://www.magentocommerce.com/wiki/1_-_installation_and_configuration/using_collections_in_magento
refer to [SQL_QUERY] - done.

2.
Tmo_Security module make clearly ->
model:
1.Mage_Admin_Model_Roles
2.Tmo_Security_Model_Permission_Store
3.Tmo_Security_Model_Permission
table:
tmo_security_per
tmo_security_permissions
tmo_contactmanager_contact_groups
2.1.send function -done.
2.2.use configuration - remove provider information and check available -done.

========================================================================================================================================================================
20130328
0.general/appearance/color them: RecognEyes -done.
3.cache of variable - write new class and function(Package them)-done.
3.0.count sms-done.
3.1.make function in helper->data.php-done.
1.Warning message issue-done.
5.roll back-hold.

[APC]
http://www.qicai.us/solved-uncaught-exception-zend_cache_exception-with-message-cant-get-apc-memory-size
apc.enable_cli=1
apc.enabled=1
apc.shm_segments=1
apc.optimization=0
apc.shm_size=128
apc.ttl=7200
apc.user_ttl=7200
apc.num_files_hint=1024
apc.mmap_file_mask=/tmp/apc.XXXXXX
apc.enable_cli=1
apc.cache_by_default=1
apc.max_file_size = 10M

extension=apc.so
apc.enabled=1
apc.shm_segments=1
apc.shm_size=64M
apc.optimization=1
apc.num_files_hint=1024
apc.ttl=7200
apc.user_ttl=7200
apc.mmap_file_mask=/tmp/apc.XXXXXX
apc.enable_cli=1
apc.cache_by_default=on
apc.max_file_size = 10M
apc.stat = 0   # 1 for dev, 0 for production, whether the source file is checked for mod date
apc.include_once_override = 1  # Use PHP5.3+ for include_once optimization
[APC]

[SMS PROVIDER]
cosms->160=longsms
dxcx->
1.sxt:300 SmsType=1
<input type="hidden" value="1" name="ThisMenuCode">
2.qxt:500 SmsType=5
<input type="hidden" value="5" name="ThisMenuCode">
fixed to use:
private static $m_smsSeparate=array(
self::PROVIDER_TYPE_COSMS=>160,
self::PROVIDER_TYPE_DXCX=>500
);
[SMS PROVIDER]

English echaracter:
//iso-8859-1
//iso-8859-15

360Buy API
http://help.jd.com/oapihelp/question-459.html

========================================================================================================================================================================
20130329
[X-DEBUG]
some good learn courses:
http://eclipse.org/hudson/
http://hudson-ci.org/
http://xdebug.org/docs/

here links for:
Xdebug
http://www.xdebug.org/
Debugging with Xdebug
http://xdebug.org/docs/remote
Profiling with Xdebug & Kcachegrind
http://xdebug.org/docs/profiler
XHProf  (another profiler re-developed by facebook / was a dead project before)
https://github.com/facebook/xhprof
http://techportal.inviqa.com/2009/12/01/profiling-with-xhprof/
Hudson CI (Continuous Integration - just for you to check it out, something we will start using as soon as we have time)
http://hudson-ci.org/
Setup for debugging with xdebug & eclipse/PDT:
php.ini (In our development environment: /etc/php/apache2/conf.d/xdebug.ini):
xdebug.remote_autostart=On
xdebug.remote_connect_back=Off
xdebug.remote_cookie_expire_time=3600
xdebug.remote_enable=On
xdebug.remote_handler=dbgp
xdebug.remote_host=127.0.0.1
xdebug.remote_log=
xdebug.remote_mode=req
xdebug.remote_port=9000
for eclipse/PDT configuration, see attached screenshots.
[X-DEBUG]

1.rule of SMS valid until - done.

[CRON JOB]
Magento Cron Job:
http://www.magentocommerce.com/wiki/1_-_installation_and_configuration/how_to_setup_a_cron_job
Built-in Cron Jobs
1.3.0
Log 	logClean 	*/10 * * * * 	Every 10 minutes
http://www.magentocommerce.com/boards/viewthread/73390/
->
inner run:
Mage::getConfig()->init()->loadEventObservers('crontab');
Mage::app()->addEventArea('crontab');
Mage::dispatchEvent('default');
,
cli run:
php /Users/maxwellshi/Documents/workspace/com.mo-commerce/cron.php

table:cron_schedule
linux command:
1.crontab -e
2.*/5 * * * * php /host-absolute/path/to/magento/cron.php
*/1 **** php /Users/maxwellshi/Documents/workspace/com.mo-commerce/cron.php
[CRON JOB]

[MAGENTO LOG]
Mage::log("WORKS!"); -> to save log in /var/log/system.log
[MAGENTO LOG]
[MAGENTO EXCEPTION]
throw new Mage_Core_Exception(
            '[tmo/payment/alipay/wap/model/payment] Unable to convert currency: Missing CNY conversion rate.'
          );
[MAGENTO EXCEPTION]

[WAPALIPAY]
Tmo_Wapalipay configure information in backend:
Subject: Wap Alipay Payment
Enabled: Yes
Title: Wap Alipay
Service Type: HTTP/HTTPS
Gateway Http: http://wappaygw.alipay.com/service/rest.htm
Gateway Https: https://wappaygw.alipay.com:443/service/rest.htm
Partner ID: 2088601071646094
Security Code: wyb3uyfq1lttxywtqx40zc1nh7uhn7dy
Seller Email: payment@juzine.com
New order status: Pending
Payment from applicable countries: All Allowed Countries
[WAPALIPAY]

[UNION PAY]
https://online.unionpay.com/
requests:
https://online.unionpay.com/mer/pages/merser/helper.jsp?pid=1&cid=1
information for technique:
https://online.unionpay.com/mer/pages/merser/helper.jsp?pid=1&cid=1
11、防钓鱼接口有哪些特殊的技术要求？
（1）商户需在入网申请表中填写真实交易域名，如有多个，需全部填写。
（2）交易报文中customIp字段需上送客户真实IP，详情请参考接口规范文档中对customIp域的说明。
（3）UPOP会根据当前服务器时间减掉商户上送的订单时间来计算订单超时时间，所得时间间隔如果大于上送的transTimeout字段，则认为该笔订单超时。商户需对transTimeout字段上送一个合理值，建议300000毫秒。
3、商户进行接口开发和改造的注意事项
（1）消费、交易信息查询两个交易功能是每个接入商户必须开发的基本功能。在交易过程中，由于银行返回交易应答可能发生延迟，商户可以通过交易查询功能多次查询未及时收到的交易结果。
（2）商户可根据退款的频率，选择消费撤消和退货交易通过后台交易发起或通过银联在线支付商户服务网站发起。如选择通过后台交易发起，则须按照技术改造指南完成相应的开发和测试。
（3）担保支付相关交易。如商户选择支持担保支付功能，担保消费和交易信息查询两个交易功能必须开发，担保消费撤销、担保消费完成、担保消费完成撤销可选择开发。
reference:
6、银联在线支付的三个技术环境提供测试卡吗？分别是什么？
中国银联为商户的接口开发提供三个环境：开发联调环境、PM测试环境（准生产环境）、生产环境，请求地址如下：
（1）开发联调环境测试卡：
    借记卡卡号：6212341111111111111，密码：111111，手机号：13888888888，短信验证码测试环境不校验，可输入任意6位数字。
    贷记卡卡号：6212341111111111111，年份：12，月份：12，CVN2：123，短信验证码测试环境不校验，可任意输入6位数字。
（2）PM测试环境（准生产环境）测试卡：
    借记卡卡号：6222023602899998371，密码：888888，手机号：13924254496 ，短信验证码：111111。
    贷记卡卡号：5309900599078555，CVN2：214，有效期：02月15年，手机号：13602958691，短信验证码：111111。
[UNION PAY]

http://hcsem.com/
提交得内容要出除换行符
$dataContent =preg_replace("/\s/", '',$dataContent);

Tasks:
1.http://support.tmogroup.asia/view.php?id=175 - union pay
2.http://support.tmogroup.asia/view.php?id=81 - alipay
Current:

1.install alipay that was created by other one!
1.1 complete wapalipay with that notify function

2.repare unionpay

below need a valid domain to testing -> call "notify_url"
?交易完成

付款接受
付款拒绝

发送通知（订单状态改变）The process log of checkout

Wapalipay: /etc/system.xml
<order_status translate="label">
							 <label>New Order Status</label>
                            <frontend_type>select</frontend_type>
                            <source_model>adminhtml/system_config_source_order_status_newprocessing</source_model>
                            <sort_order>12</sort_order>
                            <show_in_default>1</show_in_default>
                            <show_in_website>1</show_in_website>
                            <show_in_store>0</show_in_store>
						</order_status>
						<payment_action translate="label">
                            <label>Automatically Invoice All Items</label>
                            <frontend_type>select</frontend_type>
                            <source_model>payment/source_invoice</source_model>
                            <sort_order>12</sort_order>
                            <show_in_default>1</show_in_default>
                            <show_in_website>1</show_in_website>
                            <show_in_store>0</show_in_store>
                            <depends>
                                <order_status separator=",">processing,processed_ogone</order_status>
                            </depends>
                        </payment_action>
						<order_status_payment_accepted translate="label">
							<label>Order status when payment accepted by Alipay</label>
							<frontend_type>text</frontend_type>
							<!--<source_model>adminhtml/system_config_source_order_status</source_model>-->
							<!--<source_model>adminhtml/system_config_source_order_status_complete</source_model>-->
							<sort_order>13</sort_order>
							<show_in_default>1</show_in_default>
							<show_in_website>1</show_in_website>
							<show_in_store>0</show_in_store>
						</order_status_payment_accepted>
						<order_status_payment_refused translate="label">
							<label>Order status when payment refused by Alipay</label>
							<frontend_type>text</frontend_type>
							<!--<source_model>adminhtml/system_config_source_order_status</source_model>-->
							<sort_order>14</sort_order>
							<show_in_default>1</show_in_default>
							<show_in_website>1</show_in_website>
							<show_in_store>0</show_in_store>
						</order_status_payment_refused>

========================================================================================================================================================================
20130401

1.alipay settings:
[ALIPAY]
[ALIPAY setting]
Service type: standard double gateways
gateway: www.alipay.com/cooperate/gateway.do
partner id: 2088601071646094
md5: wyb3uyfq1lttxywtqx40zc1nh7uhn7dy
sales email: payment@juzine.com
transport protocol: https/http
new order: pending
accept: complete
reject: canceled
contoury: all allowed countsries
[ALIPAY setting]

controllers:
paymentcontroller.php->
public function notifyAction()  for notify action()
protected function saveInvoice(Mage_Sales_Model_Order $order)

model:
model/payment.php ->

block:
block/form.php
block/redirect.php
-only for onecheck page.

/!!!/
notify_url and notify function needs valid domain & ip to test.
/!!!/
[ALIPAY]

[UNION PAY]
quickpay_conf.php -> system.xml to setup initial variable!
controller url:
http://mo-commerce.com.dev/tmo-payment/unionpay_payment

Configuration information:
Title: UnionPay
Merchant ID: 105550149170027
Merchant Name: 商户名称
Security Code: 88888888
Charset: UTF8
Front Pay URL: http://58.246.226.99/UpopWeb/api/Pay.action
Back Pay URL: http://58.246.226.99/UpopWeb/api/BSPay.action
Query URL: http://58.246.226.99/UpopWeb/api/Query.action
->
Testing bank account as below:
1.
Account：6212341111111111111,
Password：111111,
SMS: 111111
2.
Credit card:
Account：6212341111111111111,
Year：12，Month：12，CVN2：123，
SMS: 111111
Know Issue: update order status after payment.
[UNION PAY]


========================================================================================================================================================================
20130402
1.Update order status once payment successfully done.
Response post array:
array(22) {
["charset"]=> string(5) "UTF-8"
["cupReserved"]=> string(32) "{cardNumber=6212341111111111111}"
["exchangeDate"]=> string(0) ""
["exchangeRate"]=> string(0) ""
["merAbbr"]=> string(24) "银联商城（公司）"
["merId"]=> string(15) "105550149170027"
["orderAmount"]=> string(1) "1"
["orderCurrency"]=> string(3) "156"
["orderNumber"]=> string(9) "100000022"
["qid"]=> string(21) "201304021027155784112"
["respCode"]=> string(2) "00"
["respMsg"]=> string(12) "支付成功"
["respTime"]=> string(14) "20130402102944"
["settleAmount"]=> string(1) "1"
["settleCurrency"]=> string(3) "156"
["settleDate"]=> string(4) "0402"
["signMethod"]=> string(3) "md5"
["signature"]=> string(32) "d4ee8f6b26e8c8ca570c923b3a7e57e6"
["traceNumber"]=> string(6) "578411"
["traceTime"]=> string(10) "0402102715"
["transType"]=> string(2) "01"
["version"]=> string(5) "1.0.0" }
->
订单 100000022 支付成功

[LOAD ORDER]
$order = Mage::getModel('sales/order')->loadByIncrementId($arr_ret['orderNumber']);
$order->getRealOrderId() //GET ORDER REAL ORDER ID

[LOAD ORDER]
[UPDATE ORDER STATUS]
$state = 'processing';
$status = 'my_processing_status';
$comment = 'Changing state to Processing and status to My Processing Status';
$isCustomerNotified = false;
$order->setState($state, $status, $comment, $isCustomerNotified);
$order->save();
[UPDATE ORDER STATUS]

========================================================================================================================================================================

OpenERP:https://www.openerp.com/en/
TMO employees:
***
Carsten Schipke
办公电话   +86 21 617 00 396
办公手机  +86 138 1750 7045
***
,
***
Chun Yin Tang
办公电话   +86 21 617 00 396
办公手机  +86 138 1849 4942
***
,
***
Jing Zhou | 周晶
办公电话   +86 21 617 00 396
办公手机  +86 138 1634 2786
***
,
***
Lily Hong | 洪晓丽
办公电话   +86 21 617 00 396
办公手机  +86 136 7154 3012
***
,
***
,
***
Yechen Zhang | 张叶琛
办公电话   +86 21 617 00 396
办公手机  +86 136 2161 2682
***
,
***
song weiming
Title: SEO Specialist.(2013/3/4)
13962747702
***
,
***
Robbert
Title: web developer
13166336269
***
,
casher: Yanli Wang <yanli.wang@tmogroup.asia>
hr: wendy / Yan jiao Lv <wendy.lv@tmogroup.asia>
,
Candidate-金如意(PHP)
13564297620（手机）
jinruee@gmail.com

********************************************************************************************************************************************************